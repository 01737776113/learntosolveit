From senthil  Tue Apr 17 19:22:53 2012
Delivered-To: senthil@uthcode.com
Received: from iy-in-f109.1e100.net [209.85.225.109]
	by mathmagic with POP3 (fetchmail-6.3.19)
	for <senthil@localhost> (single-drop); Tue, 17 Apr 2012 19:22:53 +0800 (SGT)
Received: by 10.60.61.36 with SMTP id m4csp73677oer;
        Tue, 17 Apr 2012 01:17:17 -0700 (PDT)
Received: by 10.60.4.1 with SMTP id g1mr19582654oeg.55.1334650636945;
        Tue, 17 Apr 2012 01:17:16 -0700 (PDT)
Return-Path: <v+python@g.nevcal.com>
Received: from oproxy1-pub.bluehost.com (oproxy1-pub.bluehost.com. [66.147.249.253])
        by mx.google.com with SMTP id sq3si7416833obb.43.2012.04.17.01.17.15;
        Tue, 17 Apr 2012 01:17:16 -0700 (PDT)
Received-SPF: neutral (google.com: 66.147.249.253 is neither permitted nor denied by best guess record for domain of v+python@g.nevcal.com) client-ip=66.147.249.253;
Authentication-Results: mx.google.com; spf=neutral (google.com: 66.147.249.253 is neither permitted nor denied by best guess record for domain of v+python@g.nevcal.com) smtp.mail=v+python@g.nevcal.com
Received: (qmail 22750 invoked by uid 0); 17 Apr 2012 08:17:15 -0000
Received: from unknown (HELO box538.bluehost.com) (74.220.219.138)
  by oproxy1.bluehost.com with SMTP; 17 Apr 2012 08:17:15 -0000
Received: from [50.37.28.55] (helo=[192.168.43.254])
	by box538.bluehost.com with esmtpa (Exim 4.76)
	(envelope-from <v+python@g.nevcal.com>)
	id 1SK3b6-0007y2-D0
	for senthil@uthcode.com; Tue, 17 Apr 2012 02:17:14 -0600
Message-ID: <4F8D2700.4050807@g.nevcal.com>
Date: Tue, 17 Apr 2012 01:17:04 -0700
From: Glenn Linderman <v+python@g.nevcal.com>
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:11.0) Gecko/20120327 Thunderbird/11.0.1
MIME-Version: 1.0
To: Senthil Kumaran <senthil@uthcode.com>
Subject: Re: plans for http.server ?
References: <4F89347E.3070409@g.nevcal.com> <20120414083050.GA4513@mathmagic>
In-Reply-To: <20120414083050.GA4513@mathmagic>
Content-Type: multipart/mixed;
 boundary="------------030907040804090606000906"
X-Identified-User: {11138:box538.bluehost.com:areliabl:nevcal.com} {sentby:smtp auth 50.37.28.55 authed with test@nevcal.com}
Content-Length: 100571
Lines: 1423

This is a multi-part message in MIME format.
--------------030907040804090606000906
Content-Type: multipart/alternative;
 boundary="------------040604090503000307060006"


--------------040604090503000307060006
Content-Type: text/plain; charset=UTF-8; format=flowed
Content-Transfer-Encoding: 7bit

Here's some code.  There is a debug print in run_cgi.  This is an 
upgrade of the code I posted in that one bug, upgraded to trunk 
(including fixes from the bug you fixed), plus fixes for the other bugs 
I've submitted recently.

Perhaps more environment variables should be set, I haven't exhaustively 
researched that.

I wasn't sure what exception to raise in check_path_component and I 
suppose then the chosen exception should be mentioned, along with 
IndexError, as a possible Exception return from parse_url.

You'll note the added tests include hiding \ and / using % escapes, and 
verifying that % escapes are left in the query string, and that the 
query string and fragment id are properly separated from the path part 
of the URL.

Testing for proper PATH_INFO would require a known file system content, 
and I haven't figured out enough of the testing environment to even get 
all of these tests running (but all the test_parse_url tests run, it is 
the others that don't), much less how to set up an environment to 
properly test PATH_INFO.  However, PATH_INFO is working well enough to 
run my local copy of my Linux/Apache web site on my Windows 7 PC....

I do have a subclass, and do a few things differently from server.py 
with respect to the Windows environment.  The biggest item is discussed 
in issue 10483. The other item that I subclass parse_request (and then 
call it in the super class) just to provide a hook where I can add code 
to tweak the URL path in a manner similar to (but much more limited 
than) Apache's mod_rewrite module. I only implemented enough to simulate 
the tiny fraction of mod_rewrite features that I use on my Apache web site.

Glenn

--------------040604090503000307060006
Content-Type: text/html; charset=UTF-8
Content-Transfer-Encoding: 8bit

<html>
  <head>
    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  </head>
  <body bgcolor="#FFFFFF" text="#330033">
    Here's some code.  There is a debug print in run_cgi.  This is an
    upgrade of the code I posted in that one bug, upgraded to trunk
    (including fixes from the bug you fixed), plus fixes for the other
    bugs I've submitted recently.<br>
    <br>
    Perhaps more environment variables should be set, I haven't
    exhaustively researched that.<br>
    <br>
    I wasn't sure what exception to raise in check_path_component and I
    suppose then the chosen exception should be mentioned, along with
    IndexError, as a possible Exception return from parse_url.<br>
    <br>
    You'll note the added tests include hiding \ and / using % escapes,
    and verifying that % escapes are left in the query string, and that
    the query string and fragment id are properly separated from the
    path part of the URL.<br>
    <br>
    Testing for proper PATH_INFO would require a known file system
    content, and I haven't figured out enough of the testing environment
    to even get all of these tests running (but all the test_parse_url
    tests run, it is the others that don't), much less how to set up an
    environment to properly test PATH_INFO.  However, PATH_INFO is
    working well enough to run my local copy of my Linux/Apache web site
    on my Windows 7 PC.... <br>
    <br>
    I do have a subclass, and do a few things differently from server.py
    with respect to the Windows environment.  The biggest item is
    discussed in issue 10483. The other item that I subclass
    parse_request (and then call it in the super class) just to provide
    a hook where I can add code to tweak the URL path in a manner
    similar to (but much more limited than) Apache's mod_rewrite module.
    I only implemented enough to simulate the tiny fraction of
    mod_rewrite features that I use on my Apache web site.<br>
    <br>
    Glenn<br>
  </body>
</html>

--------------040604090503000307060006--

--------------030907040804090606000906
Content-Type: text/plain; charset=windows-1252;
 name="server.py"
Content-Transfer-Encoding: base64
Content-Disposition: attachment;
 filename="server.py"

IiIiSFRUUCBzZXJ2ZXIgY2xhc3Nlcy4KCk5vdGU6IEJhc2VIVFRQUmVxdWVzdEhhbmRsZXIg
ZG9lc24ndCBpbXBsZW1lbnQgYW55IEhUVFAgcmVxdWVzdDsgc2VlClNpbXBsZUhUVFBSZXF1
ZXN0SGFuZGxlciBmb3Igc2ltcGxlIGltcGxlbWVudGF0aW9ucyBvZiBHRVQsIEhFQUQgYW5k
IFBPU1QsCmFuZCBDR0lIVFRQUmVxdWVzdEhhbmRsZXIgZm9yIENHSSBzY3JpcHRzLgoKSXQg
ZG9lcywgaG93ZXZlciwgb3B0aW9uYWxseSBpbXBsZW1lbnQgSFRUUC8xLjEgcGVyc2lzdGVu
dCBjb25uZWN0aW9ucywKYXMgb2YgdmVyc2lvbiAwLjMuCgpOb3RlcyBvbiBDR0lIVFRQUmVx
dWVzdEhhbmRsZXIKLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgpUaGlzIGNsYXNz
IGltcGxlbWVudHMgR0VUIGFuZCBQT1NUIHJlcXVlc3RzIHRvIGNnaS1iaW4gc2NyaXB0cy4K
CklmIHRoZSBvcy5mb3JrKCkgZnVuY3Rpb24gaXMgbm90IHByZXNlbnQgKGUuZy4gb24gV2lu
ZG93cyksCnN1YnByb2Nlc3MuUG9wZW4oKSBpcyB1c2VkIGFzIGEgZmFsbGJhY2ssIHdpdGgg
c2xpZ2h0bHkgYWx0ZXJlZCBzZW1hbnRpY3MuCgpJbiBhbGwgY2FzZXMsIHRoZSBpbXBsZW1l
bnRhdGlvbiBpcyBpbnRlbnRpb25hbGx5IG5haXZlIC0tIGFsbApyZXF1ZXN0cyBhcmUgZXhl
Y3V0ZWQgc3luY2hyb25vdXNseS4KClNFQ1VSSVRZIFdBUk5JTkc6IERPTidUIFVTRSBUSElT
IENPREUgVU5MRVNTIFlPVSBBUkUgSU5TSURFIEEgRklSRVdBTEwKLS0gaXQgbWF5IGV4ZWN1
dGUgYXJiaXRyYXJ5IFB5dGhvbiBjb2RlIG9yIGV4dGVybmFsIHByb2dyYW1zLgoKTm90ZSB0
aGF0IHN0YXR1cyBjb2RlIDIwMCBpcyBzZW50IHByaW9yIHRvIGV4ZWN1dGlvbiBvZiBhIENH
SSBzY3JpcHQsIHNvCnNjcmlwdHMgY2Fubm90IHNlbmQgb3RoZXIgc3RhdHVzIGNvZGVzIHN1
Y2ggYXMgMzAyIChyZWRpcmVjdCkuCgpYWFggVG8gZG86CgotIGxvZyByZXF1ZXN0cyBldmVu
IGxhdGVyICh0byBjYXB0dXJlIGJ5dGUgY291bnQpCi0gbG9nIHVzZXItYWdlbnQgaGVhZGVy
IGFuZCBvdGhlciBpbnRlcmVzdGluZyBnb29kaWVzCi0gc2VuZCBlcnJvciBsb2cgdG8gc2Vw
YXJhdGUgZmlsZQoiIiIKCnByaW50KCJHbGVubidzIHNlcnZlciBpbXBvcnRlZCIpCgojIFNl
ZSBhbHNvOgojCiMgSFRUUCBXb3JraW5nIEdyb3VwICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIFQuIEJlcm5lcnMtTGVlCiMgSU5URVJORVQtRFJBRlQgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFIuIFQuIEZpZWxkaW5nCiMg
PGRyYWZ0LWlldGYtaHR0cC12MTAtc3BlYy0wMC50eHQ+ICAgICAgICAgICAgICAgICAgICAg
SC4gRnJ5c3R5ayBOaWVsc2VuCiMgRXhwaXJlcyBTZXB0ZW1iZXIgOCwgMTk5NSAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBNYXJjaCA4LCAxOTk1CiMKIyBVUkw6IGh0dHA6
Ly93d3cuaWNzLnVjaS5lZHUvcHViL2lldGYvaHR0cC9kcmFmdC1pZXRmLWh0dHAtdjEwLXNw
ZWMtMDAudHh0CiMKIyBhbmQKIwojIE5ldHdvcmsgV29ya2luZyBHcm91cCAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgUi4gRmllbGRpbmcKIyBSZXF1ZXN0IGZvciBD
b21tZW50czogMjYxNiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV0
IGFsCiMgT2Jzb2xldGVzOiAyMDY4ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIEp1bmUgMTk5OQojIENhdGVnb3J5OiBTdGFuZGFyZHMgVHJhY2sKIwoj
IFVSTDogaHR0cDovL3d3dy5mYXFzLm9yZy9yZmNzL3JmYzI2MTYuaHRtbAoKIyBMb2cgZmls
ZXMKIyAtLS0tLS0tLS0KIwojIEhlcmUncyBhIHF1b3RlIGZyb20gdGhlIE5DU0EgaHR0cGQg
ZG9jcyBhYm91dCBsb2cgZmlsZSBmb3JtYXQuCiMKIyB8IFRoZSBsb2dmaWxlIGZvcm1hdCBp
cyBhcyBmb2xsb3dzLiBFYWNoIGxpbmUgY29uc2lzdHMgb2Y6CiMgfAojIHwgaG9zdCByZmM5
MzEgYXV0aHVzZXIgW0REL01vbi9ZWVlZOmhoOm1tOnNzXSAicmVxdWVzdCIgZGRkIGJiYmIK
IyB8CiMgfCAgICAgICAgaG9zdDogRWl0aGVyIHRoZSBETlMgbmFtZSBvciB0aGUgSVAgbnVt
YmVyIG9mIHRoZSByZW1vdGUgY2xpZW50CiMgfCAgICAgICAgcmZjOTMxOiBBbnkgaW5mb3Jt
YXRpb24gcmV0dXJuZWQgYnkgaWRlbnRkIGZvciB0aGlzIHBlcnNvbiwKIyB8ICAgICAgICAg
ICAgICAgIC0gb3RoZXJ3aXNlLgojIHwgICAgICAgIGF1dGh1c2VyOiBJZiB1c2VyIHNlbnQg
YSB1c2VyaWQgZm9yIGF1dGhlbnRpY2F0aW9uLCB0aGUgdXNlciBuYW1lLAojIHwgICAgICAg
ICAgICAgICAgICAtIG90aGVyd2lzZS4KIyB8ICAgICAgICBERDogRGF5CiMgfCAgICAgICAg
TW9uOiBNb250aCAoY2FsZW5kYXIgbmFtZSkKIyB8ICAgICAgICBZWVlZOiBZZWFyCiMgfCAg
ICAgICAgaGg6IGhvdXIgKDI0LWhvdXIgZm9ybWF0LCB0aGUgbWFjaGluZSdzIHRpbWV6b25l
KQojIHwgICAgICAgIG1tOiBtaW51dGVzCiMgfCAgICAgICAgc3M6IHNlY29uZHMKIyB8ICAg
ICAgICByZXF1ZXN0OiBUaGUgZmlyc3QgbGluZSBvZiB0aGUgSFRUUCByZXF1ZXN0IGFzIHNl
bnQgYnkgdGhlIGNsaWVudC4KIyB8ICAgICAgICBkZGQ6IHRoZSBzdGF0dXMgY29kZSByZXR1
cm5lZCBieSB0aGUgc2VydmVyLCAtIGlmIG5vdCBhdmFpbGFibGUuCiMgfCAgICAgICAgYmJi
YjogdGhlIHRvdGFsIG51bWJlciBvZiBieXRlcyBzZW50LAojIHwgICAgICAgICAgICAgICpu
b3QgaW5jbHVkaW5nIHRoZSBIVFRQLzEuMCBoZWFkZXIqLCAtIGlmIG5vdCBhdmFpbGFibGUK
IyB8CiMgfCBZb3UgY2FuIGRldGVybWluZSB0aGUgbmFtZSBvZiB0aGUgZmlsZSBhY2Nlc3Nl
ZCB0aHJvdWdoIHJlcXVlc3QuCiMKIyAoQWN0dWFsbHksIHRoZSBsYXR0ZXIgaXMgb25seSB0
cnVlIGlmIHlvdSBrbm93IHRoZSBzZXJ2ZXIgY29uZmlndXJhdGlvbgojIGF0IHRoZSB0aW1l
IHRoZSByZXF1ZXN0IHdhcyBtYWRlISkKCl9fdmVyc2lvbl9fID0gIjAuNiIKCl9fYWxsX18g
PSBbIkhUVFBTZXJ2ZXIiLCAiQmFzZUhUVFBSZXF1ZXN0SGFuZGxlciJdCgppbXBvcnQgaHRt
bAppbXBvcnQgZW1haWwubWVzc2FnZQppbXBvcnQgZW1haWwucGFyc2VyCmltcG9ydCBodHRw
LmNsaWVudAppbXBvcnQgaW8KaW1wb3J0IG1pbWV0eXBlcwppbXBvcnQgb3MKaW1wb3J0IHBv
c2l4cGF0aAppbXBvcnQgc2VsZWN0CmltcG9ydCBzaHV0aWwKaW1wb3J0IHNvY2tldCAjIEZv
ciBnZXRob3N0YnlhZGRyKCkKaW1wb3J0IHNvY2tldHNlcnZlcgppbXBvcnQgc3lzCmltcG9y
dCB0aW1lCmltcG9ydCB1cmxsaWIucGFyc2UKaW1wb3J0IGNvcHkKCiMgRGVmYXVsdCBlcnJv
ciBtZXNzYWdlIHRlbXBsYXRlCkRFRkFVTFRfRVJST1JfTUVTU0FHRSA9ICIiIlwKPCFET0NU
WVBFIEhUTUwgUFVCTElDICItLy9XM0MvL0RURCBIVE1MIDQuMDEvL0VOIgogICAgICAgICJo
dHRwOi8vd3d3LnczLm9yZy9UUi9odG1sNC9zdHJpY3QuZHRkIj4KPGh0bWw+CiAgICA8aGVh
ZD4KICAgICAgICA8bWV0YSBodHRwLWVxdWl2PSJDb250ZW50LVR5cGUiIGNvbnRlbnQ9InRl
eHQvaHRtbDtjaGFyc2V0PXV0Zi04Ij4KICAgICAgICA8dGl0bGU+RXJyb3IgcmVzcG9uc2U8
L3RpdGxlPgogICAgPC9oZWFkPgogICAgPGJvZHk+CiAgICAgICAgPGgxPkVycm9yIHJlc3Bv
bnNlPC9oMT4KICAgICAgICA8cD5FcnJvciBjb2RlOiAlKGNvZGUpZDwvcD4KICAgICAgICA8
cD5NZXNzYWdlOiAlKG1lc3NhZ2Upcy48L3A+CiAgICAgICAgPHA+RXJyb3IgY29kZSBleHBs
YW5hdGlvbjogJShjb2RlKXMgLSAlKGV4cGxhaW4pcy48L3A+CiAgICA8L2JvZHk+CjwvaHRt
bD4KIiIiCgpERUZBVUxUX0VSUk9SX0NPTlRFTlRfVFlQRSA9ICJ0ZXh0L2h0bWw7Y2hhcnNl
dD11dGYtOCIKCmRlZiBfcXVvdGVfaHRtbChodG1sKToKICAgIHJldHVybiBodG1sLnJlcGxh
Y2UoIiYiLCAiJmFtcDsiKS5yZXBsYWNlKCI8IiwgIiZsdDsiKS5yZXBsYWNlKCI+IiwgIiZn
dDsiKQoKY2xhc3MgSFRUUFNlcnZlcihzb2NrZXRzZXJ2ZXIuVENQU2VydmVyKToKCiAgICBh
bGxvd19yZXVzZV9hZGRyZXNzID0gMSAgICAjIFNlZW1zIHRvIG1ha2Ugc2Vuc2UgaW4gdGVz
dGluZyBlbnZpcm9ubWVudAoKICAgIGRlZiBzZXJ2ZXJfYmluZChzZWxmKToKICAgICAgICAi
IiJPdmVycmlkZSBzZXJ2ZXJfYmluZCB0byBzdG9yZSB0aGUgc2VydmVyIG5hbWUuIiIiCiAg
ICAgICAgc29ja2V0c2VydmVyLlRDUFNlcnZlci5zZXJ2ZXJfYmluZChzZWxmKQogICAgICAg
IGhvc3QsIHBvcnQgPSBzZWxmLnNvY2tldC5nZXRzb2NrbmFtZSgpWzoyXQogICAgICAgIHNl
bGYuc2VydmVyX25hbWUgPSBzb2NrZXQuZ2V0ZnFkbihob3N0KQogICAgICAgIHNlbGYuc2Vy
dmVyX3BvcnQgPSBwb3J0CgoKY2xhc3MgQmFzZUhUVFBSZXF1ZXN0SGFuZGxlcihzb2NrZXRz
ZXJ2ZXIuU3RyZWFtUmVxdWVzdEhhbmRsZXIpOgoKICAgICIiIkhUVFAgcmVxdWVzdCBoYW5k
bGVyIGJhc2UgY2xhc3MuCgogICAgVGhlIGZvbGxvd2luZyBleHBsYW5hdGlvbiBvZiBIVFRQ
IHNlcnZlcyB0byBndWlkZSB5b3UgdGhyb3VnaCB0aGUKICAgIGNvZGUgYXMgd2VsbCBhcyB0
byBleHBvc2UgYW55IG1pc3VuZGVyc3RhbmRpbmdzIEkgbWF5IGhhdmUgYWJvdXQKICAgIEhU
VFAgKHNvIHlvdSBkb24ndCBuZWVkIHRvIHJlYWQgdGhlIGNvZGUgdG8gZmlndXJlIG91dCBJ
J20gd3JvbmcKICAgIDotKS4KCiAgICBIVFRQIChIeXBlclRleHQgVHJhbnNmZXIgUHJvdG9j
b2wpIGlzIGFuIGV4dGVuc2libGUgcHJvdG9jb2wgb24KICAgIHRvcCBvZiBhIHJlbGlhYmxl
IHN0cmVhbSB0cmFuc3BvcnQgKGUuZy4gVENQL0lQKS4gIFRoZSBwcm90b2NvbAogICAgcmVj
b2duaXplcyB0aHJlZSBwYXJ0cyB0byBhIHJlcXVlc3Q6CgogICAgMS4gT25lIGxpbmUgaWRl
bnRpZnlpbmcgdGhlIHJlcXVlc3QgdHlwZSBhbmQgcGF0aAogICAgMi4gQW4gb3B0aW9uYWwg
c2V0IG9mIFJGQy04MjItc3R5bGUgaGVhZGVycwogICAgMy4gQW4gb3B0aW9uYWwgZGF0YSBw
YXJ0CgogICAgVGhlIGhlYWRlcnMgYW5kIGRhdGEgYXJlIHNlcGFyYXRlZCBieSBhIGJsYW5r
IGxpbmUuCgogICAgVGhlIGZpcnN0IGxpbmUgb2YgdGhlIHJlcXVlc3QgaGFzIHRoZSBmb3Jt
CgogICAgPGNvbW1hbmQ+IDxwYXRoPiA8dmVyc2lvbj4KCiAgICB3aGVyZSA8Y29tbWFuZD4g
aXMgYSAoY2FzZS1zZW5zaXRpdmUpIGtleXdvcmQgc3VjaCBhcyBHRVQgb3IgUE9TVCwKICAg
IDxwYXRoPiBpcyBhIHN0cmluZyBjb250YWluaW5nIHBhdGggaW5mb3JtYXRpb24gZm9yIHRo
ZSByZXF1ZXN0LAogICAgYW5kIDx2ZXJzaW9uPiBzaG91bGQgYmUgdGhlIHN0cmluZyAiSFRU
UC8xLjAiIG9yICJIVFRQLzEuMSIuCiAgICA8cGF0aD4gaXMgZW5jb2RlZCB1c2luZyB0aGUg
VVJMIGVuY29kaW5nIHNjaGVtZSAodXNpbmcgJXh4IHRvIHNpZ25pZnkKICAgIHRoZSBBU0NJ
SSBjaGFyYWN0ZXIgd2l0aCBoZXggY29kZSB4eCkuCgogICAgVGhlIHNwZWNpZmljYXRpb24g
c3BlY2lmaWVzIHRoYXQgbGluZXMgYXJlIHNlcGFyYXRlZCBieSBDUkxGIGJ1dAogICAgZm9y
IGNvbXBhdGliaWxpdHkgd2l0aCB0aGUgd2lkZXN0IHJhbmdlIG9mIGNsaWVudHMgcmVjb21t
ZW5kcwogICAgc2VydmVycyBhbHNvIGhhbmRsZSBMRi4gIFNpbWlsYXJseSwgd2hpdGVzcGFj
ZSBpbiB0aGUgcmVxdWVzdCBsaW5lCiAgICBpcyB0cmVhdGVkIHNlbnNpYmx5IChhbGxvd2lu
ZyBtdWx0aXBsZSBzcGFjZXMgYmV0d2VlbiBjb21wb25lbnRzCiAgICBhbmQgYWxsb3dpbmcg
dHJhaWxpbmcgd2hpdGVzcGFjZSkuCgogICAgU2ltaWxhcmx5LCBmb3Igb3V0cHV0LCBsaW5l
cyBvdWdodCB0byBiZSBzZXBhcmF0ZWQgYnkgQ1JMRiBwYWlycwogICAgYnV0IG1vc3QgY2xp
ZW50cyBncm9rIExGIGNoYXJhY3RlcnMganVzdCBmaW5lLgoKICAgIElmIHRoZSBmaXJzdCBs
aW5lIG9mIHRoZSByZXF1ZXN0IGhhcyB0aGUgZm9ybQoKICAgIDxjb21tYW5kPiA8cGF0aD4K
CiAgICAoaS5lLiA8dmVyc2lvbj4gaXMgbGVmdCBvdXQpIHRoZW4gdGhpcyBpcyBhc3N1bWVk
IHRvIGJlIGFuIEhUVFAKICAgIDAuOSByZXF1ZXN0OyB0aGlzIGZvcm0gaGFzIG5vIG9wdGlv
bmFsIGhlYWRlcnMgYW5kIGRhdGEgcGFydCBhbmQKICAgIHRoZSByZXBseSBjb25zaXN0cyBv
ZiBqdXN0IHRoZSBkYXRhLgoKICAgIFRoZSByZXBseSBmb3JtIG9mIHRoZSBIVFRQIDEueCBw
cm90b2NvbCBhZ2FpbiBoYXMgdGhyZWUgcGFydHM6CgogICAgMS4gT25lIGxpbmUgZ2l2aW5n
IHRoZSByZXNwb25zZSBjb2RlCiAgICAyLiBBbiBvcHRpb25hbCBzZXQgb2YgUkZDLTgyMi1z
dHlsZSBoZWFkZXJzCiAgICAzLiBUaGUgZGF0YQoKICAgIEFnYWluLCB0aGUgaGVhZGVycyBh
bmQgZGF0YSBhcmUgc2VwYXJhdGVkIGJ5IGEgYmxhbmsgbGluZS4KCiAgICBUaGUgcmVzcG9u
c2UgY29kZSBsaW5lIGhhcyB0aGUgZm9ybQoKICAgIDx2ZXJzaW9uPiA8cmVzcG9uc2Vjb2Rl
PiA8cmVzcG9uc2VzdHJpbmc+CgogICAgd2hlcmUgPHZlcnNpb24+IGlzIHRoZSBwcm90b2Nv
bCB2ZXJzaW9uICgiSFRUUC8xLjAiIG9yICJIVFRQLzEuMSIpLAogICAgPHJlc3BvbnNlY29k
ZT4gaXMgYSAzLWRpZ2l0IHJlc3BvbnNlIGNvZGUgaW5kaWNhdGluZyBzdWNjZXNzIG9yCiAg
ICBmYWlsdXJlIG9mIHRoZSByZXF1ZXN0LCBhbmQgPHJlc3BvbnNlc3RyaW5nPiBpcyBhbiBv
cHRpb25hbAogICAgaHVtYW4tcmVhZGFibGUgc3RyaW5nIGV4cGxhaW5pbmcgd2hhdCB0aGUg
cmVzcG9uc2UgY29kZSBtZWFucy4KCiAgICBUaGlzIHNlcnZlciBwYXJzZXMgdGhlIHJlcXVl
c3QgYW5kIHRoZSBoZWFkZXJzLCBhbmQgdGhlbiBjYWxscyBhCiAgICBmdW5jdGlvbiBzcGVj
aWZpYyB0byB0aGUgcmVxdWVzdCB0eXBlICg8Y29tbWFuZD4pLiAgU3BlY2lmaWNhbGx5LAog
ICAgYSByZXF1ZXN0IFNQQU0gd2lsbCBiZSBoYW5kbGVkIGJ5IGEgbWV0aG9kIGRvX1NQQU0o
KS4gIElmIG5vCiAgICBzdWNoIG1ldGhvZCBleGlzdHMgdGhlIHNlcnZlciBzZW5kcyBhbiBl
cnJvciByZXNwb25zZSB0byB0aGUKICAgIGNsaWVudC4gIElmIGl0IGV4aXN0cywgaXQgaXMg
Y2FsbGVkIHdpdGggbm8gYXJndW1lbnRzOgoKICAgIGRvX1NQQU0oKQoKICAgIE5vdGUgdGhh
dCB0aGUgcmVxdWVzdCBuYW1lIGlzIGNhc2Ugc2Vuc2l0aXZlIChpLmUuIFNQQU0gYW5kIHNw
YW0KICAgIGFyZSBkaWZmZXJlbnQgcmVxdWVzdHMpLgoKICAgIFRoZSB2YXJpb3VzIHJlcXVl
c3QgZGV0YWlscyBhcmUgc3RvcmVkIGluIGluc3RhbmNlIHZhcmlhYmxlczoKCiAgICAtIGNs
aWVudF9hZGRyZXNzIGlzIHRoZSBjbGllbnQgSVAgYWRkcmVzcyBpbiB0aGUgZm9ybSAoaG9z
dCwKICAgIHBvcnQpOwoKICAgIC0gY29tbWFuZCwgcGF0aCBhbmQgdmVyc2lvbiBhcmUgdGhl
IGJyb2tlbi1kb3duIHJlcXVlc3QgbGluZTsKCiAgICAtIGhlYWRlcnMgaXMgYW4gaW5zdGFu
Y2Ugb2YgZW1haWwubWVzc2FnZS5NZXNzYWdlIChvciBhIGRlcml2ZWQKICAgIGNsYXNzKSBj
b250YWluaW5nIHRoZSBoZWFkZXIgaW5mb3JtYXRpb247CgogICAgLSByZmlsZSBpcyBhIGZp
bGUgb2JqZWN0IG9wZW4gZm9yIHJlYWRpbmcgcG9zaXRpb25lZCBhdCB0aGUKICAgIHN0YXJ0
IG9mIHRoZSBvcHRpb25hbCBpbnB1dCBkYXRhIHBhcnQ7CgogICAgLSB3ZmlsZSBpcyBhIGZp
bGUgb2JqZWN0IG9wZW4gZm9yIHdyaXRpbmcuCgogICAgSVQgSVMgSU1QT1JUQU5UIFRPIEFE
SEVSRSBUTyBUSEUgUFJPVE9DT0wgRk9SIFdSSVRJTkchCgogICAgVGhlIGZpcnN0IHRoaW5n
IHRvIGJlIHdyaXR0ZW4gbXVzdCBiZSB0aGUgcmVzcG9uc2UgbGluZS4gIFRoZW4KICAgIGZv
bGxvdyAwIG9yIG1vcmUgaGVhZGVyIGxpbmVzLCB0aGVuIGEgYmxhbmsgbGluZSwgYW5kIHRo
ZW4gdGhlCiAgICBhY3R1YWwgZGF0YSAoaWYgYW55KS4gIFRoZSBtZWFuaW5nIG9mIHRoZSBo
ZWFkZXIgbGluZXMgZGVwZW5kcyBvbgogICAgdGhlIGNvbW1hbmQgZXhlY3V0ZWQgYnkgdGhl
IHNlcnZlcjsgaW4gbW9zdCBjYXNlcywgd2hlbiBkYXRhIGlzCiAgICByZXR1cm5lZCwgdGhl
cmUgc2hvdWxkIGJlIGF0IGxlYXN0IG9uZSBoZWFkZXIgbGluZSBvZiB0aGUgZm9ybQoKICAg
IENvbnRlbnQtdHlwZTogPHR5cGU+LzxzdWJ0eXBlPgoKICAgIHdoZXJlIDx0eXBlPiBhbmQg
PHN1YnR5cGU+IHNob3VsZCBiZSByZWdpc3RlcmVkIE1JTUUgdHlwZXMsCiAgICBlLmcuICJ0
ZXh0L2h0bWwiIG9yICJ0ZXh0L3BsYWluIi4KCiAgICAiIiIKCiAgICAjIFRoZSBQeXRob24g
c3lzdGVtIHZlcnNpb24sIHRydW5jYXRlZCB0byBpdHMgZmlyc3QgY29tcG9uZW50LgogICAg
c3lzX3ZlcnNpb24gPSAiUHl0aG9uLyIgKyBzeXMudmVyc2lvbi5zcGxpdCgpWzBdCgogICAg
IyBUaGUgc2VydmVyIHNvZnR3YXJlIHZlcnNpb24uICBZb3UgbWF5IHdhbnQgdG8gb3ZlcnJp
ZGUgdGhpcy4KICAgICMgVGhlIGZvcm1hdCBpcyBtdWx0aXBsZSB3aGl0ZXNwYWNlLXNlcGFy
YXRlZCBzdHJpbmdzLAogICAgIyB3aGVyZSBlYWNoIHN0cmluZyBpcyBvZiB0aGUgZm9ybSBu
YW1lWy92ZXJzaW9uXS4KICAgIHNlcnZlcl92ZXJzaW9uID0gIkJhc2VIVFRQLyIgKyBfX3Zl
cnNpb25fXwoKICAgIGVycm9yX21lc3NhZ2VfZm9ybWF0ID0gREVGQVVMVF9FUlJPUl9NRVNT
QUdFCiAgICBlcnJvcl9jb250ZW50X3R5cGUgPSBERUZBVUxUX0VSUk9SX0NPTlRFTlRfVFlQ
RQoKICAgICMgVGhlIGRlZmF1bHQgcmVxdWVzdCB2ZXJzaW9uLiAgVGhpcyBvbmx5IGFmZmVj
dHMgcmVzcG9uc2VzIHVwIHVudGlsCiAgICAjIHRoZSBwb2ludCB3aGVyZSB0aGUgcmVxdWVz
dCBsaW5lIGlzIHBhcnNlZCwgc28gaXQgbWFpbmx5IGRlY2lkZXMgd2hhdAogICAgIyB0aGUg
Y2xpZW50IGdldHMgYmFjayB3aGVuIHNlbmRpbmcgYSBtYWxmb3JtZWQgcmVxdWVzdCBsaW5l
LgogICAgIyBNb3N0IHdlYiBzZXJ2ZXJzIGRlZmF1bHQgdG8gSFRUUCAwLjksIGkuZS4gZG9u
J3Qgc2VuZCBhIHN0YXR1cyBsaW5lLgogICAgZGVmYXVsdF9yZXF1ZXN0X3ZlcnNpb24gPSAi
SFRUUC8wLjkiCgogICAgZGVmIHBhcnNlX3JlcXVlc3Qoc2VsZik6CiAgICAgICAgIiIiUGFy
c2UgYSByZXF1ZXN0IChpbnRlcm5hbCkuCgogICAgICAgIFRoZSByZXF1ZXN0IHNob3VsZCBi
ZSBzdG9yZWQgaW4gc2VsZi5yYXdfcmVxdWVzdGxpbmU7IHRoZSByZXN1bHRzCiAgICAgICAg
YXJlIGluIHNlbGYuY29tbWFuZCwgc2VsZi5wYXRoLCBzZWxmLnJlcXVlc3RfdmVyc2lvbiBh
bmQKICAgICAgICBzZWxmLmhlYWRlcnMuCgogICAgICAgIFJldHVybiBUcnVlIGZvciBzdWNj
ZXNzLCBGYWxzZSBmb3IgZmFpbHVyZTsgb24gZmFpbHVyZSwgYW4KICAgICAgICBlcnJvciBp
cyBzZW50IGJhY2suCgogICAgICAgICIiIgogICAgICAgIHNlbGYuY29tbWFuZCA9IE5vbmUg
ICMgc2V0IGluIGNhc2Ugb2YgZXJyb3Igb24gdGhlIGZpcnN0IGxpbmUKICAgICAgICBzZWxm
LnJlcXVlc3RfdmVyc2lvbiA9IHZlcnNpb24gPSBzZWxmLmRlZmF1bHRfcmVxdWVzdF92ZXJz
aW9uCiAgICAgICAgc2VsZi5jbG9zZV9jb25uZWN0aW9uID0gMQogICAgICAgIHJlcXVlc3Rs
aW5lID0gc3RyKHNlbGYucmF3X3JlcXVlc3RsaW5lLCAnaXNvLTg4NTktMScpCiAgICAgICAg
aWYgcmVxdWVzdGxpbmVbLTI6XSA9PSAnXHJcbic6CiAgICAgICAgICAgIHJlcXVlc3RsaW5l
ID0gcmVxdWVzdGxpbmVbOi0yXQogICAgICAgIGVsaWYgcmVxdWVzdGxpbmVbLTE6XSA9PSAn
XG4nOgogICAgICAgICAgICByZXF1ZXN0bGluZSA9IHJlcXVlc3RsaW5lWzotMV0KICAgICAg
ICBzZWxmLnJlcXVlc3RsaW5lID0gcmVxdWVzdGxpbmUKICAgICAgICB3b3JkcyA9IHJlcXVl
c3RsaW5lLnNwbGl0KCkKICAgICAgICBpZiBsZW4od29yZHMpID09IDM6CiAgICAgICAgICAg
IGNvbW1hbmQsIHBhdGgsIHZlcnNpb24gPSB3b3JkcwogICAgICAgICAgICBpZiB2ZXJzaW9u
Wzo1XSAhPSAnSFRUUC8nOgogICAgICAgICAgICAgICAgc2VsZi5zZW5kX2Vycm9yKDQwMCwg
IkJhZCByZXF1ZXN0IHZlcnNpb24gKCVyKSIgJSB2ZXJzaW9uKQogICAgICAgICAgICAgICAg
cmV0dXJuIEZhbHNlCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGJhc2VfdmVy
c2lvbl9udW1iZXIgPSB2ZXJzaW9uLnNwbGl0KCcvJywgMSlbMV0KICAgICAgICAgICAgICAg
IHZlcnNpb25fbnVtYmVyID0gYmFzZV92ZXJzaW9uX251bWJlci5zcGxpdCgiLiIpCiAgICAg
ICAgICAgICAgICAjIFJGQyAyMTQ1IHNlY3Rpb24gMy4xIHNheXMgdGhlcmUgY2FuIGJlIG9u
bHkgb25lICIuIiBhbmQKICAgICAgICAgICAgICAgICMgICAtIG1ham9yIGFuZCBtaW5vciBu
dW1iZXJzIE1VU1QgYmUgdHJlYXRlZCBhcwogICAgICAgICAgICAgICAgIyAgICAgIHNlcGFy
YXRlIGludGVnZXJzOwogICAgICAgICAgICAgICAgIyAgIC0gSFRUUC8yLjQgaXMgYSBsb3dl
ciB2ZXJzaW9uIHRoYW4gSFRUUC8yLjEzLCB3aGljaCBpbgogICAgICAgICAgICAgICAgIyAg
ICAgIHR1cm4gaXMgbG93ZXIgdGhhbiBIVFRQLzEyLjM7CiAgICAgICAgICAgICAgICAjICAg
LSBMZWFkaW5nIHplcm9zIE1VU1QgYmUgaWdub3JlZCBieSByZWNpcGllbnRzLgogICAgICAg
ICAgICAgICAgaWYgbGVuKHZlcnNpb25fbnVtYmVyKSAhPSAyOgogICAgICAgICAgICAgICAg
ICAgIHJhaXNlIFZhbHVlRXJyb3IKICAgICAgICAgICAgICAgIHZlcnNpb25fbnVtYmVyID0g
aW50KHZlcnNpb25fbnVtYmVyWzBdKSwgaW50KHZlcnNpb25fbnVtYmVyWzFdKQogICAgICAg
ICAgICBleGNlcHQgKFZhbHVlRXJyb3IsIEluZGV4RXJyb3IpOgogICAgICAgICAgICAgICAg
c2VsZi5zZW5kX2Vycm9yKDQwMCwgIkJhZCByZXF1ZXN0IHZlcnNpb24gKCVyKSIgJSB2ZXJz
aW9uKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIGlmIHZlcnNp
b25fbnVtYmVyID49ICgxLCAxKSBhbmQgc2VsZi5wcm90b2NvbF92ZXJzaW9uID49ICJIVFRQ
LzEuMSI6CiAgICAgICAgICAgICAgICBzZWxmLmNsb3NlX2Nvbm5lY3Rpb24gPSAwCiAgICAg
ICAgICAgIGlmIHZlcnNpb25fbnVtYmVyID49ICgyLCAwKToKICAgICAgICAgICAgICAgIHNl
bGYuc2VuZF9lcnJvcig1MDUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgIkludmFsaWQg
SFRUUCBWZXJzaW9uICglcykiICUgYmFzZV92ZXJzaW9uX251bWJlcikKICAgICAgICAgICAg
ICAgIHJldHVybiBGYWxzZQogICAgICAgIGVsaWYgbGVuKHdvcmRzKSA9PSAyOgogICAgICAg
ICAgICBjb21tYW5kLCBwYXRoID0gd29yZHMKICAgICAgICAgICAgc2VsZi5jbG9zZV9jb25u
ZWN0aW9uID0gMQogICAgICAgICAgICBpZiBjb21tYW5kICE9ICdHRVQnOgogICAgICAgICAg
ICAgICAgc2VsZi5zZW5kX2Vycm9yKDQwMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAiQmFkIEhUVFAvMC45IHJlcXVlc3QgdHlwZSAoJXIpIiAlIGNvbW1hbmQpCiAgICAg
ICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICBlbGlmIG5vdCB3b3JkczoKICAgICAg
ICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgZWxzZToKICAgICAgICAgICAgc2VsZi5zZW5k
X2Vycm9yKDQwMCwgIkJhZCByZXF1ZXN0IHN5bnRheCAoJXIpIiAlIHJlcXVlc3RsaW5lKQog
ICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICBzZWxmLnBhdGgsIHNlbGYucXVlcnks
IHNlbGYuZnJhZyA9IHBhcnNlX3VybCggcGF0aCApCiAgICAgICAgc2VsZi5jb21tYW5kLCBz
ZWxmLnJlcXVlc3RfdmVyc2lvbiA9IGNvbW1hbmQsIHZlcnNpb24KCiAgICAgICAgIyBFeGFt
aW5lIHRoZSBoZWFkZXJzIGFuZCBsb29rIGZvciBhIENvbm5lY3Rpb24gZGlyZWN0aXZlLgog
ICAgICAgIHRyeToKICAgICAgICAgICAgc2VsZi5oZWFkZXJzID0gaHR0cC5jbGllbnQucGFy
c2VfaGVhZGVycyhzZWxmLnJmaWxlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIF9jbGFzcz1zZWxmLk1lc3NhZ2VDbGFzcykKICAgICAg
ICBleGNlcHQgaHR0cC5jbGllbnQuTGluZVRvb0xvbmc6CiAgICAgICAgICAgIHNlbGYuc2Vu
ZF9lcnJvcig0MDAsICJMaW5lIHRvbyBsb25nIikKICAgICAgICAgICAgcmV0dXJuIEZhbHNl
CgogICAgICAgIGNvbm50eXBlID0gc2VsZi5oZWFkZXJzLmdldCgnQ29ubmVjdGlvbicsICIi
KQogICAgICAgIGlmIGNvbm50eXBlLmxvd2VyKCkgPT0gJ2Nsb3NlJzoKICAgICAgICAgICAg
c2VsZi5jbG9zZV9jb25uZWN0aW9uID0gMQogICAgICAgIGVsaWYgKGNvbm50eXBlLmxvd2Vy
KCkgPT0gJ2tlZXAtYWxpdmUnIGFuZAogICAgICAgICAgICAgIHNlbGYucHJvdG9jb2xfdmVy
c2lvbiA+PSAiSFRUUC8xLjEiKToKICAgICAgICAgICAgc2VsZi5jbG9zZV9jb25uZWN0aW9u
ID0gMAogICAgICAgICMgRXhhbWluZSB0aGUgaGVhZGVycyBhbmQgbG9vayBmb3IgYW4gRXhw
ZWN0IGRpcmVjdGl2ZQogICAgICAgIGV4cGVjdCA9IHNlbGYuaGVhZGVycy5nZXQoJ0V4cGVj
dCcsICIiKQogICAgICAgIGlmIChleHBlY3QubG93ZXIoKSA9PSAiMTAwLWNvbnRpbnVlIiBh
bmQKICAgICAgICAgICAgICAgIHNlbGYucHJvdG9jb2xfdmVyc2lvbiA+PSAiSFRUUC8xLjEi
IGFuZAogICAgICAgICAgICAgICAgc2VsZi5yZXF1ZXN0X3ZlcnNpb24gPj0gIkhUVFAvMS4x
Iik6CiAgICAgICAgICAgIGlmIG5vdCBzZWxmLmhhbmRsZV9leHBlY3RfMTAwKCk6CiAgICAg
ICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICByZXR1cm4gVHJ1ZQoKICAgIGRlZiBo
YW5kbGVfZXhwZWN0XzEwMChzZWxmKToKICAgICAgICAiIiJEZWNpZGUgd2hhdCB0byBkbyB3
aXRoIGFuICJFeHBlY3Q6IDEwMC1jb250aW51ZSIgaGVhZGVyLgoKICAgICAgICBJZiB0aGUg
Y2xpZW50IGlzIGV4cGVjdGluZyBhIDEwMCBDb250aW51ZSByZXNwb25zZSwgd2UgbXVzdAog
ICAgICAgIHJlc3BvbmQgd2l0aCBlaXRoZXIgYSAxMDAgQ29udGludWUgb3IgYSBmaW5hbCBy
ZXNwb25zZSBiZWZvcmUKICAgICAgICB3YWl0aW5nIGZvciB0aGUgcmVxdWVzdCBib2R5LiBU
aGUgZGVmYXVsdCBpcyB0byBhbHdheXMgcmVzcG9uZAogICAgICAgIHdpdGggYSAxMDAgQ29u
dGludWUuIFlvdSBjYW4gYmVoYXZlIGRpZmZlcmVudGx5IChmb3IgZXhhbXBsZSwKICAgICAg
ICByZWplY3QgdW5hdXRob3JpemVkIHJlcXVlc3RzKSBieSBvdmVycmlkaW5nIHRoaXMgbWV0
aG9kLgoKICAgICAgICBUaGlzIG1ldGhvZCBzaG91bGQgZWl0aGVyIHJldHVybiBUcnVlIChw
b3NzaWJseSBhZnRlciBzZW5kaW5nCiAgICAgICAgYSAxMDAgQ29udGludWUgcmVzcG9uc2Up
IG9yIHNlbmQgYW4gZXJyb3IgcmVzcG9uc2UgYW5kIHJldHVybgogICAgICAgIEZhbHNlLgoK
ICAgICAgICAiIiIKICAgICAgICBzZWxmLnNlbmRfcmVzcG9uc2Vfb25seSgxMDApCiAgICAg
ICAgc2VsZi5mbHVzaF9oZWFkZXJzKCkKICAgICAgICByZXR1cm4gVHJ1ZQoKICAgIGRlZiBo
YW5kbGVfb25lX3JlcXVlc3Qoc2VsZik6CiAgICAgICAgIiIiSGFuZGxlIGEgc2luZ2xlIEhU
VFAgcmVxdWVzdC4KCiAgICAgICAgWW91IG5vcm1hbGx5IGRvbid0IG5lZWQgdG8gb3ZlcnJp
ZGUgdGhpcyBtZXRob2Q7IHNlZSB0aGUgY2xhc3MKICAgICAgICBfX2RvY19fIHN0cmluZyBm
b3IgaW5mb3JtYXRpb24gb24gaG93IHRvIGhhbmRsZSBzcGVjaWZpYyBIVFRQCiAgICAgICAg
Y29tbWFuZHMgc3VjaCBhcyBHRVQgYW5kIFBPU1QuCgogICAgICAgICIiIgogICAgICAgIHRy
eToKICAgICAgICAgICAgc2VsZi5yYXdfcmVxdWVzdGxpbmUgPSBzZWxmLnJmaWxlLnJlYWRs
aW5lKDY1NTM3KQogICAgICAgICAgICBpZiBsZW4oc2VsZi5yYXdfcmVxdWVzdGxpbmUpID4g
NjU1MzY6CiAgICAgICAgICAgICAgICBzZWxmLnJlcXVlc3RsaW5lID0gJycKICAgICAgICAg
ICAgICAgIHNlbGYucmVxdWVzdF92ZXJzaW9uID0gJycKICAgICAgICAgICAgICAgIHNlbGYu
Y29tbWFuZCA9ICcnCiAgICAgICAgICAgICAgICBzZWxmLnNlbmRfZXJyb3IoNDE0KQogICAg
ICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIGlmIG5vdCBzZWxmLnJhd19yZXF1ZXN0
bGluZToKICAgICAgICAgICAgICAgIHNlbGYuY2xvc2VfY29ubmVjdGlvbiA9IDEKICAgICAg
ICAgICAgICAgIHJldHVybgogICAgICAgICAgICBpZiBub3Qgc2VsZi5wYXJzZV9yZXF1ZXN0
KCk6CiAgICAgICAgICAgICAgICAjIEFuIGVycm9yIGNvZGUgaGFzIGJlZW4gc2VudCwganVz
dCBleGl0CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgbW5hbWUgPSAnZG9f
JyArIHNlbGYuY29tbWFuZAogICAgICAgICAgICBpZiBub3QgaGFzYXR0cihzZWxmLCBtbmFt
ZSk6CiAgICAgICAgICAgICAgICBzZWxmLnNlbmRfZXJyb3IoNTAxLCAiVW5zdXBwb3J0ZWQg
bWV0aG9kICglcikiICUgc2VsZi5jb21tYW5kKQogICAgICAgICAgICAgICAgcmV0dXJuCiAg
ICAgICAgICAgIG1ldGhvZCA9IGdldGF0dHIoc2VsZiwgbW5hbWUpCiAgICAgICAgICAgIG1l
dGhvZCgpCiAgICAgICAgICAgIHNlbGYud2ZpbGUuZmx1c2goKSAjYWN0dWFsbHkgc2VuZCB0
aGUgcmVzcG9uc2UgaWYgbm90IGFscmVhZHkgZG9uZS4KICAgICAgICBleGNlcHQgc29ja2V0
LnRpbWVvdXQgYXMgZToKICAgICAgICAgICAgI2EgcmVhZCBvciBhIHdyaXRlIHRpbWVkIG91
dC4gIERpc2NhcmQgdGhpcyBjb25uZWN0aW9uCiAgICAgICAgICAgIHNlbGYubG9nX2Vycm9y
KCJSZXF1ZXN0IHRpbWVkIG91dDogJXIiLCBlKQogICAgICAgICAgICBzZWxmLmNsb3NlX2Nv
bm5lY3Rpb24gPSAxCiAgICAgICAgICAgIHJldHVybgoKICAgIGRlZiBoYW5kbGUoc2VsZik6
CiAgICAgICAgIiIiSGFuZGxlIG11bHRpcGxlIHJlcXVlc3RzIGlmIG5lY2Vzc2FyeS4iIiIK
ICAgICAgICBzZWxmLmNsb3NlX2Nvbm5lY3Rpb24gPSAxCgogICAgICAgIHNlbGYuaGFuZGxl
X29uZV9yZXF1ZXN0KCkKICAgICAgICB3aGlsZSBub3Qgc2VsZi5jbG9zZV9jb25uZWN0aW9u
OgogICAgICAgICAgICBzZWxmLmhhbmRsZV9vbmVfcmVxdWVzdCgpCgogICAgZGVmIHNlbmRf
ZXJyb3Ioc2VsZiwgY29kZSwgbWVzc2FnZT1Ob25lKToKICAgICAgICAiIiJTZW5kIGFuZCBs
b2cgYW4gZXJyb3IgcmVwbHkuCgogICAgICAgIEFyZ3VtZW50cyBhcmUgdGhlIGVycm9yIGNv
ZGUsIGFuZCBhIGRldGFpbGVkIG1lc3NhZ2UuCiAgICAgICAgVGhlIGRldGFpbGVkIG1lc3Nh
Z2UgZGVmYXVsdHMgdG8gdGhlIHNob3J0IGVudHJ5IG1hdGNoaW5nIHRoZQogICAgICAgIHJl
c3BvbnNlIGNvZGUuCgogICAgICAgIFRoaXMgc2VuZHMgYW4gZXJyb3IgcmVzcG9uc2UgKHNv
IGl0IG11c3QgYmUgY2FsbGVkIGJlZm9yZSBhbnkKICAgICAgICBvdXRwdXQgaGFzIGJlZW4g
Z2VuZXJhdGVkKSwgbG9ncyB0aGUgZXJyb3IsIGFuZCBmaW5hbGx5IHNlbmRzCiAgICAgICAg
YSBwaWVjZSBvZiBIVE1MIGV4cGxhaW5pbmcgdGhlIGVycm9yIHRvIHRoZSB1c2VyLgoKICAg
ICAgICAiIiIKCiAgICAgICAgdHJ5OgogICAgICAgICAgICBzaG9ydG1zZywgbG9uZ21zZyA9
IHNlbGYucmVzcG9uc2VzW2NvZGVdCiAgICAgICAgZXhjZXB0IEtleUVycm9yOgogICAgICAg
ICAgICBzaG9ydG1zZywgbG9uZ21zZyA9ICc/Pz8nLCAnPz8/JwogICAgICAgIGlmIG1lc3Nh
Z2UgaXMgTm9uZToKICAgICAgICAgICAgbWVzc2FnZSA9IHNob3J0bXNnCiAgICAgICAgZXhw
bGFpbiA9IGxvbmdtc2cKICAgICAgICBzZWxmLmxvZ19lcnJvcigiY29kZSAlZCwgbWVzc2Fn
ZSAlcyIsIGNvZGUsIG1lc3NhZ2UpCiAgICAgICAgIyB1c2luZyBfcXVvdGVfaHRtbCB0byBw
cmV2ZW50IENyb3NzIFNpdGUgU2NyaXB0aW5nIGF0dGFja3MgKHNlZSBidWcgIzExMDAyMDEp
CiAgICAgICAgY29udGVudCA9IChzZWxmLmVycm9yX21lc3NhZ2VfZm9ybWF0ICUKICAgICAg
ICAgICAgICAgICAgIHsnY29kZSc6IGNvZGUsICdtZXNzYWdlJzogX3F1b3RlX2h0bWwobWVz
c2FnZSksICdleHBsYWluJzogZXhwbGFpbn0pCiAgICAgICAgc2VsZi5zZW5kX3Jlc3BvbnNl
KGNvZGUsIG1lc3NhZ2UpCiAgICAgICAgc2VsZi5zZW5kX2hlYWRlcigiQ29udGVudC1UeXBl
Iiwgc2VsZi5lcnJvcl9jb250ZW50X3R5cGUpCiAgICAgICAgc2VsZi5zZW5kX2hlYWRlcign
Q29ubmVjdGlvbicsICdjbG9zZScpCiAgICAgICAgc2VsZi5lbmRfaGVhZGVycygpCiAgICAg
ICAgaWYgc2VsZi5jb21tYW5kICE9ICdIRUFEJyBhbmQgY29kZSA+PSAyMDAgYW5kIGNvZGUg
bm90IGluICgyMDQsIDMwNCk6CiAgICAgICAgICAgIHNlbGYud2ZpbGUud3JpdGUoY29udGVu
dC5lbmNvZGUoJ1VURi04JywgJ3JlcGxhY2UnKSkKCiAgICBkZWYgc2VuZF9yZXNwb25zZShz
ZWxmLCBjb2RlLCBtZXNzYWdlPU5vbmUpOgogICAgICAgICIiIkFkZCB0aGUgcmVzcG9uc2Ug
aGVhZGVyIHRvIHRoZSBoZWFkZXJzIGJ1ZmZlciBhbmQgbG9nIHRoZQogICAgICAgIHJlc3Bv
bnNlIGNvZGUuCgogICAgICAgIEFsc28gc2VuZCB0d28gc3RhbmRhcmQgaGVhZGVycyB3aXRo
IHRoZSBzZXJ2ZXIgc29mdHdhcmUKICAgICAgICB2ZXJzaW9uIGFuZCB0aGUgY3VycmVudCBk
YXRlLgoKICAgICAgICAiIiIKICAgICAgICBzZWxmLmxvZ19yZXF1ZXN0KGNvZGUpCiAgICAg
ICAgc2VsZi5zZW5kX3Jlc3BvbnNlX29ubHkoY29kZSwgbWVzc2FnZSkKICAgICAgICBzZWxm
LnNlbmRfaGVhZGVyKCdTZXJ2ZXInLCBzZWxmLnZlcnNpb25fc3RyaW5nKCkpCiAgICAgICAg
c2VsZi5zZW5kX2hlYWRlcignRGF0ZScsIHNlbGYuZGF0ZV90aW1lX3N0cmluZygpKQoKICAg
IGRlZiBzZW5kX3Jlc3BvbnNlX29ubHkoc2VsZiwgY29kZSwgbWVzc2FnZT1Ob25lKToKICAg
ICAgICAiIiJTZW5kIHRoZSByZXNwb25zZSBoZWFkZXIgb25seS4iIiIKICAgICAgICBpZiBt
ZXNzYWdlIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGNvZGUgaW4gc2VsZi5yZXNwb25zZXM6
CiAgICAgICAgICAgICAgICBtZXNzYWdlID0gc2VsZi5yZXNwb25zZXNbY29kZV1bMF0KICAg
ICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIG1lc3NhZ2UgPSAnJwogICAgICAgIGlm
IHNlbGYucmVxdWVzdF92ZXJzaW9uICE9ICdIVFRQLzAuOSc6CiAgICAgICAgICAgIGlmIG5v
dCBoYXNhdHRyKHNlbGYsICdfaGVhZGVyc19idWZmZXInKToKICAgICAgICAgICAgICAgIHNl
bGYuX2hlYWRlcnNfYnVmZmVyID0gW10KICAgICAgICAgICAgc2VsZi5faGVhZGVyc19idWZm
ZXIuYXBwZW5kKCgiJXMgJWQgJXNcclxuIiAlCiAgICAgICAgICAgICAgICAgICAgKHNlbGYu
cHJvdG9jb2xfdmVyc2lvbiwgY29kZSwgbWVzc2FnZSkpLmVuY29kZSgKICAgICAgICAgICAg
ICAgICAgICAgICAgJ2xhdGluLTEnLCAnc3RyaWN0JykpCgogICAgZGVmIHNlbmRfaGVhZGVy
KHNlbGYsIGtleXdvcmQsIHZhbHVlKToKICAgICAgICAiIiJTZW5kIGEgTUlNRSBoZWFkZXIg
dG8gdGhlIGhlYWRlcnMgYnVmZmVyLiIiIgogICAgICAgIGlmIHNlbGYucmVxdWVzdF92ZXJz
aW9uICE9ICdIVFRQLzAuOSc6CiAgICAgICAgICAgIGlmIG5vdCBoYXNhdHRyKHNlbGYsICdf
aGVhZGVyc19idWZmZXInKToKICAgICAgICAgICAgICAgIHNlbGYuX2hlYWRlcnNfYnVmZmVy
ID0gW10KICAgICAgICAgICAgc2VsZi5faGVhZGVyc19idWZmZXIuYXBwZW5kKAogICAgICAg
ICAgICAgICAgKCIlczogJXNcclxuIiAlIChrZXl3b3JkLCB2YWx1ZSkpLmVuY29kZSgnbGF0
aW4tMScsICdzdHJpY3QnKSkKCiAgICAgICAgaWYga2V5d29yZC5sb3dlcigpID09ICdjb25u
ZWN0aW9uJzoKICAgICAgICAgICAgaWYgdmFsdWUubG93ZXIoKSA9PSAnY2xvc2UnOgogICAg
ICAgICAgICAgICAgc2VsZi5jbG9zZV9jb25uZWN0aW9uID0gMQogICAgICAgICAgICBlbGlm
IHZhbHVlLmxvd2VyKCkgPT0gJ2tlZXAtYWxpdmUnOgogICAgICAgICAgICAgICAgc2VsZi5j
bG9zZV9jb25uZWN0aW9uID0gMAoKICAgIGRlZiBlbmRfaGVhZGVycyhzZWxmKToKICAgICAg
ICAiIiJTZW5kIHRoZSBibGFuayBsaW5lIGVuZGluZyB0aGUgTUlNRSBoZWFkZXJzLiIiIgog
ICAgICAgIGlmIHNlbGYucmVxdWVzdF92ZXJzaW9uICE9ICdIVFRQLzAuOSc6CiAgICAgICAg
ICAgIHNlbGYuX2hlYWRlcnNfYnVmZmVyLmFwcGVuZChiIlxyXG4iKQogICAgICAgICAgICBz
ZWxmLmZsdXNoX2hlYWRlcnMoKQoKICAgIGRlZiBmbHVzaF9oZWFkZXJzKHNlbGYpOgogICAg
ICAgIGlmIGhhc2F0dHIoc2VsZiwgJ19oZWFkZXJzX2J1ZmZlcicpOgogICAgICAgICAgICBz
ZWxmLndmaWxlLndyaXRlKGIiIi5qb2luKHNlbGYuX2hlYWRlcnNfYnVmZmVyKSkKICAgICAg
ICAgICAgc2VsZi5faGVhZGVyc19idWZmZXIgPSBbXQoKICAgIGRlZiBsb2dfcmVxdWVzdChz
ZWxmLCBjb2RlPSctJywgc2l6ZT0nLScpOgogICAgICAgICIiIkxvZyBhbiBhY2NlcHRlZCBy
ZXF1ZXN0LgoKICAgICAgICBUaGlzIGlzIGNhbGxlZCBieSBzZW5kX3Jlc3BvbnNlKCkuCgog
ICAgICAgICIiIgoKICAgICAgICBzZWxmLmxvZ19tZXNzYWdlKCciJXMiICVzICVzJywKICAg
ICAgICAgICAgICAgICAgICAgICAgIHNlbGYucmVxdWVzdGxpbmUsIHN0cihjb2RlKSwgc3Ry
KHNpemUpKQoKICAgIGRlZiBsb2dfZXJyb3Ioc2VsZiwgZm9ybWF0LCAqYXJncyk6CiAgICAg
ICAgIiIiTG9nIGFuIGVycm9yLgoKICAgICAgICBUaGlzIGlzIGNhbGxlZCB3aGVuIGEgcmVx
dWVzdCBjYW5ub3QgYmUgZnVsZmlsbGVkLiAgQnkKICAgICAgICBkZWZhdWx0IGl0IHBhc3Nl
cyB0aGUgbWVzc2FnZSBvbiB0byBsb2dfbWVzc2FnZSgpLgoKICAgICAgICBBcmd1bWVudHMg
YXJlIHRoZSBzYW1lIGFzIGZvciBsb2dfbWVzc2FnZSgpLgoKICAgICAgICBYWFggVGhpcyBz
aG91bGQgZ28gdG8gdGhlIHNlcGFyYXRlIGVycm9yIGxvZy4KCiAgICAgICAgIiIiCgogICAg
ICAgIHNlbGYubG9nX21lc3NhZ2UoZm9ybWF0LCAqYXJncykKCiAgICBkZWYgbG9nX21lc3Nh
Z2Uoc2VsZiwgZm9ybWF0LCAqYXJncyk6CiAgICAgICAgIiIiTG9nIGFuIGFyYml0cmFyeSBt
ZXNzYWdlLgoKICAgICAgICBUaGlzIGlzIHVzZWQgYnkgYWxsIG90aGVyIGxvZ2dpbmcgZnVu
Y3Rpb25zLiAgT3ZlcnJpZGUKICAgICAgICBpdCBpZiB5b3UgaGF2ZSBzcGVjaWZpYyBsb2dn
aW5nIHdpc2hlcy4KCiAgICAgICAgVGhlIGZpcnN0IGFyZ3VtZW50LCBGT1JNQVQsIGlzIGEg
Zm9ybWF0IHN0cmluZyBmb3IgdGhlCiAgICAgICAgbWVzc2FnZSB0byBiZSBsb2dnZWQuICBJ
ZiB0aGUgZm9ybWF0IHN0cmluZyBjb250YWlucwogICAgICAgIGFueSAlIGVzY2FwZXMgcmVx
dWlyaW5nIHBhcmFtZXRlcnMsIHRoZXkgc2hvdWxkIGJlCiAgICAgICAgc3BlY2lmaWVkIGFz
IHN1YnNlcXVlbnQgYXJndW1lbnRzIChpdCdzIGp1c3QgbGlrZQogICAgICAgIHByaW50ZiEp
LgoKICAgICAgICBUaGUgY2xpZW50IGhvc3QgYW5kIGN1cnJlbnQgZGF0ZS90aW1lIGFyZSBw
cmVmaXhlZCB0bwogICAgICAgIGV2ZXJ5IG1lc3NhZ2UuCgogICAgICAgICIiIgoKICAgICAg
ICBzeXMuc3RkZXJyLndyaXRlKCIlcyAtIC0gWyVzXSAlc1xuIiAlCiAgICAgICAgICAgICAg
ICAgICAgICAgICAoc2VsZi5hZGRyZXNzX3N0cmluZygpLAogICAgICAgICAgICAgICAgICAg
ICAgICAgIHNlbGYubG9nX2RhdGVfdGltZV9zdHJpbmcoKSwKICAgICAgICAgICAgICAgICAg
ICAgICAgICBmb3JtYXQlYXJncykpCgogICAgZGVmIHZlcnNpb25fc3RyaW5nKHNlbGYpOgog
ICAgICAgICIiIlJldHVybiB0aGUgc2VydmVyIHNvZnR3YXJlIHZlcnNpb24gc3RyaW5nLiIi
IgogICAgICAgIHJldHVybiBzZWxmLnNlcnZlcl92ZXJzaW9uICsgJyAnICsgc2VsZi5zeXNf
dmVyc2lvbgoKICAgIGRlZiBkYXRlX3RpbWVfc3RyaW5nKHNlbGYsIHRpbWVzdGFtcD1Ob25l
KToKICAgICAgICAiIiJSZXR1cm4gdGhlIGN1cnJlbnQgZGF0ZSBhbmQgdGltZSBmb3JtYXR0
ZWQgZm9yIGEgbWVzc2FnZSBoZWFkZXIuIiIiCiAgICAgICAgaWYgdGltZXN0YW1wIGlzIE5v
bmU6CiAgICAgICAgICAgIHRpbWVzdGFtcCA9IHRpbWUudGltZSgpCiAgICAgICAgeWVhciwg
bW9udGgsIGRheSwgaGgsIG1tLCBzcywgd2QsIHksIHogPSB0aW1lLmdtdGltZSh0aW1lc3Rh
bXApCiAgICAgICAgcyA9ICIlcywgJTAyZCAlM3MgJTRkICUwMmQ6JTAyZDolMDJkIEdNVCIg
JSAoCiAgICAgICAgICAgICAgICBzZWxmLndlZWtkYXluYW1lW3dkXSwKICAgICAgICAgICAg
ICAgIGRheSwgc2VsZi5tb250aG5hbWVbbW9udGhdLCB5ZWFyLAogICAgICAgICAgICAgICAg
aGgsIG1tLCBzcykKICAgICAgICByZXR1cm4gcwoKICAgIGRlZiBsb2dfZGF0ZV90aW1lX3N0
cmluZyhzZWxmKToKICAgICAgICAiIiJSZXR1cm4gdGhlIGN1cnJlbnQgdGltZSBmb3JtYXR0
ZWQgZm9yIGxvZ2dpbmcuIiIiCiAgICAgICAgbm93ID0gdGltZS50aW1lKCkKICAgICAgICB5
ZWFyLCBtb250aCwgZGF5LCBoaCwgbW0sIHNzLCB4LCB5LCB6ID0gdGltZS5sb2NhbHRpbWUo
bm93KQogICAgICAgIHMgPSAiJTAyZC8lM3MvJTA0ZCAlMDJkOiUwMmQ6JTAyZCIgJSAoCiAg
ICAgICAgICAgICAgICBkYXksIHNlbGYubW9udGhuYW1lW21vbnRoXSwgeWVhciwgaGgsIG1t
LCBzcykKICAgICAgICByZXR1cm4gcwoKICAgIHdlZWtkYXluYW1lID0gWydNb24nLCAnVHVl
JywgJ1dlZCcsICdUaHUnLCAnRnJpJywgJ1NhdCcsICdTdW4nXQoKICAgIG1vbnRobmFtZSA9
IFtOb25lLAogICAgICAgICAgICAgICAgICdKYW4nLCAnRmViJywgJ01hcicsICdBcHInLCAn
TWF5JywgJ0p1bicsCiAgICAgICAgICAgICAgICAgJ0p1bCcsICdBdWcnLCAnU2VwJywgJ09j
dCcsICdOb3YnLCAnRGVjJ10KCiAgICBkZWYgYWRkcmVzc19zdHJpbmcoc2VsZik6CiAgICAg
ICAgIiIiUmV0dXJuIHRoZSBjbGllbnQgYWRkcmVzcyBmb3JtYXR0ZWQgZm9yIGxvZ2dpbmcu
CgogICAgICAgIFRoaXMgdmVyc2lvbiBsb29rcyB1cCB0aGUgZnVsbCBob3N0bmFtZSB1c2lu
ZyBnZXRob3N0YnlhZGRyKCksCiAgICAgICAgYW5kIHRyaWVzIHRvIGZpbmQgYSBuYW1lIHRo
YXQgY29udGFpbnMgYXQgbGVhc3Qgb25lIGRvdC4KCiAgICAgICAgIiIiCgogICAgICAgIGhv
c3QsIHBvcnQgPSBzZWxmLmNsaWVudF9hZGRyZXNzWzoyXQogICAgICAgIHJldHVybiBzb2Nr
ZXQuZ2V0ZnFkbihob3N0KQoKICAgICMgRXNzZW50aWFsbHkgc3RhdGljIGNsYXNzIHZhcmlh
YmxlcwoKICAgICMgVGhlIHZlcnNpb24gb2YgdGhlIEhUVFAgcHJvdG9jb2wgd2Ugc3VwcG9y
dC4KICAgICMgU2V0IHRoaXMgdG8gSFRUUC8xLjEgdG8gZW5hYmxlIGF1dG9tYXRpYyBrZWVw
YWxpdmUKICAgIHByb3RvY29sX3ZlcnNpb24gPSAiSFRUUC8xLjAiCgogICAgIyBNZXNzYWdl
Q2xhc3MgdXNlZCB0byBwYXJzZSBoZWFkZXJzCiAgICBNZXNzYWdlQ2xhc3MgPSBodHRwLmNs
aWVudC5IVFRQTWVzc2FnZQoKICAgICMgVGFibGUgbWFwcGluZyByZXNwb25zZSBjb2RlcyB0
byBtZXNzYWdlczsgZW50cmllcyBoYXZlIHRoZQogICAgIyBmb3JtIHtjb2RlOiAoc2hvcnRt
ZXNzYWdlLCBsb25nbWVzc2FnZSl9LgogICAgIyBTZWUgUkZDIDI2MTYuCiAgICByZXNwb25z
ZXMgPSB7CiAgICAgICAgMTAwOiAoJ0NvbnRpbnVlJywgJ1JlcXVlc3QgcmVjZWl2ZWQsIHBs
ZWFzZSBjb250aW51ZScpLAogICAgICAgIDEwMTogKCdTd2l0Y2hpbmcgUHJvdG9jb2xzJywK
ICAgICAgICAgICAgICAnU3dpdGNoaW5nIHRvIG5ldyBwcm90b2NvbDsgb2JleSBVcGdyYWRl
IGhlYWRlcicpLAoKICAgICAgICAyMDA6ICgnT0snLCAnUmVxdWVzdCBmdWxmaWxsZWQsIGRv
Y3VtZW50IGZvbGxvd3MnKSwKICAgICAgICAyMDE6ICgnQ3JlYXRlZCcsICdEb2N1bWVudCBj
cmVhdGVkLCBVUkwgZm9sbG93cycpLAogICAgICAgIDIwMjogKCdBY2NlcHRlZCcsCiAgICAg
ICAgICAgICAgJ1JlcXVlc3QgYWNjZXB0ZWQsIHByb2Nlc3NpbmcgY29udGludWVzIG9mZi1s
aW5lJyksCiAgICAgICAgMjAzOiAoJ05vbi1BdXRob3JpdGF0aXZlIEluZm9ybWF0aW9uJywg
J1JlcXVlc3QgZnVsZmlsbGVkIGZyb20gY2FjaGUnKSwKICAgICAgICAyMDQ6ICgnTm8gQ29u
dGVudCcsICdSZXF1ZXN0IGZ1bGZpbGxlZCwgbm90aGluZyBmb2xsb3dzJyksCiAgICAgICAg
MjA1OiAoJ1Jlc2V0IENvbnRlbnQnLCAnQ2xlYXIgaW5wdXQgZm9ybSBmb3IgZnVydGhlciBp
bnB1dC4nKSwKICAgICAgICAyMDY6ICgnUGFydGlhbCBDb250ZW50JywgJ1BhcnRpYWwgY29u
dGVudCBmb2xsb3dzLicpLAoKICAgICAgICAzMDA6ICgnTXVsdGlwbGUgQ2hvaWNlcycsCiAg
ICAgICAgICAgICAgJ09iamVjdCBoYXMgc2V2ZXJhbCByZXNvdXJjZXMgLS0gc2VlIFVSSSBs
aXN0JyksCiAgICAgICAgMzAxOiAoJ01vdmVkIFBlcm1hbmVudGx5JywgJ09iamVjdCBtb3Zl
ZCBwZXJtYW5lbnRseSAtLSBzZWUgVVJJIGxpc3QnKSwKICAgICAgICAzMDI6ICgnRm91bmQn
LCAnT2JqZWN0IG1vdmVkIHRlbXBvcmFyaWx5IC0tIHNlZSBVUkkgbGlzdCcpLAogICAgICAg
IDMwMzogKCdTZWUgT3RoZXInLCAnT2JqZWN0IG1vdmVkIC0tIHNlZSBNZXRob2QgYW5kIFVS
TCBsaXN0JyksCiAgICAgICAgMzA0OiAoJ05vdCBNb2RpZmllZCcsCiAgICAgICAgICAgICAg
J0RvY3VtZW50IGhhcyBub3QgY2hhbmdlZCBzaW5jZSBnaXZlbiB0aW1lJyksCiAgICAgICAg
MzA1OiAoJ1VzZSBQcm94eScsCiAgICAgICAgICAgICAgJ1lvdSBtdXN0IHVzZSBwcm94eSBz
cGVjaWZpZWQgaW4gTG9jYXRpb24gdG8gYWNjZXNzIHRoaXMgJwogICAgICAgICAgICAgICdy
ZXNvdXJjZS4nKSwKICAgICAgICAzMDc6ICgnVGVtcG9yYXJ5IFJlZGlyZWN0JywKICAgICAg
ICAgICAgICAnT2JqZWN0IG1vdmVkIHRlbXBvcmFyaWx5IC0tIHNlZSBVUkkgbGlzdCcpLAoK
ICAgICAgICA0MDA6ICgnQmFkIFJlcXVlc3QnLAogICAgICAgICAgICAgICdCYWQgcmVxdWVz
dCBzeW50YXggb3IgdW5zdXBwb3J0ZWQgbWV0aG9kJyksCiAgICAgICAgNDAxOiAoJ1VuYXV0
aG9yaXplZCcsCiAgICAgICAgICAgICAgJ05vIHBlcm1pc3Npb24gLS0gc2VlIGF1dGhvcml6
YXRpb24gc2NoZW1lcycpLAogICAgICAgIDQwMjogKCdQYXltZW50IFJlcXVpcmVkJywKICAg
ICAgICAgICAgICAnTm8gcGF5bWVudCAtLSBzZWUgY2hhcmdpbmcgc2NoZW1lcycpLAogICAg
ICAgIDQwMzogKCdGb3JiaWRkZW4nLAogICAgICAgICAgICAgICdSZXF1ZXN0IGZvcmJpZGRl
biAtLSBhdXRob3JpemF0aW9uIHdpbGwgbm90IGhlbHAnKSwKICAgICAgICA0MDQ6ICgnTm90
IEZvdW5kJywgJ05vdGhpbmcgbWF0Y2hlcyB0aGUgZ2l2ZW4gVVJJJyksCiAgICAgICAgNDA1
OiAoJ01ldGhvZCBOb3QgQWxsb3dlZCcsCiAgICAgICAgICAgICAgJ1NwZWNpZmllZCBtZXRo
b2QgaXMgaW52YWxpZCBmb3IgdGhpcyByZXNvdXJjZS4nKSwKICAgICAgICA0MDY6ICgnTm90
IEFjY2VwdGFibGUnLCAnVVJJIG5vdCBhdmFpbGFibGUgaW4gcHJlZmVycmVkIGZvcm1hdC4n
KSwKICAgICAgICA0MDc6ICgnUHJveHkgQXV0aGVudGljYXRpb24gUmVxdWlyZWQnLCAnWW91
IG11c3QgYXV0aGVudGljYXRlIHdpdGggJwogICAgICAgICAgICAgICd0aGlzIHByb3h5IGJl
Zm9yZSBwcm9jZWVkaW5nLicpLAogICAgICAgIDQwODogKCdSZXF1ZXN0IFRpbWVvdXQnLCAn
UmVxdWVzdCB0aW1lZCBvdXQ7IHRyeSBhZ2FpbiBsYXRlci4nKSwKICAgICAgICA0MDk6ICgn
Q29uZmxpY3QnLCAnUmVxdWVzdCBjb25mbGljdC4nKSwKICAgICAgICA0MTA6ICgnR29uZScs
CiAgICAgICAgICAgICAgJ1VSSSBubyBsb25nZXIgZXhpc3RzIGFuZCBoYXMgYmVlbiBwZXJt
YW5lbnRseSByZW1vdmVkLicpLAogICAgICAgIDQxMTogKCdMZW5ndGggUmVxdWlyZWQnLCAn
Q2xpZW50IG11c3Qgc3BlY2lmeSBDb250ZW50LUxlbmd0aC4nKSwKICAgICAgICA0MTI6ICgn
UHJlY29uZGl0aW9uIEZhaWxlZCcsICdQcmVjb25kaXRpb24gaW4gaGVhZGVycyBpcyBmYWxz
ZS4nKSwKICAgICAgICA0MTM6ICgnUmVxdWVzdCBFbnRpdHkgVG9vIExhcmdlJywgJ0VudGl0
eSBpcyB0b28gbGFyZ2UuJyksCiAgICAgICAgNDE0OiAoJ1JlcXVlc3QtVVJJIFRvbyBMb25n
JywgJ1VSSSBpcyB0b28gbG9uZy4nKSwKICAgICAgICA0MTU6ICgnVW5zdXBwb3J0ZWQgTWVk
aWEgVHlwZScsICdFbnRpdHkgYm9keSBpbiB1bnN1cHBvcnRlZCBmb3JtYXQuJyksCiAgICAg
ICAgNDE2OiAoJ1JlcXVlc3RlZCBSYW5nZSBOb3QgU2F0aXNmaWFibGUnLAogICAgICAgICAg
ICAgICdDYW5ub3Qgc2F0aXNmeSByZXF1ZXN0IHJhbmdlLicpLAogICAgICAgIDQxNzogKCdF
eHBlY3RhdGlvbiBGYWlsZWQnLAogICAgICAgICAgICAgICdFeHBlY3QgY29uZGl0aW9uIGNv
dWxkIG5vdCBiZSBzYXRpc2ZpZWQuJyksCgogICAgICAgIDUwMDogKCdJbnRlcm5hbCBTZXJ2
ZXIgRXJyb3InLCAnU2VydmVyIGdvdCBpdHNlbGYgaW4gdHJvdWJsZScpLAogICAgICAgIDUw
MTogKCdOb3QgSW1wbGVtZW50ZWQnLAogICAgICAgICAgICAgICdTZXJ2ZXIgZG9lcyBub3Qg
c3VwcG9ydCB0aGlzIG9wZXJhdGlvbicpLAogICAgICAgIDUwMjogKCdCYWQgR2F0ZXdheScs
ICdJbnZhbGlkIHJlc3BvbnNlcyBmcm9tIGFub3RoZXIgc2VydmVyL3Byb3h5LicpLAogICAg
ICAgIDUwMzogKCdTZXJ2aWNlIFVuYXZhaWxhYmxlJywKICAgICAgICAgICAgICAnVGhlIHNl
cnZlciBjYW5ub3QgcHJvY2VzcyB0aGUgcmVxdWVzdCBkdWUgdG8gYSBoaWdoIGxvYWQnKSwK
ICAgICAgICA1MDQ6ICgnR2F0ZXdheSBUaW1lb3V0JywKICAgICAgICAgICAgICAnVGhlIGdh
dGV3YXkgc2VydmVyIGRpZCBub3QgcmVjZWl2ZSBhIHRpbWVseSByZXNwb25zZScpLAogICAg
ICAgIDUwNTogKCdIVFRQIFZlcnNpb24gTm90IFN1cHBvcnRlZCcsICdDYW5ub3QgZnVsZmls
bCByZXF1ZXN0LicpLAogICAgICAgIH0KCgpjbGFzcyBTaW1wbGVIVFRQUmVxdWVzdEhhbmRs
ZXIoQmFzZUhUVFBSZXF1ZXN0SGFuZGxlcik6CgogICAgIiIiU2ltcGxlIEhUVFAgcmVxdWVz
dCBoYW5kbGVyIHdpdGggR0VUIGFuZCBIRUFEIGNvbW1hbmRzLgoKICAgIFRoaXMgc2VydmVz
IGZpbGVzIGZyb20gdGhlIGN1cnJlbnQgZGlyZWN0b3J5IGFuZCBhbnkgb2YgaXRzCiAgICBz
dWJkaXJlY3Rvcmllcy4gIFRoZSBNSU1FIHR5cGUgZm9yIGZpbGVzIGlzIGRldGVybWluZWQg
YnkKICAgIGNhbGxpbmcgdGhlIC5ndWVzc190eXBlKCkgbWV0aG9kLgoKICAgIFRoZSBHRVQg
YW5kIEhFQUQgcmVxdWVzdHMgYXJlIGlkZW50aWNhbCBleGNlcHQgdGhhdCB0aGUgSEVBRAog
ICAgcmVxdWVzdCBvbWl0cyB0aGUgYWN0dWFsIGNvbnRlbnRzIG9mIHRoZSBmaWxlLgoKICAg
ICIiIgoKICAgIHNlcnZlcl92ZXJzaW9uID0gIlNpbXBsZUhUVFAvIiArIF9fdmVyc2lvbl9f
CgogICAgZGVmIGRvX0dFVChzZWxmKToKICAgICAgICAiIiJTZXJ2ZSBhIEdFVCByZXF1ZXN0
LiIiIgogICAgICAgIGYgPSBzZWxmLnNlbmRfaGVhZCgpCiAgICAgICAgaWYgZjoKICAgICAg
ICAgICAgc2VsZi5jb3B5ZmlsZShmLCBzZWxmLndmaWxlKQogICAgICAgICAgICBmLmNsb3Nl
KCkKCiAgICBkZWYgZG9fSEVBRChzZWxmKToKICAgICAgICAiIiJTZXJ2ZSBhIEhFQUQgcmVx
dWVzdC4iIiIKICAgICAgICBmID0gc2VsZi5zZW5kX2hlYWQoKQogICAgICAgIGlmIGY6CiAg
ICAgICAgICAgIGYuY2xvc2UoKQoKICAgIGRlZiBzZW5kX2hlYWQoc2VsZik6CiAgICAgICAg
IiIiQ29tbW9uIGNvZGUgZm9yIEdFVCBhbmQgSEVBRCBjb21tYW5kcy4KCiAgICAgICAgVGhp
cyBzZW5kcyB0aGUgcmVzcG9uc2UgY29kZSBhbmQgTUlNRSBoZWFkZXJzLgoKICAgICAgICBS
ZXR1cm4gdmFsdWUgaXMgZWl0aGVyIGEgZmlsZSBvYmplY3QgKHdoaWNoIGhhcyB0byBiZSBj
b3BpZWQKICAgICAgICB0byB0aGUgb3V0cHV0ZmlsZSBieSB0aGUgY2FsbGVyIHVubGVzcyB0
aGUgY29tbWFuZCB3YXMgSEVBRCwKICAgICAgICBhbmQgbXVzdCBiZSBjbG9zZWQgYnkgdGhl
IGNhbGxlciB1bmRlciBhbGwgY2lyY3Vtc3RhbmNlcyksIG9yCiAgICAgICAgTm9uZSwgaW4g
d2hpY2ggY2FzZSB0aGUgY2FsbGVyIGhhcyBub3RoaW5nIGZ1cnRoZXIgdG8gZG8uCgogICAg
ICAgICIiIgogICAgICAgIHBhdGggPSBzZWxmLnRyYW5zbGF0ZV9wYXRoKHNlbGYucGF0aCkK
ICAgICAgICBmID0gTm9uZQogICAgICAgIGlmIG9zLnBhdGguaXNkaXIocGF0aCk6CiAgICAg
ICAgICAgIGlmIG5vdCBzZWxmLnBhdGguZW5kc3dpdGgoJy8nKToKICAgICAgICAgICAgICAg
ICMgcmVkaXJlY3QgYnJvd3NlciAtIGRvaW5nIGJhc2ljYWxseSB3aGF0IGFwYWNoZSBkb2Vz
CiAgICAgICAgICAgICAgICBzZWxmLnNlbmRfcmVzcG9uc2UoMzAxKQogICAgICAgICAgICAg
ICAgc2VsZi5zZW5kX2hlYWRlcigiTG9jYXRpb24iLCBzZWxmLnBhdGggKyAiLyIpCiAgICAg
ICAgICAgICAgICBzZWxmLmVuZF9oZWFkZXJzKCkKICAgICAgICAgICAgICAgIHJldHVybiBO
b25lCiAgICAgICAgICAgIGZvciBpbmRleCBpbiAiaW5kZXguaHRtbCIsICJpbmRleC5odG0i
OgogICAgICAgICAgICAgICAgaW5kZXggPSBvcy5wYXRoLmpvaW4ocGF0aCwgaW5kZXgpCiAg
ICAgICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhpbmRleCk6CiAgICAgICAgICAgICAg
ICAgICAgcGF0aCA9IGluZGV4CiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAg
ICAgZWxzZToKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLmxpc3RfZGlyZWN0b3J5KHBh
dGgpCiAgICAgICAgY3R5cGUgPSBzZWxmLmd1ZXNzX3R5cGUocGF0aCkKICAgICAgICB0cnk6
CiAgICAgICAgICAgIGYgPSBvcGVuKHBhdGgsICdyYicpCiAgICAgICAgZXhjZXB0IElPRXJy
b3I6CiAgICAgICAgICAgIHNlbGYuc2VuZF9lcnJvcig0MDQsICJGaWxlIG5vdCBmb3VuZCIp
CiAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgc2VsZi5zZW5kX3Jlc3BvbnNlKDIw
MCkKICAgICAgICBzZWxmLnNlbmRfaGVhZGVyKCJDb250ZW50LXR5cGUiLCBjdHlwZSkKICAg
ICAgICBmcyA9IG9zLmZzdGF0KGYuZmlsZW5vKCkpCiAgICAgICAgc2VsZi5zZW5kX2hlYWRl
cigiQ29udGVudC1MZW5ndGgiLCBzdHIoZnNbNl0pKQogICAgICAgIHNlbGYuc2VuZF9oZWFk
ZXIoIkxhc3QtTW9kaWZpZWQiLCBzZWxmLmRhdGVfdGltZV9zdHJpbmcoZnMuc3RfbXRpbWUp
KQogICAgICAgIHNlbGYuZW5kX2hlYWRlcnMoKQogICAgICAgIHJldHVybiBmCgogICAgZGVm
IGxpc3RfZGlyZWN0b3J5KHNlbGYsIHBhdGgpOgogICAgICAgICIiIkhlbHBlciB0byBwcm9k
dWNlIGEgZGlyZWN0b3J5IGxpc3RpbmcgKGFic2VudCBpbmRleC5odG1sKS4KCiAgICAgICAg
UmV0dXJuIHZhbHVlIGlzIGVpdGhlciBhIGZpbGUgb2JqZWN0LCBvciBOb25lIChpbmRpY2F0
aW5nIGFuCiAgICAgICAgZXJyb3IpLiAgSW4gZWl0aGVyIGNhc2UsIHRoZSBoZWFkZXJzIGFy
ZSBzZW50LCBtYWtpbmcgdGhlCiAgICAgICAgaW50ZXJmYWNlIHRoZSBzYW1lIGFzIGZvciBz
ZW5kX2hlYWQoKS4KCiAgICAgICAgIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBsaXN0
ID0gb3MubGlzdGRpcihwYXRoKQogICAgICAgIGV4Y2VwdCBvcy5lcnJvcjoKICAgICAgICAg
ICAgc2VsZi5zZW5kX2Vycm9yKDQwNCwgIk5vIHBlcm1pc3Npb24gdG8gbGlzdCBkaXJlY3Rv
cnkiKQogICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgIGxpc3Quc29ydChrZXk9bGFt
YmRhIGE6IGEubG93ZXIoKSkKICAgICAgICByID0gW10KICAgICAgICBkaXNwbGF5cGF0aCA9
IGh0bWwuZXNjYXBlKHVybGxpYi5wYXJzZS51bnF1b3RlKHNlbGYucGF0aCkpCiAgICAgICAg
ZW5jID0gc3lzLmdldGZpbGVzeXN0ZW1lbmNvZGluZygpCiAgICAgICAgdGl0bGUgPSAnRGly
ZWN0b3J5IGxpc3RpbmcgZm9yICVzJyAlIGRpc3BsYXlwYXRoCiAgICAgICAgci5hcHBlbmQo
JzwhRE9DVFlQRSBIVE1MIFBVQkxJQyAiLS8vVzNDLy9EVEQgSFRNTCA0LjAxLy9FTiIgJwog
ICAgICAgICAgICAgICAgICciaHR0cDovL3d3dy53My5vcmcvVFIvaHRtbDQvc3RyaWN0LmR0
ZCI+JykKICAgICAgICByLmFwcGVuZCgnPGh0bWw+XG48aGVhZD4nKQogICAgICAgIHIuYXBw
ZW5kKCc8bWV0YSBodHRwLWVxdWl2PSJDb250ZW50LVR5cGUiICcKICAgICAgICAgICAgICAg
ICAnY29udGVudD0idGV4dC9odG1sOyBjaGFyc2V0PSVzIj4nICUgZW5jKQogICAgICAgIHIu
YXBwZW5kKCc8dGl0bGU+JXM8L3RpdGxlPlxuPC9oZWFkPicgJSB0aXRsZSkKICAgICAgICBy
LmFwcGVuZCgnPGJvZHk+XG48aDE+JXM8L2gxPicgJSB0aXRsZSkKICAgICAgICByLmFwcGVu
ZCgnPGhyPlxuPHVsPicpCiAgICAgICAgZm9yIG5hbWUgaW4gbGlzdDoKICAgICAgICAgICAg
ZnVsbG5hbWUgPSBvcy5wYXRoLmpvaW4ocGF0aCwgbmFtZSkKICAgICAgICAgICAgZGlzcGxh
eW5hbWUgPSBsaW5rbmFtZSA9IG5hbWUKICAgICAgICAgICAgIyBBcHBlbmQgLyBmb3IgZGly
ZWN0b3JpZXMgb3IgQCBmb3Igc3ltYm9saWMgbGlua3MKICAgICAgICAgICAgaWYgb3MucGF0
aC5pc2RpcihmdWxsbmFtZSk6CiAgICAgICAgICAgICAgICBkaXNwbGF5bmFtZSA9IG5hbWUg
KyAiLyIKICAgICAgICAgICAgICAgIGxpbmtuYW1lID0gbmFtZSArICIvIgogICAgICAgICAg
ICBpZiBvcy5wYXRoLmlzbGluayhmdWxsbmFtZSk6CiAgICAgICAgICAgICAgICBkaXNwbGF5
bmFtZSA9IG5hbWUgKyAiQCIKICAgICAgICAgICAgICAgICMgTm90ZTogYSBsaW5rIHRvIGEg
ZGlyZWN0b3J5IGRpc3BsYXlzIHdpdGggQCBhbmQgbGlua3Mgd2l0aCAvCiAgICAgICAgICAg
IHIuYXBwZW5kKCc8bGk+PGEgaHJlZj0iJXMiPiVzPC9hPjwvbGk+JwogICAgICAgICAgICAg
ICAgICAgICUgKHVybGxpYi5wYXJzZS5xdW90ZShsaW5rbmFtZSksIGh0bWwuZXNjYXBlKGRp
c3BsYXluYW1lKSkpCiAgICAgICAgci5hcHBlbmQoJzwvdWw+XG48aHI+XG48L2JvZHk+XG48
L2h0bWw+XG4nKQogICAgICAgIGVuY29kZWQgPSAnXG4nLmpvaW4ocikuZW5jb2RlKGVuYykK
ICAgICAgICBmID0gaW8uQnl0ZXNJTygpCiAgICAgICAgZi53cml0ZShlbmNvZGVkKQogICAg
ICAgIGYuc2VlaygwKQogICAgICAgIHNlbGYuc2VuZF9yZXNwb25zZSgyMDApCiAgICAgICAg
c2VsZi5zZW5kX2hlYWRlcigiQ29udGVudC10eXBlIiwgInRleHQvaHRtbDsgY2hhcnNldD0l
cyIgJSBlbmMpCiAgICAgICAgc2VsZi5zZW5kX2hlYWRlcigiQ29udGVudC1MZW5ndGgiLCBz
dHIobGVuKGVuY29kZWQpKSkKICAgICAgICBzZWxmLmVuZF9oZWFkZXJzKCkKICAgICAgICBy
ZXR1cm4gZgoKICAgIGRlZiB0cmFuc2xhdGVfcGF0aChzZWxmLCBwYXRoKToKICAgICAgICAi
IiJUcmFuc2xhdGUgYSAvLXNlcGFyYXRlZCBQQVRIIHRvIHRoZSBsb2NhbCBmaWxlbmFtZSBz
eW50YXguCiAgICAgICAgIiIiCiAgICAgICAgcmV0dXJuIG9zLnBhdGguam9pbiggb3MuZ2V0
Y3dkKCksIHBhdGhbMTpdKQoKICAgIGRlZiBjb3B5ZmlsZShzZWxmLCBzb3VyY2UsIG91dHB1
dGZpbGUpOgogICAgICAgICIiIkNvcHkgYWxsIGRhdGEgYmV0d2VlbiB0d28gZmlsZSBvYmpl
Y3RzLgoKICAgICAgICBUaGUgU09VUkNFIGFyZ3VtZW50IGlzIGEgZmlsZSBvYmplY3Qgb3Bl
biBmb3IgcmVhZGluZwogICAgICAgIChvciBhbnl0aGluZyB3aXRoIGEgcmVhZCgpIG1ldGhv
ZCkgYW5kIHRoZSBERVNUSU5BVElPTgogICAgICAgIGFyZ3VtZW50IGlzIGEgZmlsZSBvYmpl
Y3Qgb3BlbiBmb3Igd3JpdGluZyAob3IKICAgICAgICBhbnl0aGluZyB3aXRoIGEgd3JpdGUo
KSBtZXRob2QpLgoKICAgICAgICBUaGUgb25seSByZWFzb24gZm9yIG92ZXJyaWRpbmcgdGhp
cyB3b3VsZCBiZSB0byBjaGFuZ2UKICAgICAgICB0aGUgYmxvY2sgc2l6ZSBvciBwZXJoYXBz
IHRvIHJlcGxhY2UgbmV3bGluZXMgYnkgQ1JMRgogICAgICAgIC0tIG5vdGUgaG93ZXZlciB0
aGF0IHRoaXMgdGhlIGRlZmF1bHQgc2VydmVyIHVzZXMgdGhpcwogICAgICAgIHRvIGNvcHkg
YmluYXJ5IGRhdGEgYXMgd2VsbC4KCiAgICAgICAgIiIiCiAgICAgICAgc2h1dGlsLmNvcHlm
aWxlb2JqKHNvdXJjZSwgb3V0cHV0ZmlsZSkKCiAgICBkZWYgZ3Vlc3NfdHlwZShzZWxmLCBw
YXRoKToKICAgICAgICAiIiJHdWVzcyB0aGUgdHlwZSBvZiBhIGZpbGUuCgogICAgICAgIEFy
Z3VtZW50IGlzIGEgUEFUSCAoYSBmaWxlbmFtZSkuCgogICAgICAgIFJldHVybiB2YWx1ZSBp
cyBhIHN0cmluZyBvZiB0aGUgZm9ybSB0eXBlL3N1YnR5cGUsCiAgICAgICAgdXNhYmxlIGZv
ciBhIE1JTUUgQ29udGVudC10eXBlIGhlYWRlci4KCiAgICAgICAgVGhlIGRlZmF1bHQgaW1w
bGVtZW50YXRpb24gbG9va3MgdGhlIGZpbGUncyBleHRlbnNpb24KICAgICAgICB1cCBpbiB0
aGUgdGFibGUgc2VsZi5leHRlbnNpb25zX21hcCwgdXNpbmcgYXBwbGljYXRpb24vb2N0ZXQt
c3RyZWFtCiAgICAgICAgYXMgYSBkZWZhdWx0OyBob3dldmVyIGl0IHdvdWxkIGJlIHBlcm1p
c3NpYmxlIChpZgogICAgICAgIHNsb3cpIHRvIGxvb2sgaW5zaWRlIHRoZSBkYXRhIHRvIG1h
a2UgYSBiZXR0ZXIgZ3Vlc3MuCgogICAgICAgICIiIgoKICAgICAgICBiYXNlLCBleHQgPSBw
b3NpeHBhdGguc3BsaXRleHQocGF0aCkKICAgICAgICBpZiBleHQgaW4gc2VsZi5leHRlbnNp
b25zX21hcDoKICAgICAgICAgICAgcmV0dXJuIHNlbGYuZXh0ZW5zaW9uc19tYXBbZXh0XQog
ICAgICAgIGV4dCA9IGV4dC5sb3dlcigpCiAgICAgICAgaWYgZXh0IGluIHNlbGYuZXh0ZW5z
aW9uc19tYXA6CiAgICAgICAgICAgIHJldHVybiBzZWxmLmV4dGVuc2lvbnNfbWFwW2V4dF0K
ICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gc2VsZi5leHRlbnNpb25zX21hcFsn
J10KCiAgICBpZiBub3QgbWltZXR5cGVzLmluaXRlZDoKICAgICAgICBtaW1ldHlwZXMuaW5p
dCgpICMgdHJ5IHRvIHJlYWQgc3lzdGVtIG1pbWUudHlwZXMKICAgIGV4dGVuc2lvbnNfbWFw
ID0gbWltZXR5cGVzLnR5cGVzX21hcC5jb3B5KCkKICAgIGV4dGVuc2lvbnNfbWFwLnVwZGF0
ZSh7CiAgICAgICAgJyc6ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nLCAjIERlZmF1bHQK
ICAgICAgICAnLnB5JzogJ3RleHQvcGxhaW4nLAogICAgICAgICcuYyc6ICd0ZXh0L3BsYWlu
JywKICAgICAgICAnLmgnOiAndGV4dC9wbGFpbicsCiAgICAgICAgfSkKCgojIFV0aWxpdGll
cyBmb3IgQ0dJSFRUUFJlcXVlc3RIYW5kbGVyCgpkZWYgY2hlY2tfcGF0aF9jb21wb25lbnQo
cGF0aF9jb21wb25lbnQpOgogICAgZHJpdmUsIHdvcmQgPSBvcy5wYXRoLnNwbGl0ZHJpdmUo
cGF0aF9jb21wb25lbnQpCiAgICBoZWFkLCB3b3JkID0gb3MucGF0aC5zcGxpdCh3b3JkKQog
ICAgaWYgd29yZCBpbiAob3MuY3VyZGlyLCBvcy5wYXJkaXIpIG9yIGRyaXZlIG9yIGhlYWQ6
CiAgICAgICAgcmFpc2UgVmFsdWVFcnJvciAjIHdoYXQgdG8gcmFpc2U/CiAgICAgICAgCmRl
ZiBwYXJzZV91cmwoIHBhdGggKToKICAgIGl4ID0gcGF0aC5maW5kKCcjJykKICAgIGlmIGl4
ID49IDA6CiAgICAgICAgcGF0aCwgZnJhZyA9IHBhdGhbOml4XSwgcGF0aFtpeCsxOl0KICAg
IGVsc2U6CiAgICAgICAgZnJhZyA9ICcnCiAgICBpeCA9IHBhdGguZmluZCgnPycpCiAgICBp
ZiBpeCA+PSAwOgogICAgICAgIHBhdGgsIHF1ZXJ5ID0gcGF0aFs6aXhdLCBwYXRoW2l4KzE6
XQogICAgZWxzZToKICAgICAgICBxdWVyeSA9ICcnCiAgICBwYXRoID0gX3VybF9jb2xsYXBz
ZV9wYXRoKCB1cmxsaWIucGFyc2UudW5xdW90ZSggcGF0aCApKQogICAgcmV0dXJuIHBhdGgs
IHF1ZXJ5LCBmcmFnCiAgICAgICAgCmRlZiBfdXJsX2NvbGxhcHNlX3BhdGgocGF0aCk6CiAg
ICAiIiIKICAgIEdpdmVuIGEgVVJMIHBhdGgsIHJlbW92ZSBleHRyYSAnLydzIGFuZCAnLicg
cGF0aCBlbGVtZW50cyBhbmQgY29sbGFwc2UKICAgIGFueSAnLi4nIHJlZmVyZW5jZXMgYW5k
IHJldHVybnMgYSBjb2xsYXBzZWQgcGF0aC4KCiAgICBJbXBsZW1lbnRzIHNvbWV0aGluZyBh
a2luIHRvIFJGQy0yMzk2IDUuMiBzdGVwIDYgdG8gcGFyc2UgcmVsYXRpdmUgcGF0aHMuCiAg
ICBUaGUgdXRpbGl0eSBvZiB0aGlzIGZ1bmN0aW9uIGlzIGxpbWl0ZWQgdG8gaXNfY2dpIG1l
dGhvZCBhbmQgaGVscHMKICAgIHByZXZlbnRpbmcgc29tZSBzZWN1cml0eSBhdHRhY2tzLgoK
ICAgIFJldHVybnM6IEEgdHVwbGUgb2YgKGhlYWQsIHRhaWwpIHdoZXJlIHRhaWwgaXMgZXZl
cnl0aGluZyBhZnRlciB0aGUgZmluYWwgLwogICAgYW5kIGhlYWQgaXMgZXZlcnl0aGluZyBi
ZWZvcmUgaXQuICBIZWFkIHdpbGwgYWx3YXlzIHN0YXJ0IHdpdGggYSAnLycgYW5kLAogICAg
aWYgaXQgY29udGFpbnMgYW55dGhpbmcgZWxzZSwgbmV2ZXIgaGF2ZSBhIHRyYWlsaW5nICcv
Jy4KCiAgICBSYWlzZXM6IEluZGV4RXJyb3IgaWYgdG9vIG1hbnkgJy4uJyBvY2N1ciB3aXRo
aW4gdGhlIHBhdGguCgogICAgIiIiCiAgICAjIFNpbWlsYXIgdG8gb3MucGF0aC5zcGxpdChv
cy5wYXRoLm5vcm1wYXRoKHBhdGgpKSBidXQgc3BlY2lmaWMgdG8gVVJMCiAgICAjIHBhdGgg
c2VtYW50aWNzIHJhdGhlciB0aGFuIGxvY2FsIG9wZXJhdGluZyBzeXN0ZW0gc2VtYW50aWNz
LgogICAgcGF0aF9wYXJ0cyA9IHBhdGguc3BsaXQoJy8nKQogICAgaGVhZF9wYXJ0cyA9IFtd
CiAgICBmb3IgcGFydCBpbiBwYXRoX3BhcnRzWzotMV06CiAgICAgICAgaWYgcGFydCA9PSAn
Li4nOgogICAgICAgICAgICBoZWFkX3BhcnRzLnBvcCgpICMgSW5kZXhFcnJvciBpZiBtb3Jl
ICcuLicgdGhhbiBwcmlvciBwYXJ0cwogICAgICAgIGVsaWYgcGFydCBhbmQgcGFydCAhPSAn
Lic6CiAgICAgICAgICAgIGNoZWNrX3BhdGhfY29tcG9uZW50KCBwYXJ0ICkKICAgICAgICAg
ICAgaGVhZF9wYXJ0cy5hcHBlbmQoIHBhcnQgKQogICAgaWYgcGF0aF9wYXJ0czoKICAgICAg
ICB0YWlsX3BhcnQgPSBwYXRoX3BhcnRzLnBvcCgpCiAgICAgICAgaWYgdGFpbF9wYXJ0Ogog
ICAgICAgICAgICBpZiB0YWlsX3BhcnQgPT0gJy4uJzoKICAgICAgICAgICAgICAgIGhlYWRf
cGFydHMucG9wKCkKICAgICAgICAgICAgICAgIHRhaWxfcGFydCA9ICcnCiAgICAgICAgICAg
IGVsaWYgdGFpbF9wYXJ0ID09ICcuJzoKICAgICAgICAgICAgICAgIHRhaWxfcGFydCA9ICcn
CiAgICBlbHNlOgogICAgICAgIHRhaWxfcGFydCA9ICcnCiAgICBjaGVja19wYXRoX2NvbXBv
bmVudCggdGFpbF9wYXJ0ICkKICAgIGhlYWRfcGFydHMuYXBwZW5kKCB0YWlsX3BhcnQgKQog
ICAgcmV0dXJuICcvJyArICcvJy5qb2luKGhlYWRfcGFydHMpCgoKbm9ib2R5ID0gTm9uZQoK
ZGVmIG5vYm9keV91aWQoKToKICAgICIiIkludGVybmFsIHJvdXRpbmUgdG8gZ2V0IG5vYm9k
eSdzIHVpZCIiIgogICAgZ2xvYmFsIG5vYm9keQogICAgaWYgbm9ib2R5OgogICAgICAgIHJl
dHVybiBub2JvZHkKICAgIHRyeToKICAgICAgICBpbXBvcnQgcHdkCiAgICBleGNlcHQgSW1w
b3J0RXJyb3I6CiAgICAgICAgcmV0dXJuIC0xCiAgICB0cnk6CiAgICAgICAgbm9ib2R5ID0g
cHdkLmdldHB3bmFtKCdub2JvZHknKVsyXQogICAgZXhjZXB0IEtleUVycm9yOgogICAgICAg
IG5vYm9keSA9IDEgKyBtYXgoeFsyXSBmb3IgeCBpbiBwd2QuZ2V0cHdhbGwoKSkKICAgIHJl
dHVybiBub2JvZHkKCgpkZWYgZXhlY3V0YWJsZShwYXRoKToKICAgICIiIlRlc3QgZm9yIGV4
ZWN1dGFibGUgZmlsZS4iIiIKICAgIHJldHVybiBvcy5hY2Nlc3MocGF0aCwgb3MuWF9PSykK
CgpjbGFzcyBDR0lIVFRQUmVxdWVzdEhhbmRsZXIoU2ltcGxlSFRUUFJlcXVlc3RIYW5kbGVy
KToKCiAgICAiIiJDb21wbGV0ZSBIVFRQIHNlcnZlciB3aXRoIEdFVCwgSEVBRCBhbmQgUE9T
VCBjb21tYW5kcy4KCiAgICBHRVQgYW5kIEhFQUQgYWxzbyBzdXBwb3J0IHJ1bm5pbmcgQ0dJ
IHNjcmlwdHMuCgogICAgVGhlIFBPU1QgY29tbWFuZCBpcyAqb25seSogaW1wbGVtZW50ZWQg
Zm9yIENHSSBzY3JpcHRzLgoKICAgICIiIgoKICAgICMgRGV0ZXJtaW5lIHBsYXRmb3JtIHNw
ZWNpZmljcwogICAgaGF2ZV9mb3JrID0gaGFzYXR0cihvcywgJ2ZvcmsnKQoKICAgICMgTWFr
ZSByZmlsZSB1bmJ1ZmZlcmVkIC0tIHdlIG5lZWQgdG8gcmVhZCBvbmUgbGluZSBhbmQgdGhl
biBwYXNzCiAgICAjIHRoZSByZXN0IHRvIGEgc3VicHJvY2Vzcywgc28gd2UgY2FuJ3QgdXNl
IGJ1ZmZlcmVkIGlucHV0LgogICAgcmJ1ZnNpemUgPSAwCgogICAgZGVmIGRvX1BPU1Qoc2Vs
Zik6CiAgICAgICAgIiIiU2VydmUgYSBQT1NUIHJlcXVlc3QuCgogICAgICAgIFRoaXMgaXMg
b25seSBpbXBsZW1lbnRlZCBmb3IgQ0dJIHNjcmlwdHMuCgogICAgICAgICIiIgoKICAgICAg
ICBpZiBzZWxmLmlzX2NnaSgpOgogICAgICAgICAgICBzZWxmLnJ1bl9jZ2koKQogICAgICAg
IGVsc2U6CiAgICAgICAgICAgIHNlbGYuc2VuZF9lcnJvcig1MDEsICJDYW4gb25seSBQT1NU
IHRvIENHSSBzY3JpcHRzIikKCiAgICBkZWYgc2VuZF9oZWFkKHNlbGYpOgogICAgICAgICIi
IlZlcnNpb24gb2Ygc2VuZF9oZWFkIHRoYXQgc3VwcG9ydCBDR0kgc2NyaXB0cyIiIgogICAg
ICAgIGlmIHNlbGYuaXNfY2dpKCk6CiAgICAgICAgICAgIHJldHVybiBzZWxmLnJ1bl9jZ2ko
KQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBTaW1wbGVIVFRQUmVxdWVzdEhh
bmRsZXIuc2VuZF9oZWFkKHNlbGYpCgogICAgZGVmIGlzX2NnaShzZWxmKToKICAgICAgICAi
IiJUZXN0IHdoZXRoZXIgc2VsZi5wYXRoIGNvcnJlc3BvbmRzIHRvIGEgQ0dJIHNjcmlwdC4K
CiAgICAgICAgUmV0dXJucyBUcnVlIGFuZCB1cGRhdGVzIHRoZSBjZ2lfaW5mbyBhdHRyaWJ1
dGUgdG8gdGhlIHR1cGxlCiAgICAgICAgKGRpciwgcmVzdCkgaWYgc2VsZi5wYXRoIHJlcXVp
cmVzIHJ1bm5pbmcgYSBDR0kgc2NyaXB0LgogICAgICAgIFJldHVybnMgRmFsc2Ugb3RoZXJ3
aXNlLgoKICAgICAgICBJZiBhbnkgZXhjZXB0aW9uIGlzIHJhaXNlZCwgdGhlIGNhbGxlciBz
aG91bGQgYXNzdW1lIHRoYXQKICAgICAgICBzZWxmLnBhdGggd2FzIHJlamVjdGVkIGFzIGlu
dmFsaWQgYW5kIGFjdCBhY2NvcmRpbmdseS4KCiAgICAgICAgVGhlIGRlZmF1bHQgaW1wbGVt
ZW50YXRpb24gdGVzdHMgd2hldGhlciB0aGUgbm9ybWFsaXplZCB1cmwKICAgICAgICBwYXRo
IGJlZ2lucyB3aXRoIG9uZSBvZiB0aGUgc3RyaW5ncyBpbiBzZWxmLmNnaV9kaXJlY3Rvcmll
cwogICAgICAgIChhbmQgdGhlIG5leHQgY2hhcmFjdGVyIGlzIGEgJy8nIG9yIHRoZSBlbmQg
b2YgdGhlIHN0cmluZykuCgogICAgICAgICIiIgogICAgICAgIHBhdGggPSBzZWxmLnBhdGgK
ICAgICAgICBjbG4gPSBsZW4oIHBhdGggKQogICAgICAgIGZvdW5kID0gRmFsc2UKICAgICAg
ICBmb3IgaXggaW4gc2VsZi5jZ2lfZGlyZWN0b3JpZXM6CiAgICAgICAgICAgIGxuID0gbGVu
KCBpeCApCiAgICAgICAgICAgIGlmIGxuID09IGNsbiAgYW5kICBpeCA9PSBwYXRoOgogICAg
ICAgICAgICAgICAgc2VsZi5jZ2lfaW5mbyA9ICggaXgsICcnKQogICAgICAgICAgICAgICAg
Zm91bmQgPSBUcnVlCiAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICBlbGlmICgg
bG4gPCBjbG4gIGFuZCAgcGF0aFsgbG4gXSA9PSAnLycKICAgICAgICAgICAgICAgICAgIGFu
ZCAgcGF0aC5zdGFydHN3aXRoKCBpeCApKToKICAgICAgICAgICAgICAgIHNlbGYuY2dpX2lu
Zm8gPSAoIGl4LCBwYXRoWyBsbisxOiBdKQogICAgICAgICAgICAgICAgZm91bmQgPSBUcnVl
CiAgICAgICAgICAgICAgICBicmVhawogICAgICAgIHJldHVybiBmb3VuZAoKCiAgICBjZ2lf
ZGlyZWN0b3JpZXMgPSBbJy9jZ2ktYmluJywgJy9odGJpbiddCgogICAgZGVmIGlzX2V4ZWN1
dGFibGUoc2VsZiwgcGF0aCk6CiAgICAgICAgIiIiVGVzdCB3aGV0aGVyIGFyZ3VtZW50IHBh
dGggaXMgYW4gZXhlY3V0YWJsZSBmaWxlLiIiIgogICAgICAgIHJldHVybiBleGVjdXRhYmxl
KHBhdGgpCgogICAgZGVmIGlzX3B5dGhvbihzZWxmLCBwYXRoKToKICAgICAgICAiIiJUZXN0
IHdoZXRoZXIgYXJndW1lbnQgcGF0aCBpcyBhIFB5dGhvbiBzY3JpcHQuIiIiCiAgICAgICAg
aGVhZCwgdGFpbCA9IG9zLnBhdGguc3BsaXRleHQocGF0aCkKICAgICAgICByZXR1cm4gdGFp
bC5sb3dlcigpIGluICgiLnB5IiwgIi5weXciKQoKICAgIGRlZiBtYWtlX2NtZGxpbmUoIHNl
bGYsIHNjcmlwdGZpbGUsIHF1ZXJ5ICk6CiAgICAgICAgY21kbGluZSA9IFtzY3JpcHRmaWxl
XQogICAgICAgIGlmIHNlbGYuaXNfcHl0aG9uKHNjcmlwdGZpbGUpOgogICAgICAgICAgICBp
bnRlcnAgPSBzeXMuZXhlY3V0YWJsZQogICAgICAgICAgICBpZiBpbnRlcnAubG93ZXIoKS5l
bmRzd2l0aCgidy5leGUiKToKICAgICAgICAgICAgICAgICMgT24gV2luZG93cywgdXNlIHB5
dGhvbi5leGUsIG5vdCBweXRob253LmV4ZQogICAgICAgICAgICAgICAgaW50ZXJwID0gaW50
ZXJwWzotNV0gKyBpbnRlcnBbLTQ6XQogICAgICAgICAgICBjbWRsaW5lID0gW2ludGVycCwg
Jy11J10gKyBjbWRsaW5lCiAgICAgICAgaWYgJz0nIG5vdCBpbiBxdWVyeToKICAgICAgICAg
ICAgY21kbGluZS5hcHBlbmQocXVlcnkpCgogICAgZGVmIF9yZWFkZXJ0aHJlYWQoc2VsZiwg
ZmgsIGJ1ZmZlcik6CiAgICAgICAgYnVmZmVyLmFwcGVuZChmaC5yZWFkKCkpCiAgICAgICAg
ZmguY2xvc2UoKQoKICAgIHJlcWNvdW50ID0gMAogICAgZGVmIF93cml0ZXJ0aHJlYWQoc2Vs
ZiwgZmhyLCBmaHcsIGxlbmd0aD1Ob25lKToKICAgICAgICBpZiBsZW5ndGggaXMgTm9uZToK
ICAgICAgICAgICAgZmxhZyA9IFRydWUKICAgICAgICAgICAgd2hpbGUgZmxhZzoKICAgICAg
ICAgICAgICAgIGJ1ZiA9IGZoci5yZWFkKCA1MTIgKQogICAgICAgICAgICAgICAgZmh3Lndy
aXRlKCBidWYgKQogICAgICAgICAgICAgICAgaWYgbGVuKCBidWYgKSA9PSAwOgogICAgICAg
ICAgICAgICAgICAgIGZsYWcgPSBGYWxzZQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHNl
bGYucmVxY291bnQgKz0gMQogICAgICAgICAgICBsb2dmaCA9IG9wZW4oImQ6XFx0ZW1wXFxz
ZXJ2ZXJfbG9nXyVkLmxvZyIgJSBzZWxmLnJlcWNvdW50LCAid2IiKQogICAgICAgICAgICBs
b2dmaC53cml0ZShiIi0tLS0tLSBib3VuZGFyeSAtLS0tLS1cbiIpCiAgICAgICAgICAgIHdo
aWxlIGxlbmd0aCA+IDA6CiAgICAgICAgICAgICAgICBidWYgPSBmaHIucmVhZCggbWluKCA1
MTIsIGxlbmd0aCApKQogICAgICAgICAgICAgICAgbG9nZmgud3JpdGUoIGJ1ZiApCiAgICAg
ICAgICAgICAgICBmaHcud3JpdGUoIGJ1ZiApCiAgICAgICAgICAgICAgICBsZW5ndGggLT0g
bGVuKCBidWYgKQogICAgICAgICAgICBsb2dmaC53cml0ZShiIi0tLS0tLSBib3VuZGFyeSAt
LS0tLS1cbiIpCiAgICAgICAgICAgIGxvZ2ZoLmNsb3NlKCkKICAgICAgICAjIHRocm93IGF3
YXkgYWRkaXRpb25hbCBkYXRhIFtzZWUgYnVnICM0MjczNDVdCiAgICAgICAgd2hpbGUgc2Vs
ZWN0LnNlbGVjdChbZmhyLl9zb2NrXSwgW10sIFtdLCAwKVswXToKICAgICAgICAgICAgaWYg
bm90IGZoci5fc29jay5yZWN2KDEpOgogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICBm
aHcuY2xvc2UoKQoKICAgIGRlZiBydW5fY2dpKHNlbGYpOgogICAgICAgICIiIkV4ZWN1dGUg
YSBDR0kgc2NyaXB0LiIiIgogICAgICAgIGRpciwgcmVzdCA9IHNlbGYuY2dpX2luZm8KICAg
ICAgICBkaXJ0cmFucyA9IHNlbGYudHJhbnNsYXRlX3BhdGgoIGRpciApCiAgICAgICAgd29y
ZHMgPSByZXN0LnNwbGl0KCcvJykKICAgICAgICB3aGlsZSB3b3JkczoKICAgICAgICAgICAg
d29yZCA9IHdvcmRzLnBvcCggMCApCiAgICAgICAgICAgIG5leHRkaXIgPSAnLycuam9pbihb
IGRpciwgd29yZCBdKQogICAgICAgICAgICBzY3JpcHRmaWxlID0gb3MucGF0aC5qb2luKCBk
aXJ0cmFucywgd29yZCApCiAgICAgICAgICAgIGlmIG9zLnBhdGguaXNkaXIoIHNjcmlwdGZp
bGUgKTogIyBpZiBkaXIsIG5vdCBzY3JpcHRmaWxlIHlldAogICAgICAgICAgICAgICAgZGly
ID0gbmV4dGRpcgogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcmVzdCA9ICcv
JyArICcvJy5qb2luKCB3b3JkcyApCiAgICAgICAgICAgICAgICBzY3JpcHRuYW1lID0gbmV4
dGRpcgogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICBlbHNlOgogICAgICAgICAgICBy
ZXN0ID0gJy8nCiAgICAgICAgICAgIHNjcmlwdG5hbWUgPSBuZXh0ZGlyCgogICAgICAgIHBy
aW50KCdydW5fY2dpOiBzZiAlcyBzbiAlcyBwaSAlcycgJSAoIHNjcmlwdGZpbGUsIHNjcmlw
dG5hbWUsIHJlc3QgKSkKICAgICAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMoc2NyaXB0Zmls
ZSk6CiAgICAgICAgICAgIHNlbGYuc2VuZF9lcnJvcig0MDQsICJObyBzdWNoIENHSSBzY3Jp
cHQgKCVyKSIgJSBzY3JpcHRuYW1lKQogICAgICAgICAgICByZXR1cm4KICAgICAgICBpZiBu
b3Qgb3MucGF0aC5pc2ZpbGUoc2NyaXB0ZmlsZSk6CiAgICAgICAgICAgIHNlbGYuc2VuZF9l
cnJvcig0MDMsICJDR0kgc2NyaXB0IGlzIG5vdCBhIHBsYWluIGZpbGUgKCVyKSIgJQogICAg
ICAgICAgICAgICAgICAgICAgICAgICAgc2NyaXB0bmFtZSkKICAgICAgICAgICAgcmV0dXJu
CiAgICAgICAgaXNweSA9IHNlbGYuaXNfcHl0aG9uKHNjcmlwdG5hbWUpCiAgICAgICAgaWYg
bm90IGlzcHk6CiAgICAgICAgICAgIGlmIG5vdCBzZWxmLmlzX2V4ZWN1dGFibGUoc2NyaXB0
ZmlsZSk6CiAgICAgICAgICAgICAgICBzZWxmLnNlbmRfZXJyb3IoNDAzLCAiQ0dJIHNjcmlw
dCBpcyBub3QgZXhlY3V0YWJsZSAoJXIpIiAlCiAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgc2NyaXB0bmFtZSkKICAgICAgICAgICAgICAgIHJldHVybgoKICAgICAgICAjIFJl
ZmVyZW5jZTogaHR0cDovL2hvb2hvby5uY3NhLnVpdWMuZWR1L2NnaS9lbnYuaHRtbAogICAg
ICAgICMgWFhYIE11Y2ggb2YgdGhlIGZvbGxvd2luZyBjb3VsZCBiZSBwcmVwYXJlZCBhaGVh
ZCBvZiB0aW1lIQogICAgICAgIGVudiA9IGNvcHkuZGVlcGNvcHkob3MuZW52aXJvbikKICAg
ICAgICBlbnZbJ1NFUlZFUl9TT0ZUV0FSRSddID0gc2VsZi52ZXJzaW9uX3N0cmluZygpCiAg
ICAgICAgZW52WydTRVJWRVJfTkFNRSddID0gc2VsZi5zZXJ2ZXIuc2VydmVyX25hbWUKICAg
ICAgICBlbnZbJ0dBVEVXQVlfSU5URVJGQUNFJ10gPSAnQ0dJLzEuMScKICAgICAgICBlbnZb
J1NFUlZFUl9QUk9UT0NPTCddID0gc2VsZi5wcm90b2NvbF92ZXJzaW9uCiAgICAgICAgZW52
WydTRVJWRVJfUE9SVCddID0gc3RyKHNlbGYuc2VydmVyLnNlcnZlcl9wb3J0KQogICAgICAg
IGVudlsnUkVRVUVTVF9NRVRIT0QnXSA9IHNlbGYuY29tbWFuZAogICAgICAgIGVudlsnUEFU
SF9JTkZPJ10gPSByZXN0CiAgICAgICAgZW52WydQQVRIX1RSQU5TTEFURUQnXSA9IHNlbGYu
dHJhbnNsYXRlX3BhdGgoIHJlc3QgKQogICAgICAgIGVudlsnU0NSSVBUX05BTUUnXSA9IHNj
cmlwdG5hbWUKICAgICAgICBlbnZbJ1FVRVJZX1NUUklORyddID0gc2VsZi5xdWVyeQogICAg
ICAgIGhvc3QgPSBzZWxmLmFkZHJlc3Nfc3RyaW5nKCkKICAgICAgICBpZiBob3N0ICE9IHNl
bGYuY2xpZW50X2FkZHJlc3NbMF06CiAgICAgICAgICAgIGVudlsnUkVNT1RFX0hPU1QnXSA9
IGhvc3QKICAgICAgICBlbnZbJ1JFTU9URV9BRERSJ10gPSBzZWxmLmNsaWVudF9hZGRyZXNz
WzBdCiAgICAgICAgZW52WydSRVFVRVNUX1VSSSddID0gc2VsZi5yZXF1ZXN0X3VyaQogICAg
ICAgIGF1dGhvcml6YXRpb24gPSBzZWxmLmhlYWRlcnMuZ2V0KCJhdXRob3JpemF0aW9uIikK
ICAgICAgICBpZiBhdXRob3JpemF0aW9uOgogICAgICAgICAgICBhdXRob3JpemF0aW9uID0g
YXV0aG9yaXphdGlvbi5zcGxpdCgpCiAgICAgICAgICAgIGlmIGxlbihhdXRob3JpemF0aW9u
KSA9PSAyOgogICAgICAgICAgICAgICAgaW1wb3J0IGJhc2U2NCwgYmluYXNjaWkKICAgICAg
ICAgICAgICAgIGVudlsnQVVUSF9UWVBFJ10gPSBhdXRob3JpemF0aW9uWzBdCiAgICAgICAg
ICAgICAgICBpZiBhdXRob3JpemF0aW9uWzBdLmxvd2VyKCkgPT0gImJhc2ljIjoKICAgICAg
ICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgIGF1dGhvcml6YXRp
b24gPSBhdXRob3JpemF0aW9uWzFdLmVuY29kZSgnYXNjaWknKQogICAgICAgICAgICAgICAg
ICAgICAgICBhdXRob3JpemF0aW9uID0gYmFzZTY0LmRlY29kZWJ5dGVzKGF1dGhvcml6YXRp
b24pLlwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlY29kZSgn
YXNjaWknKQogICAgICAgICAgICAgICAgICAgIGV4Y2VwdCAoYmluYXNjaWkuRXJyb3IsIFVu
aWNvZGVFcnJvcik6CiAgICAgICAgICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAgICAg
ICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBhdXRob3JpemF0aW9uID0g
YXV0aG9yaXphdGlvbi5zcGxpdCgnOicpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGxl
bihhdXRob3JpemF0aW9uKSA9PSAyOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW52
WydSRU1PVEVfVVNFUiddID0gYXV0aG9yaXphdGlvblswXQogICAgICAgIGhvc3RzdHJpbmcg
PSBzZWxmLmhlYWRlcnMuZ2V0KCJob3N0IikKICAgICAgICBpZiBob3N0c3RyaW5nOgogICAg
ICAgICAgICBob3N0LCBwb3J0ID0gaG9zdHN0cmluZy5zcGxpdCgnOicpCiAgICAgICAgICAg
IGVudlsnSFRUUF9IT1NUJ10gPSBob3N0CiAgICAgICAgICAgIGVudlsnSFRUUF9QT1JUJ10g
PSBwb3J0CiAgICAgICAgIyBYWFggUkVNT1RFX0lERU5UCiAgICAgICAgaWYgc2VsZi5oZWFk
ZXJzLmdldCgnY29udGVudC10eXBlJykgaXMgTm9uZToKICAgICAgICAgICAgZW52WydDT05U
RU5UX1RZUEUnXSA9IHNlbGYuaGVhZGVycy5nZXRfY29udGVudF90eXBlKCkKICAgICAgICBl
bHNlOgogICAgICAgICAgICBlbnZbJ0NPTlRFTlRfVFlQRSddID0gc2VsZi5oZWFkZXJzWydj
b250ZW50LXR5cGUnXQogICAgICAgIGxlbmd0aCA9IHNlbGYuaGVhZGVycy5nZXQoJ2NvbnRl
bnQtbGVuZ3RoJykKICAgICAgICBpZiBsZW5ndGg6CiAgICAgICAgICAgIGVudlsnQ09OVEVO
VF9MRU5HVEgnXSA9IGxlbmd0aAogICAgICAgIHJlZmVyZXIgPSBzZWxmLmhlYWRlcnMuZ2V0
KCdyZWZlcmVyJykKICAgICAgICBpZiByZWZlcmVyOgogICAgICAgICAgICBlbnZbJ0hUVFBf
UkVGRVJFUiddID0gcmVmZXJlcgogICAgICAgIGFjY2VwdCA9IFtdCiAgICAgICAgZm9yIGxp
bmUgaW4gc2VsZi5oZWFkZXJzLmdldGFsbG1hdGNoaW5naGVhZGVycygnYWNjZXB0Jyk6CiAg
ICAgICAgICAgIGlmIGxpbmVbOjFdIGluICJcdFxuXHIgIjoKICAgICAgICAgICAgICAgIGFj
Y2VwdC5hcHBlbmQobGluZS5zdHJpcCgpKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAg
ICAgICAgYWNjZXB0ID0gYWNjZXB0ICsgbGluZVs3Ol0uc3BsaXQoJywnKQogICAgICAgIGVu
dlsnSFRUUF9BQ0NFUFQnXSA9ICcsJy5qb2luKGFjY2VwdCkKICAgICAgICB1YSA9IHNlbGYu
aGVhZGVycy5nZXQoJ3VzZXItYWdlbnQnKQogICAgICAgIGlmIHVhOgogICAgICAgICAgICBl
bnZbJ0hUVFBfVVNFUl9BR0VOVCddID0gdWEKICAgICAgICBjbyA9IGZpbHRlcihOb25lLCBz
ZWxmLmhlYWRlcnMuZ2V0X2FsbCgnY29va2llJywgW10pKQogICAgICAgIGNvb2tpZV9zdHIg
PSAnLCAnLmpvaW4oY28pCiAgICAgICAgaWYgY29va2llX3N0cjoKICAgICAgICAgICAgZW52
WydIVFRQX0NPT0tJRSddID0gY29va2llX3N0cgogICAgICAgICMgWFhYIE90aGVyIEhUVFBf
KiBoZWFkZXJzCiAgICAgICAgIyBTaW5jZSB3ZSdyZSBzZXR0aW5nIHRoZSBlbnYgaW4gdGhl
IHBhcmVudCwgcHJvdmlkZSBlbXB0eQogICAgICAgICMgdmFsdWVzIHRvIG92ZXJyaWRlIHBy
ZXZpb3VzbHkgc2V0IHZhbHVlcwogICAgICAgIGZvciBrIGluICgnUVVFUllfU1RSSU5HJywg
J1JFTU9URV9IT1NUJywgJ0NPTlRFTlRfTEVOR1RIJywKICAgICAgICAgICAgICAgICAgJ0hU
VFBfVVNFUl9BR0VOVCcsICdIVFRQX0NPT0tJRScsICdIVFRQX1JFRkVSRVInKToKICAgICAg
ICAgICAgZW52LnNldGRlZmF1bHQoaywgIiIpCgogICAgICAgIGRlY29kZWRfcXVlcnkgPSBz
ZWxmLnF1ZXJ5LnJlcGxhY2UoJysnLCAnICcpCgogICAgICAgIGlmIHNlbGYuaGF2ZV9mb3Jr
OgogICAgICAgICAgICAjIG1vdmVkIGZyb20gYWJvdmUsIHNob3VsZCBmaXggdGhpcyBwYXRo
IHRvbzsgaW5zdGVhZCBqdXN0IGxlZnQgaXQKICAgICAgICAgICAgc2VsZi5zZW5kX3Jlc3Bv
bnNlKDIwMCwgIlNjcmlwdCBvdXRwdXQgZm9sbG93cyIpCiAgICAgICAgICAgIHNlbGYuZmx1
c2hfaGVhZGVycygpCgogICAgICAgICAgICAjIFVuaXggLS0gZm9yayBhcyB3ZSBzaG91bGQK
ICAgICAgICAgICAgYXJncyA9IFtzY3JpcHRdCiAgICAgICAgICAgIGlmICc9JyBub3QgaW4g
ZGVjb2RlZF9xdWVyeToKICAgICAgICAgICAgICAgIGFyZ3MuYXBwZW5kKGRlY29kZWRfcXVl
cnkpCiAgICAgICAgICAgIG5vYm9keSA9IG5vYm9keV91aWQoKQogICAgICAgICAgICBzZWxm
LndmaWxlLmZsdXNoKCkgIyBBbHdheXMgZmx1c2ggYmVmb3JlIGZvcmtpbmcKICAgICAgICAg
ICAgcGlkID0gb3MuZm9yaygpCiAgICAgICAgICAgIGlmIHBpZCAhPSAwOgogICAgICAgICAg
ICAgICAgIyBQYXJlbnQKICAgICAgICAgICAgICAgIHBpZCwgc3RzID0gb3Mud2FpdHBpZChw
aWQsIDApCiAgICAgICAgICAgICAgICAjIHRocm93IGF3YXkgYWRkaXRpb25hbCBkYXRhIFtz
ZWUgYnVnICM0MjczNDVdCiAgICAgICAgICAgICAgICB3aGlsZSBzZWxlY3Quc2VsZWN0KFtz
ZWxmLnJmaWxlXSwgW10sIFtdLCAwKVswXToKICAgICAgICAgICAgICAgICAgICBpZiBub3Qg
c2VsZi5yZmlsZS5yZWFkKDEpOgogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAg
ICAgICAgICAgICAgaWYgc3RzOgogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nX2Vycm9y
KCJDR0kgc2NyaXB0IGV4aXQgc3RhdHVzICUjeCIsIHN0cykKICAgICAgICAgICAgICAgIHJl
dHVybgogICAgICAgICAgICAjIENoaWxkCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAg
ICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBvcy5zZXR1aWQobm9ib2R5KQogICAgICAg
ICAgICAgICAgZXhjZXB0IG9zLmVycm9yOgogICAgICAgICAgICAgICAgICAgIHBhc3MKICAg
ICAgICAgICAgICAgIG9zLmR1cDIoc2VsZi5yZmlsZS5maWxlbm8oKSwgMCkKICAgICAgICAg
ICAgICAgIG9zLmR1cDIoc2VsZi53ZmlsZS5maWxlbm8oKSwgMSkKICAgICAgICAgICAgICAg
IG9zLmV4ZWN2ZShzY3JpcHRmaWxlLCBhcmdzLCBlbnYpCiAgICAgICAgICAgIGV4Y2VwdDoK
ICAgICAgICAgICAgICAgIHNlbGYuc2VydmVyLmhhbmRsZV9lcnJvcihzZWxmLnJlcXVlc3Qs
IHNlbGYuY2xpZW50X2FkZHJlc3MpCiAgICAgICAgICAgICAgICBvcy5fZXhpdCgxMjcpCgog
ICAgICAgIGVsc2U6CiAgICAgICAgICAgICMgTm9uLVVuaXggLS0gdXNlIHN1YnByb2Nlc3MK
ICAgICAgICAgICAgaW1wb3J0IHN1YnByb2Nlc3MsIHRocmVhZGluZwogICAgICAgICAgICBj
bWRsaW5lID0gc2VsZi5tYWtlX2NtZGxpbmUoIHNjcmlwdGZpbGUsIHNlbGYucXVlcnkgKQog
ICAgICAgICAgICBzZWxmLmxvZ19tZXNzYWdlKCJjb21tYW5kOiAlcyIsIHN1YnByb2Nlc3Mu
bGlzdDJjbWRsaW5lKGNtZGxpbmUpKQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAg
ICBuYnl0ZXMgPSBpbnQobGVuZ3RoKQogICAgICAgICAgICBleGNlcHQgKFR5cGVFcnJvciwg
VmFsdWVFcnJvcik6CiAgICAgICAgICAgICAgICBuYnl0ZXMgPSAwCiAgICAgICAgICAgIHAg
PSBzdWJwcm9jZXNzLlBvcGVuKGNtZGxpbmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIHN0ZGluPXN1YnByb2Nlc3MuUElQRSwKICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgc3Rkb3V0PXN1YnByb2Nlc3MuUElQRSwKICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgc3RkZXJyPXN1YnByb2Nlc3MuUElQRSwKICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgZW52ID0gZW52CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICkKCiAgICAgICAgICAgIHN0ZGVyciA9IFtdCiAgICAgICAgICAgIHN0ZGVycl90aHJl
YWQgPSB0aHJlYWRpbmcuVGhyZWFkKHRhcmdldD1zZWxmLl9yZWFkZXJ0aHJlYWQsCiAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M9KHAuc3RkZXJy
LCBzdGRlcnIpKQogICAgICAgICAgICBzdGRlcnJfdGhyZWFkLmRhZW1vbiA9IFRydWUKICAg
ICAgICAgICAgc3RkZXJyX3RocmVhZC5zdGFydCgpCgogICAgICAgICAgICBzZWxmLmxvZ19t
ZXNzYWdlKCJ3cml0ZXI6ICVzIiwgc3RyKCBuYnl0ZXMgKSkKICAgICAgICAgICAgc3RkaW5f
dGhyZWFkID0gdGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9c2VsZi5fd3JpdGVydGhyZWFkLAog
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3M9KHNlbGYu
cmZpbGUsIHAuc3RkaW4sIG5ieXRlcykpCiAgICAgICAgICAgIHN0ZGluX3RocmVhZC5kYWVt
b24gPSBUcnVlCiAgICAgICAgICAgIHN0ZGluX3RocmVhZC5zdGFydCgpCgogICAgICAgICAg
ICBzdGF0dXNsaW5lID0gcC5zdGRvdXQucmVhZGxpbmUoKQogICAgICAgICAgICBzZWxmLmxv
Z19tZXNzYWdlKAogICAgICAgICAgICAgICAgInR5cGU6ICVzIGxpbmU6ICVzIiwKICAgICAg
ICAgICAgICAgIHN0ciggdHlwZSggc3RhdHVzbGluZSApKSwgc3RyKCBzdGF0dXNsaW5lICkp
CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHNsID0gc3RhdHVzbGluZS5zcGxp
dChiJzonLCAxICkKICAgICAgICAgICAgICAgIGlmIHNsWyAwIF0gIT0gYiJTdGF0dXMiICBv
ciAgbGVuKCBzbCApICE9IDI6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5zZW5kX3Jlc3Bv
bnNlKCA1MDAsICJCYWQgU3RhdHVzIGZyb20gQ0dJIikKICAgICAgICAgICAgICAgICAgICBz
ZWxmLmZsdXNoX2hlYWRlcnMoKQogICAgICAgICAgICAgICAgICAgIHNlbGYud2ZpbGUud3Jp
dGUoIHN0YXR1c2xpbmUgKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAg
ICAgICBzbCA9IHNsWyAxIF0uc3BsaXQoIE5vbmUsIDEgKQogICAgICAgICAgICAgICAgICAg
IGNvZGUgPSBpbnQoIHNsWyAwIF0pCiAgICAgICAgICAgICAgICAgICAgaWYgbGVuKCBzbCAp
ID09IDE6CiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQgPSBOb25lCiAgICAgICAgICAg
ICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dCA9IHNsWyAxIF0K
ICAgICAgICAgICAgICAgICAgICBzZWxmLnNlbmRfcmVzcG9uc2UoIGNvZGUsIHRleHQgKQog
ICAgICAgICAgICAgICAgICAgIHNlbGYuZmx1c2hfaGVhZGVycygpCiAgICAgICAgICAgIGV4
Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgICAgICBzZWxmLnNlbmRfcmVzcG9uc2UoIDUw
MCwgIkJhZCBTdGF0dXMgZnJvbSBDR0kiKQogICAgICAgICAgICAgICAgc2VsZi5mbHVzaF9o
ZWFkZXJzKCkKICAgICAgICAgICAgICAgIHNlbGYud2ZpbGUud3JpdGUoIHN0YXR1c2xpbmUg
KQogICAgICAgICAgICAjIHNlbGYuY29weWZpbGVvYmooIHAuc3Rkb3V0LCBzZWxmLndmaWxl
KSAjIGxvZ2dpbmcgdmVyc2lvbgogICAgICAgICAgICBzaHV0aWwuY29weWZpbGVvYmooIHAu
c3Rkb3V0LCBzZWxmLndmaWxlKQogICAgICAgICAgICBzdGF0dXMgPSBwLndhaXQoKQogICAg
ICAgICAgICBwLnN0ZG91dC5jbG9zZSgpCgogICAgICAgICAgICBzdGRlcnJfdGhyZWFkLmpv
aW4oKQogICAgICAgICAgICBzdGRpbl90aHJlYWQuam9pbigpCgogICAgICAgICAgICBpZiBz
dGRlcnI6CiAgICAgICAgICAgICAgICBzdGRlcnIgPSBzdGRlcnJbIDAgXS5kZWNvZGUoIlVU
Ri04IikKICAgICAgICAgICAgICAgIGlmIHN0ZGVycjoKICAgICAgICAgICAgICAgICAgICBz
ZWxmLmxvZ19lcnJvcignJXMnLCBzdGRlcnIgKQoKICAgICAgICAgICAgaWYgc3RhdHVzOgog
ICAgICAgICAgICAgICAgc2VsZi5sb2dfZXJyb3IoIkNHSSBzY3JpcHQgZXhpdCBzdGF0dXMg
JSN4Iiwgc3RhdHVzKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgc2VsZi5s
b2dfbWVzc2FnZSgiJXMiLCAiQ0dJIHNjcmlwdCBleGl0ZWQgT0siKQoKICAgIGRlZiBjb3B5
ZmlsZW9iaihzZWxmLCBmc3JjLCBmZHN0LCBsZW5ndGg9MTYqMTAyNCk6CiAgICAgICAgIiIi
Y29weSBkYXRhIGZyb20gZmlsZS1saWtlIG9iamVjdCBmc3JjIHRvIGZpbGUtbGlrZSBvYmpl
Y3QgZmRzdCIiIgogICAgICAgIHdoaWxlIDE6CiAgICAgICAgICAgIGJ1ZiA9IGZzcmMucmVh
ZChsZW5ndGgpCiAgICAgICAgICAgIHNlbGYubG9nX21lc3NhZ2UoImNvcHlmaWxlb2JqIGxl
bmd0aDogJWQiLCBsZW4oIGJ1ZiApKQogICAgICAgICAgICBpZiBub3QgYnVmOgogICAgICAg
ICAgICAgICAgYnJlYWsKICAgICAgICAgICAgc2VsZi5sb2dfbWVzc2FnZSgiJXMiLCBzdHIo
IGJ1ZiApKQogICAgICAgICAgICBmZHN0LndyaXRlKGJ1ZikKCmRlZiB0ZXN0KEhhbmRsZXJD
bGFzcyA9IEJhc2VIVFRQUmVxdWVzdEhhbmRsZXIsCiAgICAgICAgIFNlcnZlckNsYXNzID0g
SFRUUFNlcnZlciwgcHJvdG9jb2w9IkhUVFAvMS4wIik6CiAgICAiIiJUZXN0IHRoZSBIVFRQ
IHJlcXVlc3QgaGFuZGxlciBjbGFzcy4KCiAgICBUaGlzIHJ1bnMgYW4gSFRUUCBzZXJ2ZXIg
b24gcG9ydCA4MDAwIChvciB0aGUgZmlyc3QgY29tbWFuZCBsaW5lCiAgICBhcmd1bWVudCku
CgogICAgIiIiCgogICAgaWYgc3lzLmFyZ3ZbMTpdOgogICAgICAgIHBvcnQgPSBpbnQoc3lz
LmFyZ3ZbMV0pCiAgICBlbHNlOgogICAgICAgIHBvcnQgPSA4MDAwCiAgICBzZXJ2ZXJfYWRk
cmVzcyA9ICgnJywgcG9ydCkKCiAgICBIYW5kbGVyQ2xhc3MucHJvdG9jb2xfdmVyc2lvbiA9
IHByb3RvY29sCiAgICBodHRwZCA9IFNlcnZlckNsYXNzKHNlcnZlcl9hZGRyZXNzLCBIYW5k
bGVyQ2xhc3MpCgogICAgc2EgPSBodHRwZC5zb2NrZXQuZ2V0c29ja25hbWUoKQogICAgcHJp
bnQoIlNlcnZpbmcgSFRUUCBvbiIsIHNhWzBdLCAicG9ydCIsIHNhWzFdLCAiLi4uIikKICAg
IHRyeToKICAgICAgICBodHRwZC5zZXJ2ZV9mb3JldmVyKCkKICAgIGV4Y2VwdCBLZXlib2Fy
ZEludGVycnVwdDoKICAgICAgICBwcmludCgiXG5LZXlib2FyZCBpbnRlcnJ1cHQgcmVjZWl2
ZWQsIGV4aXRpbmcuIikKICAgICAgICBodHRwZC5zZXJ2ZXJfY2xvc2UoKQogICAgICAgIHN5
cy5leGl0KDApCgppZiBfX25hbWVfXyA9PSAnX19tYWluX18nOgogICAgdGVzdChIYW5kbGVy
Q2xhc3M9U2ltcGxlSFRUUFJlcXVlc3RIYW5kbGVyKQo=
--------------030907040804090606000906
Content-Type: text/plain; charset=windows-1252;
 name="test_httpservers.py"
Content-Transfer-Encoding: base64
Content-Disposition: attachment;
 filename="test_httpservers.py"

IiIiVW5pdHRlc3RzIGZvciB0aGUgdmFyaW91cyBIVFRQU2VydmVyIG1vZHVsZXMuCgpXcml0
dGVuIGJ5IENvZHkgQS5XLiBTb21lcnZpbGxlIDxjb2R5LXNvbWVydmlsbGVAdWJ1bnR1LmNv
bT4sCkpvc2lwIER6b2xvbmdhLCBhbmQgTWljaGFlbCBPdHRlbmVkZXIgZm9yIHRoZSAyMDA3
LzA4IEdIT1AgY29udGVzdC4KIiIiCgpmcm9tIHNlcnZlciBpbXBvcnQgQmFzZUhUVFBSZXF1
ZXN0SGFuZGxlciwgSFRUUFNlcnZlciwgXAogICAgIFNpbXBsZUhUVFBSZXF1ZXN0SGFuZGxl
ciwgQ0dJSFRUUFJlcXVlc3RIYW5kbGVyCmltcG9ydCBzZXJ2ZXIKCmltcG9ydCBvcwppbXBv
cnQgc3lzCmltcG9ydCByZQppbXBvcnQgYmFzZTY0CmltcG9ydCBzaHV0aWwKaW1wb3J0IHVy
bGxpYi5wYXJzZQppbXBvcnQgaHR0cC5jbGllbnQKaW1wb3J0IHRlbXBmaWxlCmZyb20gaW8g
aW1wb3J0IEJ5dGVzSU8KCnByaW50KCBzeXMucGF0aCApCnN5cy5wYXRoID0gWydDOlxcUHl0
aG9uMzJcXGxpYiddICsgc3lzLnBhdGgKcHJpbnQoIHN5cy5wYXRoICkKCmltcG9ydCB1bml0
dGVzdApmcm9tIHRlc3QgaW1wb3J0IHN1cHBvcnQKdGhyZWFkaW5nID0gc3VwcG9ydC5pbXBv
cnRfbW9kdWxlKCd0aHJlYWRpbmcnKQoKY2xhc3MgTm9Mb2dSZXF1ZXN0SGFuZGxlcjoKICAg
IGRlZiBsb2dfbWVzc2FnZShzZWxmLCAqYXJncyk6CiAgICAgICAgIyBkb24ndCB3cml0ZSBs
b2cgbWVzc2FnZXMgdG8gc3RkZXJyCiAgICAgICAgcGFzcwoKICAgIGRlZiByZWFkKHNlbGYs
IG49Tm9uZSk6CiAgICAgICAgcmV0dXJuICcnCgoKY2xhc3MgVGVzdFNlcnZlclRocmVhZCh0
aHJlYWRpbmcuVGhyZWFkKToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCB0ZXN0X29iamVjdCwg
cmVxdWVzdF9oYW5kbGVyKToKICAgICAgICB0aHJlYWRpbmcuVGhyZWFkLl9faW5pdF9fKHNl
bGYpCiAgICAgICAgc2VsZi5yZXF1ZXN0X2hhbmRsZXIgPSByZXF1ZXN0X2hhbmRsZXIKICAg
ICAgICBzZWxmLnRlc3Rfb2JqZWN0ID0gdGVzdF9vYmplY3QKCiAgICBkZWYgcnVuKHNlbGYp
OgogICAgICAgIHNlbGYuc2VydmVyID0gSFRUUFNlcnZlcigoJ2xvY2FsaG9zdCcsIDApLCBz
ZWxmLnJlcXVlc3RfaGFuZGxlcikKICAgICAgICBzZWxmLnRlc3Rfb2JqZWN0LkhPU1QsIHNl
bGYudGVzdF9vYmplY3QuUE9SVCA9IHNlbGYuc2VydmVyLnNvY2tldC5nZXRzb2NrbmFtZSgp
CiAgICAgICAgc2VsZi50ZXN0X29iamVjdC5zZXJ2ZXJfc3RhcnRlZC5zZXQoKQogICAgICAg
IHNlbGYudGVzdF9vYmplY3QgPSBOb25lCiAgICAgICAgdHJ5OgogICAgICAgICAgICBzZWxm
LnNlcnZlci5zZXJ2ZV9mb3JldmVyKDAuMDUpCiAgICAgICAgZmluYWxseToKICAgICAgICAg
ICAgc2VsZi5zZXJ2ZXIuc2VydmVyX2Nsb3NlKCkKCiAgICBkZWYgc3RvcChzZWxmKToKICAg
ICAgICBzZWxmLnNlcnZlci5zaHV0ZG93bigpCgoKY2xhc3MgQmFzZVRlc3RDYXNlKHVuaXR0
ZXN0LlRlc3RDYXNlKToKICAgIGRlZiBzZXRVcChzZWxmKToKICAgICAgICBzZWxmLl90aHJl
YWRzID0gc3VwcG9ydC50aHJlYWRpbmdfc2V0dXAoKQogICAgICAgIG9zLmVudmlyb24gPSBz
dXBwb3J0LkVudmlyb25tZW50VmFyR3VhcmQoKQogICAgICAgIHNlbGYuc2VydmVyX3N0YXJ0
ZWQgPSB0aHJlYWRpbmcuRXZlbnQoKQogICAgICAgIHNlbGYudGhyZWFkID0gVGVzdFNlcnZl
clRocmVhZChzZWxmLCBzZWxmLnJlcXVlc3RfaGFuZGxlcikKICAgICAgICBzZWxmLnRocmVh
ZC5zdGFydCgpCiAgICAgICAgc2VsZi5zZXJ2ZXJfc3RhcnRlZC53YWl0KCkKCiAgICBkZWYg
dGVhckRvd24oc2VsZik6CiAgICAgICAgc2VsZi50aHJlYWQuc3RvcCgpCiAgICAgICAgb3Mu
ZW52aXJvbi5fX2V4aXRfXygpCiAgICAgICAgc3VwcG9ydC50aHJlYWRpbmdfY2xlYW51cCgq
c2VsZi5fdGhyZWFkcykKCiAgICBkZWYgcmVxdWVzdChzZWxmLCB1cmksIG1ldGhvZD0nR0VU
JywgYm9keT1Ob25lLCBoZWFkZXJzPXt9KToKICAgICAgICBzZWxmLmNvbm5lY3Rpb24gPSBo
dHRwLmNsaWVudC5IVFRQQ29ubmVjdGlvbihzZWxmLkhPU1QsIHNlbGYuUE9SVCkKICAgICAg
ICBzZWxmLmNvbm5lY3Rpb24ucmVxdWVzdChtZXRob2QsIHVyaSwgYm9keSwgaGVhZGVycykK
ICAgICAgICByZXR1cm4gc2VsZi5jb25uZWN0aW9uLmdldHJlc3BvbnNlKCkKCgpjbGFzcyBC
YXNlSFRUUFNlcnZlclRlc3RDYXNlKEJhc2VUZXN0Q2FzZSk6CiAgICBjbGFzcyByZXF1ZXN0
X2hhbmRsZXIoTm9Mb2dSZXF1ZXN0SGFuZGxlciwgQmFzZUhUVFBSZXF1ZXN0SGFuZGxlcik6
CiAgICAgICAgcHJvdG9jb2xfdmVyc2lvbiA9ICdIVFRQLzEuMScKICAgICAgICBkZWZhdWx0
X3JlcXVlc3RfdmVyc2lvbiA9ICdIVFRQLzEuMScKCiAgICAgICAgZGVmIGRvX1RFU1Qoc2Vs
Zik6CiAgICAgICAgICAgIHNlbGYuc2VuZF9yZXNwb25zZSgyMDQpCiAgICAgICAgICAgIHNl
bGYuc2VuZF9oZWFkZXIoJ0NvbnRlbnQtVHlwZScsICd0ZXh0L2h0bWwnKQogICAgICAgICAg
ICBzZWxmLnNlbmRfaGVhZGVyKCdDb25uZWN0aW9uJywgJ2Nsb3NlJykKICAgICAgICAgICAg
c2VsZi5lbmRfaGVhZGVycygpCgogICAgICAgIGRlZiBkb19LRUVQKHNlbGYpOgogICAgICAg
ICAgICBzZWxmLnNlbmRfcmVzcG9uc2UoMjA0KQogICAgICAgICAgICBzZWxmLnNlbmRfaGVh
ZGVyKCdDb250ZW50LVR5cGUnLCAndGV4dC9odG1sJykKICAgICAgICAgICAgc2VsZi5zZW5k
X2hlYWRlcignQ29ubmVjdGlvbicsICdrZWVwLWFsaXZlJykKICAgICAgICAgICAgc2VsZi5l
bmRfaGVhZGVycygpCgogICAgICAgIGRlZiBkb19LRVlFUlJPUihzZWxmKToKICAgICAgICAg
ICAgc2VsZi5zZW5kX2Vycm9yKDk5OSkKCiAgICAgICAgZGVmIGRvX0NVU1RPTShzZWxmKToK
ICAgICAgICAgICAgc2VsZi5zZW5kX3Jlc3BvbnNlKDk5OSkKICAgICAgICAgICAgc2VsZi5z
ZW5kX2hlYWRlcignQ29udGVudC1UeXBlJywgJ3RleHQvaHRtbCcpCiAgICAgICAgICAgIHNl
bGYuc2VuZF9oZWFkZXIoJ0Nvbm5lY3Rpb24nLCAnY2xvc2UnKQogICAgICAgICAgICBzZWxm
LmVuZF9oZWFkZXJzKCkKCiAgICAgICAgZGVmIGRvX0xBVElOT05FSEVBREVSKHNlbGYpOgog
ICAgICAgICAgICBzZWxmLnNlbmRfcmVzcG9uc2UoOTk5KQogICAgICAgICAgICBzZWxmLnNl
bmRfaGVhZGVyKCdYLVNwZWNpYWwnLCAnRMOkbmdlcm91cyBNaW5kJykKICAgICAgICAgICAg
c2VsZi5zZW5kX2hlYWRlcignQ29ubmVjdGlvbicsICdjbG9zZScpCiAgICAgICAgICAgIHNl
bGYuZW5kX2hlYWRlcnMoKQogICAgICAgICAgICBib2R5ID0gc2VsZi5oZWFkZXJzWyd4LXNw
ZWNpYWwtaW5jb21pbmcnXS5lbmNvZGUoJ3V0Zi04JykKICAgICAgICAgICAgc2VsZi53Zmls
ZS53cml0ZShib2R5KQoKICAgIGRlZiBzZXRVcChzZWxmKToKICAgICAgICBCYXNlVGVzdENh
c2Uuc2V0VXAoc2VsZikKICAgICAgICBzZWxmLmNvbiA9IGh0dHAuY2xpZW50LkhUVFBDb25u
ZWN0aW9uKHNlbGYuSE9TVCwgc2VsZi5QT1JUKQogICAgICAgIHNlbGYuY29uLmNvbm5lY3Qo
KQoKICAgIGRlZiB0ZXN0X2NvbW1hbmQoc2VsZik6CiAgICAgICAgc2VsZi5jb24ucmVxdWVz
dCgnR0VUJywgJy8nKQogICAgICAgIHJlcyA9IHNlbGYuY29uLmdldHJlc3BvbnNlKCkKICAg
ICAgICBzZWxmLmFzc2VydEVxdWFsKHJlcy5zdGF0dXMsIDUwMSkKCiAgICBkZWYgdGVzdF9y
ZXF1ZXN0X2xpbmVfdHJpbW1pbmcoc2VsZik6CiAgICAgICAgc2VsZi5jb24uX2h0dHBfdnNu
X3N0ciA9ICdIVFRQLzEuMVxuJwogICAgICAgIHNlbGYuY29uLnB1dHJlcXVlc3QoJ0dFVCcs
ICcvJykKICAgICAgICBzZWxmLmNvbi5lbmRoZWFkZXJzKCkKICAgICAgICByZXMgPSBzZWxm
LmNvbi5nZXRyZXNwb25zZSgpCiAgICAgICAgc2VsZi5hc3NlcnRFcXVhbChyZXMuc3RhdHVz
LCA1MDEpCgogICAgZGVmIHRlc3RfdmVyc2lvbl9ib2d1cyhzZWxmKToKICAgICAgICBzZWxm
LmNvbi5faHR0cF92c25fc3RyID0gJ0ZVQkFSJwogICAgICAgIHNlbGYuY29uLnB1dHJlcXVl
c3QoJ0dFVCcsICcvJykKICAgICAgICBzZWxmLmNvbi5lbmRoZWFkZXJzKCkKICAgICAgICBy
ZXMgPSBzZWxmLmNvbi5nZXRyZXNwb25zZSgpCiAgICAgICAgc2VsZi5hc3NlcnRFcXVhbChy
ZXMuc3RhdHVzLCA0MDApCgogICAgZGVmIHRlc3RfdmVyc2lvbl9kaWdpdHMoc2VsZik6CiAg
ICAgICAgc2VsZi5jb24uX2h0dHBfdnNuX3N0ciA9ICdIVFRQLzkuOS45JwogICAgICAgIHNl
bGYuY29uLnB1dHJlcXVlc3QoJ0dFVCcsICcvJykKICAgICAgICBzZWxmLmNvbi5lbmRoZWFk
ZXJzKCkKICAgICAgICByZXMgPSBzZWxmLmNvbi5nZXRyZXNwb25zZSgpCiAgICAgICAgc2Vs
Zi5hc3NlcnRFcXVhbChyZXMuc3RhdHVzLCA0MDApCgogICAgZGVmIHRlc3RfdmVyc2lvbl9u
b25lX2dldChzZWxmKToKICAgICAgICBzZWxmLmNvbi5faHR0cF92c25fc3RyID0gJycKICAg
ICAgICBzZWxmLmNvbi5wdXRyZXF1ZXN0KCdHRVQnLCAnLycpCiAgICAgICAgc2VsZi5jb24u
ZW5kaGVhZGVycygpCiAgICAgICAgcmVzID0gc2VsZi5jb24uZ2V0cmVzcG9uc2UoKQogICAg
ICAgIHNlbGYuYXNzZXJ0RXF1YWwocmVzLnN0YXR1cywgNTAxKQoKICAgIGRlZiB0ZXN0X3Zl
cnNpb25fbm9uZShzZWxmKToKICAgICAgICBzZWxmLmNvbi5faHR0cF92c25fc3RyID0gJycK
ICAgICAgICBzZWxmLmNvbi5wdXRyZXF1ZXN0KCdQVVQnLCAnLycpCiAgICAgICAgc2VsZi5j
b24uZW5kaGVhZGVycygpCiAgICAgICAgcmVzID0gc2VsZi5jb24uZ2V0cmVzcG9uc2UoKQog
ICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwocmVzLnN0YXR1cywgNDAwKQoKICAgIGRlZiB0ZXN0
X3ZlcnNpb25faW52YWxpZChzZWxmKToKICAgICAgICBzZWxmLmNvbi5faHR0cF92c24gPSA5
OQogICAgICAgIHNlbGYuY29uLl9odHRwX3Zzbl9zdHIgPSAnSFRUUC85LjknCiAgICAgICAg
c2VsZi5jb24ucHV0cmVxdWVzdCgnR0VUJywgJy8nKQogICAgICAgIHNlbGYuY29uLmVuZGhl
YWRlcnMoKQogICAgICAgIHJlcyA9IHNlbGYuY29uLmdldHJlc3BvbnNlKCkKICAgICAgICBz
ZWxmLmFzc2VydEVxdWFsKHJlcy5zdGF0dXMsIDUwNSkKCiAgICBkZWYgdGVzdF9zZW5kX2Js
YW5rKHNlbGYpOgogICAgICAgIHNlbGYuY29uLl9odHRwX3Zzbl9zdHIgPSAnJwogICAgICAg
IHNlbGYuY29uLnB1dHJlcXVlc3QoJycsICcnKQogICAgICAgIHNlbGYuY29uLmVuZGhlYWRl
cnMoKQogICAgICAgIHJlcyA9IHNlbGYuY29uLmdldHJlc3BvbnNlKCkKICAgICAgICBzZWxm
LmFzc2VydEVxdWFsKHJlcy5zdGF0dXMsIDQwMCkKCiAgICBkZWYgdGVzdF9oZWFkZXJfY2xv
c2Uoc2VsZik6CiAgICAgICAgc2VsZi5jb24ucHV0cmVxdWVzdCgnR0VUJywgJy8nKQogICAg
ICAgIHNlbGYuY29uLnB1dGhlYWRlcignQ29ubmVjdGlvbicsICdjbG9zZScpCiAgICAgICAg
c2VsZi5jb24uZW5kaGVhZGVycygpCiAgICAgICAgcmVzID0gc2VsZi5jb24uZ2V0cmVzcG9u
c2UoKQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwocmVzLnN0YXR1cywgNTAxKQoKICAgIGRl
ZiB0ZXN0X2hlYWRfa2VlcF9hbGl2ZShzZWxmKToKICAgICAgICBzZWxmLmNvbi5faHR0cF92
c25fc3RyID0gJ0hUVFAvMS4xJwogICAgICAgIHNlbGYuY29uLnB1dHJlcXVlc3QoJ0dFVCcs
ICcvJykKICAgICAgICBzZWxmLmNvbi5wdXRoZWFkZXIoJ0Nvbm5lY3Rpb24nLCAna2VlcC1h
bGl2ZScpCiAgICAgICAgc2VsZi5jb24uZW5kaGVhZGVycygpCiAgICAgICAgcmVzID0gc2Vs
Zi5jb24uZ2V0cmVzcG9uc2UoKQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwocmVzLnN0YXR1
cywgNTAxKQoKICAgIGRlZiB0ZXN0X2hhbmRsZXIoc2VsZik6CiAgICAgICAgc2VsZi5jb24u
cmVxdWVzdCgnVEVTVCcsICcvJykKICAgICAgICByZXMgPSBzZWxmLmNvbi5nZXRyZXNwb25z
ZSgpCiAgICAgICAgc2VsZi5hc3NlcnRFcXVhbChyZXMuc3RhdHVzLCAyMDQpCgogICAgZGVm
IHRlc3RfcmV0dXJuX2hlYWRlcl9rZWVwX2FsaXZlKHNlbGYpOgogICAgICAgIHNlbGYuY29u
LnJlcXVlc3QoJ0tFRVAnLCAnLycpCiAgICAgICAgcmVzID0gc2VsZi5jb24uZ2V0cmVzcG9u
c2UoKQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwocmVzLmdldGhlYWRlcignQ29ubmVjdGlv
bicpLCAna2VlcC1hbGl2ZScpCiAgICAgICAgc2VsZi5jb24ucmVxdWVzdCgnVEVTVCcsICcv
JykKICAgICAgICBzZWxmLmFkZENsZWFudXAoc2VsZi5jb24uY2xvc2UpCgogICAgZGVmIHRl
c3RfaW50ZXJuYWxfa2V5X2Vycm9yKHNlbGYpOgogICAgICAgIHNlbGYuY29uLnJlcXVlc3Qo
J0tFWUVSUk9SJywgJy8nKQogICAgICAgIHJlcyA9IHNlbGYuY29uLmdldHJlc3BvbnNlKCkK
ICAgICAgICBzZWxmLmFzc2VydEVxdWFsKHJlcy5zdGF0dXMsIDk5OSkKCiAgICBkZWYgdGVz
dF9yZXR1cm5fY3VzdG9tX3N0YXR1cyhzZWxmKToKICAgICAgICBzZWxmLmNvbi5yZXF1ZXN0
KCdDVVNUT00nLCAnLycpCiAgICAgICAgcmVzID0gc2VsZi5jb24uZ2V0cmVzcG9uc2UoKQog
ICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwocmVzLnN0YXR1cywgOTk5KQoKICAgIGRlZiB0ZXN0
X2xhdGluMV9oZWFkZXIoc2VsZik6CiAgICAgICAgc2VsZi5jb24ucmVxdWVzdCgnTEFUSU5P
TkVIRUFERVInLCAnLycsIGhlYWRlcnM9ewogICAgICAgICAgICAnWC1TcGVjaWFsLUluY29t
aW5nJzogICAgICAgJ8OEcmdlciBtaXQgVW5pY29kZScKICAgICAgICB9KQogICAgICAgIHJl
cyA9IHNlbGYuY29uLmdldHJlc3BvbnNlKCkKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKHJl
cy5nZXRoZWFkZXIoJ1gtU3BlY2lhbCcpLCAnRMOkbmdlcm91cyBNaW5kJykKICAgICAgICBz
ZWxmLmFzc2VydEVxdWFsKHJlcy5yZWFkKCksICfDhHJnZXIgbWl0IFVuaWNvZGUnLmVuY29k
ZSgndXRmLTgnKSkKCgpjbGFzcyBTaW1wbGVIVFRQU2VydmVyVGVzdENhc2UoQmFzZVRlc3RD
YXNlKToKICAgIGNsYXNzIHJlcXVlc3RfaGFuZGxlcihOb0xvZ1JlcXVlc3RIYW5kbGVyLCBT
aW1wbGVIVFRQUmVxdWVzdEhhbmRsZXIpOgogICAgICAgIHBhc3MKCiAgICBkZWYgc2V0VXAo
c2VsZik6CiAgICAgICAgQmFzZVRlc3RDYXNlLnNldFVwKHNlbGYpCiAgICAgICAgc2VsZi5j
d2QgPSBvcy5nZXRjd2QoKQogICAgICAgIGJhc2V0ZW1wZGlyID0gdGVtcGZpbGUuZ2V0dGVt
cGRpcigpCiAgICAgICAgb3MuY2hkaXIoYmFzZXRlbXBkaXIpCiAgICAgICAgc2VsZi5kYXRh
ID0gYidXZSBhcmUgdGhlIGtuaWdodHMgd2hvIHNheSBOaSEnCiAgICAgICAgc2VsZi50ZW1w
ZGlyID0gdGVtcGZpbGUubWtkdGVtcChkaXI9YmFzZXRlbXBkaXIpCiAgICAgICAgc2VsZi50
ZW1wZGlyX25hbWUgPSBvcy5wYXRoLmJhc2VuYW1lKHNlbGYudGVtcGRpcikKICAgICAgICB3
aXRoIG9wZW4ob3MucGF0aC5qb2luKHNlbGYudGVtcGRpciwgJ3Rlc3QnKSwgJ3diJykgYXMg
dGVtcDoKICAgICAgICAgICAgdGVtcC53cml0ZShzZWxmLmRhdGEpCgogICAgZGVmIHRlYXJE
b3duKHNlbGYpOgogICAgICAgIHRyeToKICAgICAgICAgICAgb3MuY2hkaXIoc2VsZi5jd2Qp
CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHNodXRpbC5ybXRyZWUoc2VsZi50
ZW1wZGlyKQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBwYXNzCiAgICAg
ICAgZmluYWxseToKICAgICAgICAgICAgQmFzZVRlc3RDYXNlLnRlYXJEb3duKHNlbGYpCgog
ICAgZGVmIGNoZWNrX3N0YXR1c19hbmRfcmVhc29uKHNlbGYsIHJlc3BvbnNlLCBzdGF0dXMs
IGRhdGE9Tm9uZSk6CiAgICAgICAgYm9keSA9IHJlc3BvbnNlLnJlYWQoKQogICAgICAgIHNl
bGYuYXNzZXJ0VHJ1ZShyZXNwb25zZSkKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKHJlc3Bv
bnNlLnN0YXR1cywgc3RhdHVzKQogICAgICAgIHNlbGYuYXNzZXJ0SXNOb3ROb25lKHJlc3Bv
bnNlLnJlYXNvbikKICAgICAgICBpZiBkYXRhOgogICAgICAgICAgICBzZWxmLmFzc2VydEVx
dWFsKGRhdGEsIGJvZHkpCgogICAgZGVmIHRlc3RfZ2V0KHNlbGYpOgogICAgICAgICNjb25z
dHJ1Y3RzIHRoZSBwYXRoIHJlbGF0aXZlIHRvIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGUg
SFRUUFNlcnZlcgogICAgICAgIHJlc3BvbnNlID0gc2VsZi5yZXF1ZXN0KHNlbGYudGVtcGRp
cl9uYW1lICsgJy90ZXN0JykKICAgICAgICBzZWxmLmNoZWNrX3N0YXR1c19hbmRfcmVhc29u
KHJlc3BvbnNlLCAyMDAsIGRhdGE9c2VsZi5kYXRhKQogICAgICAgIHJlc3BvbnNlID0gc2Vs
Zi5yZXF1ZXN0KHNlbGYudGVtcGRpcl9uYW1lICsgJy8nKQogICAgICAgIHNlbGYuY2hlY2tf
c3RhdHVzX2FuZF9yZWFzb24ocmVzcG9uc2UsIDIwMCkKICAgICAgICByZXNwb25zZSA9IHNl
bGYucmVxdWVzdChzZWxmLnRlbXBkaXJfbmFtZSkKICAgICAgICBzZWxmLmNoZWNrX3N0YXR1
c19hbmRfcmVhc29uKHJlc3BvbnNlLCAzMDEpCiAgICAgICAgcmVzcG9uc2UgPSBzZWxmLnJl
cXVlc3QoJy9UaGlzRG9lc05vdEV4aXN0JykKICAgICAgICBzZWxmLmNoZWNrX3N0YXR1c19h
bmRfcmVhc29uKHJlc3BvbnNlLCA0MDQpCiAgICAgICAgcmVzcG9uc2UgPSBzZWxmLnJlcXVl
c3QoJy8nICsgJ1RoaXNEb2VzTm90RXhpc3QnICsgJy8nKQogICAgICAgIHNlbGYuY2hlY2tf
c3RhdHVzX2FuZF9yZWFzb24ocmVzcG9uc2UsIDQwNCkKICAgICAgICB3aXRoIG9wZW4ob3Mu
cGF0aC5qb2luKHNlbGYudGVtcGRpcl9uYW1lLCAnaW5kZXguaHRtbCcpLCAndycpIGFzIGY6
CiAgICAgICAgICAgIHJlc3BvbnNlID0gc2VsZi5yZXF1ZXN0KCcvJyArIHNlbGYudGVtcGRp
cl9uYW1lICsgJy8nKQogICAgICAgICAgICBzZWxmLmNoZWNrX3N0YXR1c19hbmRfcmVhc29u
KHJlc3BvbnNlLCAyMDApCiAgICAgICAgICAgIGlmIG9zLm5hbWUgPT0gJ3Bvc2l4JzoKICAg
ICAgICAgICAgICAgICMgY2htb2Qgd29uJ3Qgd29yayBhcyBleHBlY3RlZCBvbiBXaW5kb3dz
IHBsYXRmb3JtcwogICAgICAgICAgICAgICAgb3MuY2htb2Qoc2VsZi50ZW1wZGlyLCAwKQog
ICAgICAgICAgICAgICAgcmVzcG9uc2UgPSBzZWxmLnJlcXVlc3Qoc2VsZi50ZW1wZGlyX25h
bWUgKyAnLycpCiAgICAgICAgICAgICAgICBzZWxmLmNoZWNrX3N0YXR1c19hbmRfcmVhc29u
KHJlc3BvbnNlLCA0MDQpCiAgICAgICAgICAgICAgICBvcy5jaG1vZChzZWxmLnRlbXBkaXIs
IDBvNzU1KQoKICAgIGRlZiB0ZXN0X2hlYWQoc2VsZik6CiAgICAgICAgcmVzcG9uc2UgPSBz
ZWxmLnJlcXVlc3QoCiAgICAgICAgICAgIHNlbGYudGVtcGRpcl9uYW1lICsgJy90ZXN0Jywg
bWV0aG9kPSdIRUFEJykKICAgICAgICBzZWxmLmNoZWNrX3N0YXR1c19hbmRfcmVhc29uKHJl
c3BvbnNlLCAyMDApCiAgICAgICAgc2VsZi5hc3NlcnRFcXVhbChyZXNwb25zZS5nZXRoZWFk
ZXIoJ2NvbnRlbnQtbGVuZ3RoJyksCiAgICAgICAgICAgICAgICAgICAgICAgICBzdHIobGVu
KHNlbGYuZGF0YSkpKQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwocmVzcG9uc2UuZ2V0aGVh
ZGVyKCdjb250ZW50LXR5cGUnKSwKICAgICAgICAgICAgICAgICAgICAgICAgICdhcHBsaWNh
dGlvbi9vY3RldC1zdHJlYW0nKQoKICAgIGRlZiB0ZXN0X2ludmFsaWRfcmVxdWVzdHMoc2Vs
Zik6CiAgICAgICAgcmVzcG9uc2UgPSBzZWxmLnJlcXVlc3QoJy8nLCBtZXRob2Q9J0ZPTycp
CiAgICAgICAgc2VsZi5jaGVja19zdGF0dXNfYW5kX3JlYXNvbihyZXNwb25zZSwgNTAxKQog
ICAgICAgICMgcmVxdWVzdHMgbXVzdCBiZSBjYXNlIHNlbnNpdGl2ZSxzbyB0aGlzIHNob3Vs
ZCBmYWlsIHRvbwogICAgICAgIHJlc3BvbnNlID0gc2VsZi5yZXF1ZXN0KCcvJywgbWV0aG9k
PSdnZXQnKQogICAgICAgIHNlbGYuY2hlY2tfc3RhdHVzX2FuZF9yZWFzb24ocmVzcG9uc2Us
IDUwMSkKICAgICAgICByZXNwb25zZSA9IHNlbGYucmVxdWVzdCgnLycsIG1ldGhvZD0nR0VU
cycpCiAgICAgICAgc2VsZi5jaGVja19zdGF0dXNfYW5kX3JlYXNvbihyZXNwb25zZSwgNTAx
KQoKCmNnaV9maWxlMSA9ICIiIlwKIyElcwoKcHJpbnQoIkNvbnRlbnQtdHlwZTogdGV4dC9o
dG1sIikKcHJpbnQoKQpwcmludCgiSGVsbG8gV29ybGQiKQoiIiIKCmNnaV9maWxlMiA9ICIi
IlwKIyElcwppbXBvcnQgY2dpCgpwcmludCgiQ29udGVudC10eXBlOiB0ZXh0L2h0bWwiKQpw
cmludCgpCgpmb3JtID0gY2dpLkZpZWxkU3RvcmFnZSgpCnByaW50KCIlJXMsICUlcywgJSVz
IiAlJSAoZm9ybS5nZXRmaXJzdCgic3BhbSIpLCBmb3JtLmdldGZpcnN0KCJlZ2dzIiksCiAg
ICAgICAgICAgICAgICAgICAgICAgICAgZm9ybS5nZXRmaXJzdCgiYmFjb24iKSkpCiIiIgoK
Y2xhc3MgQ0dJSFRUUFNlcnZlclRlc3RDYXNlKEJhc2VUZXN0Q2FzZSk6CiAgICBjbGFzcyBy
ZXF1ZXN0X2hhbmRsZXIoTm9Mb2dSZXF1ZXN0SGFuZGxlciwgQ0dJSFRUUFJlcXVlc3RIYW5k
bGVyKToKICAgICAgICBwYXNzCgogICAgZGVmIHNldFVwKHNlbGYpOgogICAgICAgIEJhc2VU
ZXN0Q2FzZS5zZXRVcChzZWxmKQogICAgICAgIHNlbGYuY3dkID0gb3MuZ2V0Y3dkKCkKICAg
ICAgICBzZWxmLnBhcmVudF9kaXIgPSB0ZW1wZmlsZS5ta2R0ZW1wKCkKICAgICAgICBzZWxm
LmNnaV9kaXIgPSBvcy5wYXRoLmpvaW4oc2VsZi5wYXJlbnRfZGlyLCAnY2dpLWJpbicpCiAg
ICAgICAgb3MubWtkaXIoc2VsZi5jZ2lfZGlyKQogICAgICAgIHNlbGYuZmlsZTFfcGF0aCA9
IE5vbmUKICAgICAgICBzZWxmLmZpbGUyX3BhdGggPSBOb25lCgogICAgICAgICMgVGhlIHNo
ZWJhbmcgbGluZSBzaG91bGQgYmUgcHVyZSBBU0NJSTogdXNlIHN5bWxpbmsgaWYgcG9zc2li
bGUuCiAgICAgICAgIyBTZWUgaXNzdWUgIzc2NjguCiAgICAgICAgaWYgc3VwcG9ydC5jYW5f
c3ltbGluaygpOgogICAgICAgICAgICBzZWxmLnB5dGhvbmV4ZSA9IG9zLnBhdGguam9pbihz
ZWxmLnBhcmVudF9kaXIsICdweXRob24nKQogICAgICAgICAgICBvcy5zeW1saW5rKHN5cy5l
eGVjdXRhYmxlLCBzZWxmLnB5dGhvbmV4ZSkKICAgICAgICBlbHNlOgogICAgICAgICAgICBz
ZWxmLnB5dGhvbmV4ZSA9IHN5cy5leGVjdXRhYmxlCgogICAgICAgIHRyeToKICAgICAgICAg
ICAgIyBUaGUgcHl0aG9uIGV4ZWN1dGFibGUgcGF0aCBpcyB3cml0dGVuIGFzIHRoZSBmaXJz
dCBsaW5lIG9mIHRoZQogICAgICAgICAgICAjIENHSSBQeXRob24gc2NyaXB0LiBUaGUgZW5j
b2RpbmcgY29va2llIGNhbm5vdCBiZSB1c2VkLCBhbmQgc28gdGhlCiAgICAgICAgICAgICMg
cGF0aCBzaG91bGQgYmUgZW5jb2RhYmxlIHRvIHRoZSBkZWZhdWx0IHNjcmlwdCBlbmNvZGlu
ZyAodXRmLTgpCiAgICAgICAgICAgIHNlbGYucHl0aG9uZXhlLmVuY29kZSgndXRmLTgnKQog
ICAgICAgIGV4Y2VwdCBVbmljb2RlRW5jb2RlRXJyb3I6CiAgICAgICAgICAgIHNlbGYudGVh
ckRvd24oKQogICAgICAgICAgICByYWlzZSBzZWxmLnNraXBUZXN0KAogICAgICAgICAgICAg
ICAgIlB5dGhvbiBleGVjdXRhYmxlIHBhdGggaXMgbm90IGVuY29kYWJsZSB0byB1dGYtOCIp
CgogICAgICAgIHNlbGYuZmlsZTFfcGF0aCA9IG9zLnBhdGguam9pbihzZWxmLmNnaV9kaXIs
ICdmaWxlMS5weScpCiAgICAgICAgd2l0aCBvcGVuKHNlbGYuZmlsZTFfcGF0aCwgJ3cnLCBl
bmNvZGluZz0ndXRmLTgnKSBhcyBmaWxlMToKICAgICAgICAgICAgZmlsZTEud3JpdGUoY2dp
X2ZpbGUxICUgc2VsZi5weXRob25leGUpCiAgICAgICAgb3MuY2htb2Qoc2VsZi5maWxlMV9w
YXRoLCAwbzc3NykKCiAgICAgICAgc2VsZi5maWxlMl9wYXRoID0gb3MucGF0aC5qb2luKHNl
bGYuY2dpX2RpciwgJ2ZpbGUyLnB5JykKICAgICAgICB3aXRoIG9wZW4oc2VsZi5maWxlMl9w
YXRoLCAndycsIGVuY29kaW5nPSd1dGYtOCcpIGFzIGZpbGUyOgogICAgICAgICAgICBmaWxl
Mi53cml0ZShjZ2lfZmlsZTIgJSBzZWxmLnB5dGhvbmV4ZSkKICAgICAgICBvcy5jaG1vZChz
ZWxmLmZpbGUyX3BhdGgsIDBvNzc3KQoKICAgICAgICBvcy5jaGRpcihzZWxmLnBhcmVudF9k
aXIpCgogICAgZGVmIHRlYXJEb3duKHNlbGYpOgogICAgICAgIHRyeToKICAgICAgICAgICAg
b3MuY2hkaXIoc2VsZi5jd2QpCiAgICAgICAgICAgIGlmIHNlbGYucHl0aG9uZXhlICE9IHN5
cy5leGVjdXRhYmxlOgogICAgICAgICAgICAgICAgb3MucmVtb3ZlKHNlbGYucHl0aG9uZXhl
KQogICAgICAgICAgICBpZiBzZWxmLmZpbGUxX3BhdGg6CiAgICAgICAgICAgICAgICBvcy5y
ZW1vdmUoc2VsZi5maWxlMV9wYXRoKQogICAgICAgICAgICBpZiBzZWxmLmZpbGUyX3BhdGg6
CiAgICAgICAgICAgICAgICBvcy5yZW1vdmUoc2VsZi5maWxlMl9wYXRoKQogICAgICAgICAg
ICBvcy5ybWRpcihzZWxmLmNnaV9kaXIpCiAgICAgICAgICAgIG9zLnJtZGlyKHNlbGYucGFy
ZW50X2RpcikKICAgICAgICBmaW5hbGx5OgogICAgICAgICAgICBCYXNlVGVzdENhc2UudGVh
ckRvd24oc2VsZikKCiAgICBkZWYgdGVzdF9wYXJzZV91cmwoc2VsZik6CiAgICAgICAgdGVz
dF92ZWN0b3JzID0gewogICAgICAgICAgICAnJzogKCcvJywgJycsICcnKSwKICAgICAgICAg
ICAgJy4uJzogSW5kZXhFcnJvciwKICAgICAgICAgICAgJy8uLy8uLic6IEluZGV4RXJyb3Is
CiAgICAgICAgICAgICcvJzogKCcvJywgJycsICcnKSwKICAgICAgICAgICAgJy8vJzogKCcv
JywgJycsICcnKSwKICAgICAgICAgICAgJy9cXCc6IFZhbHVlRXJyb3IsCiAgICAgICAgICAg
ICcvLi8vJzogKCcvJywgJycsICcnKSwKICAgICAgICAgICAgJ2NnaS1iaW4vZmlsZTEucHkn
OiAoJy9jZ2ktYmluL2ZpbGUxLnB5JywgJycsICcnKSwKICAgICAgICAgICAgJy9jZ2ktYmlu
L2ZpbGUxLnB5JzogKCcvY2dpLWJpbi9maWxlMS5weScsICcnLCAnJyksCiAgICAgICAgICAg
ICcvY2dpLWJpbi9maWxlMS5weS8uLi8uLi9hJzogKCcvYScsICcnLCAnJyksCiAgICAgICAg
ICAgICcvY2dpLWJpbi9maWxlMS5weS9hL2IvYy8uLi8uLi9kJzogKCcvY2dpLWJpbi9maWxl
MS5weS9hL2QnLCAnJywgJycpLAogICAgICAgICAgICAnYSc6ICgnL2EnLCAnJywgJycpLAog
ICAgICAgICAgICAnL2EnOiAoJy9hJywgJycsICcnKSwKICAgICAgICAgICAgJy8vYSc6ICgn
L2EnLCAnJywgJycpLAogICAgICAgICAgICAnLi9hJzogKCcvYScsICcnLCAnJyksCiAgICAg
ICAgICAgICcuL0M6Lyc6IFZhbHVlRXJyb3IsCiAgICAgICAgICAgICcvYS9iJzogKCcvYS9i
JywgJycsICcnKSwKICAgICAgICAgICAgJy9hL2IvJzogKCcvYS9iLycsICcnLCAnJyksCiAg
ICAgICAgICAgICcvYS9iXFxjLyc6IFZhbHVlRXJyb3IsCiAgICAgICAgICAgICcvYS9iJTJm
Yy8nOiAoJy9hL2IvYy8nLCAnJywgJycpLAogICAgICAgICAgICAnL2EvYiU1Y2MvJzogVmFs
dWVFcnJvciwKICAgICAgICAgICAgJy9hL2IvP2ZvbyU1YyNiYXInOiAoJy9hL2IvJywgJ2Zv
byU1YycsICdiYXInKSwKICAgICAgICAgICAgJy9hL2IvP2ZvbyUyZiNiYXInOiAoJy9hL2Iv
JywgJ2ZvbyUyZicsICdiYXInKSwKICAgICAgICAgICAgJy9hL2IvP2EvYi8uLi9kJzogKCcv
YS9iLycsICdhL2IvLi4vZCcsICcnKSwKICAgICAgICAgICAgJy9hL2IvLic6ICgnL2EvYi8n
LCAnJywgJycpLAogICAgICAgICAgICAnL2EvYi9jLy4uJzogKCcvYS9iLycsICcnLCAnJyks
CiAgICAgICAgICAgICcvYS9iL2MvLi4vZCc6ICgnL2EvYi9kJywgJycsICcnKSwKICAgICAg
ICAgICAgJy9hL2IvYy8uLi9kL2UvLi4vZic6ICgnL2EvYi9kL2YnLCAnJywgJycpLAogICAg
ICAgICAgICAnL2EvYi9jLy4uL2QvZS8uLi8uLi9mJzogKCcvYS9iL2YnLCAnJywgJycpLAog
ICAgICAgICAgICAnL2EvYi9jLy4uL2QvZS8uLi8uLy4vLi8uLi8vZic6ICgnL2EvYi9mJywg
JycsICcnKSwKICAgICAgICAgICAgJy4uL2EvYi9jLy4uL2QvZS8uLi8uLy4vLi8uLi8vZic6
IEluZGV4RXJyb3IsCiAgICAgICAgICAgICcvYS9iL2MvLi4vZC9lLy4uLy4uLy4uL2YnOiAo
Jy9hL2YnLCAnJywgJycpLAogICAgICAgICAgICAnL2EvYi9jLy4uL2QvZS8uLi8uLi8uLi8u
Li9mJzogKCcvZicsICcnLCAnJyksCiAgICAgICAgICAgICcvYS9iL2MvLi4vZC9lLy4uLy4u
Ly4uLy4uLy4uL2YnOiBJbmRleEVycm9yLAogICAgICAgICAgICAnL2EvYi9jLy4uL2QvZS8u
Li8uLi8uLi8uLi9mLy4uJzogKCcvJywgJycsICcnKSwKICAgICAgICAgICAgJy9hL2IvYy8u
Li9kL2UvLi4vLi4vLi4vLi4vZi8uLi8uJzogKCcvJywgJycsICcnKSwKICAgICAgICB9CiAg
ICAgICAgZm9yIHBhdGgsIGV4cGVjdGVkIGluIHRlc3RfdmVjdG9ycy5pdGVtcygpOgogICAg
ICAgICAgICBwcmludCgndGVzdGluZzogJXMgLS0gJXMnICUgKCBwYXRoLCBleHBlY3RlZCAp
KQogICAgICAgICAgICBpZiBpc2luc3RhbmNlKGV4cGVjdGVkLCB0eXBlKSBhbmQgaXNzdWJj
bGFzcyhleHBlY3RlZCwgRXhjZXB0aW9uKToKICAgICAgICAgICAgICAgIHNlbGYuYXNzZXJ0
UmFpc2VzKGV4cGVjdGVkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Vy
dmVyLnBhcnNlX3VybCwgcGF0aCkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAg
IGFjdHVhbCA9IHNlcnZlci5wYXJzZV91cmwocGF0aCkKICAgICAgICAgICAgICAgIHNlbGYu
YXNzZXJ0RXF1YWwoZXhwZWN0ZWQsIGFjdHVhbCwKICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgbXNnPSdwYXRoID0gJXJcbkdvdDogICAgJXJcbldhbnRlZDogJXInICUKICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHBhdGgsIGFjdHVhbCwgZXhwZWN0ZWQp
KQoKICAgIGRlZiB0ZXN0X2hlYWRlcnNfYW5kX2NvbnRlbnQoc2VsZik6CiAgICAgICAgcmVz
ID0gc2VsZi5yZXF1ZXN0KCcvY2dpLWJpbi9maWxlMS5weScpCiAgICAgICAgc2VsZi5hc3Nl
cnRFcXVhbCgoYidIZWxsbyBXb3JsZFxuJywgJ3RleHQvaHRtbCcsIDIwMCksCiAgICAgICAg
ICAgIChyZXMucmVhZCgpLCByZXMuZ2V0aGVhZGVyKCdDb250ZW50LXR5cGUnKSwgcmVzLnN0
YXR1cykpCgogICAgZGVmIHRlc3RfcG9zdChzZWxmKToKICAgICAgICBwYXJhbXMgPSB1cmxs
aWIucGFyc2UudXJsZW5jb2RlKAogICAgICAgICAgICB7J3NwYW0nIDogMSwgJ2VnZ3MnIDog
J3B5dGhvbicsICdiYWNvbicgOiAxMjM0NTZ9KQogICAgICAgIGhlYWRlcnMgPSB7J0NvbnRl
bnQtdHlwZScgOiAnYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkJ30KICAgICAg
ICByZXMgPSBzZWxmLnJlcXVlc3QoJy9jZ2ktYmluL2ZpbGUyLnB5JywgJ1BPU1QnLCBwYXJh
bXMsIGhlYWRlcnMpCgogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwocmVzLnJlYWQoKSwgYicx
LCBweXRob24sIDEyMzQ1NlxuJykKCiAgICBkZWYgdGVzdF9pbnZhbGlkdXJpKHNlbGYpOgog
ICAgICAgIHJlcyA9IHNlbGYucmVxdWVzdCgnL2NnaS1iaW4vaW52YWxpZCcpCiAgICAgICAg
cmVzLnJlYWQoKQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwocmVzLnN0YXR1cywgNDA0KQoK
ICAgIGRlZiB0ZXN0X2F1dGhvcml6YXRpb24oc2VsZik6CiAgICAgICAgaGVhZGVycyA9IHti
J0F1dGhvcml6YXRpb24nIDogYidCYXNpYyAnICsKICAgICAgICAgICAgICAgICAgIGJhc2U2
NC5iNjRlbmNvZGUoYid1c2VybmFtZTpwYXNzJyl9CiAgICAgICAgcmVzID0gc2VsZi5yZXF1
ZXN0KCcvY2dpLWJpbi9maWxlMS5weScsICdHRVQnLCBoZWFkZXJzPWhlYWRlcnMpCiAgICAg
ICAgc2VsZi5hc3NlcnRFcXVhbCgoYidIZWxsbyBXb3JsZFxuJywgJ3RleHQvaHRtbCcsIDIw
MCksCiAgICAgICAgICAgICAgICAocmVzLnJlYWQoKSwgcmVzLmdldGhlYWRlcignQ29udGVu
dC10eXBlJyksIHJlcy5zdGF0dXMpKQoKICAgIGRlZiB0ZXN0X25vX2xlYWRpbmdfc2xhc2go
c2VsZik6CiAgICAgICAgIyBodHRwOi8vYnVncy5weXRob24ub3JnL2lzc3VlMjI1NAogICAg
ICAgIHJlcyA9IHNlbGYucmVxdWVzdCgnY2dpLWJpbi9maWxlMS5weScpCiAgICAgICAgc2Vs
Zi5hc3NlcnRFcXVhbCgoYidIZWxsbyBXb3JsZFxuJywgJ3RleHQvaHRtbCcsIDIwMCksCiAg
ICAgICAgICAgICAocmVzLnJlYWQoKSwgcmVzLmdldGhlYWRlcignQ29udGVudC10eXBlJyks
IHJlcy5zdGF0dXMpKQoKICAgIGRlZiB0ZXN0X29zX2Vudmlyb25faXNfbm90X2FsdGVyZWQo
c2VsZik6CiAgICAgICAgc2lnbmF0dXJlID0gIlRlc3QgQ0dJIFNlcnZlciIKICAgICAgICBv
cy5lbnZpcm9uWydTRVJWRVJfU09GVFdBUkUnXSA9IHNpZ25hdHVyZQogICAgICAgIHJlcyA9
IHNlbGYucmVxdWVzdCgnL2NnaS1iaW4vZmlsZTEucHknKQogICAgICAgIHNlbGYuYXNzZXJ0
RXF1YWwoKGInSGVsbG8gV29ybGRcbicsICd0ZXh0L2h0bWwnLCAyMDApLAogICAgICAgICAg
ICAgICAgKHJlcy5yZWFkKCksIHJlcy5nZXRoZWFkZXIoJ0NvbnRlbnQtdHlwZScpLCByZXMu
c3RhdHVzKSkKICAgICAgICBzZWxmLmFzc2VydEVxdWFsKG9zLmVudmlyb25bJ1NFUlZFUl9T
T0ZUV0FSRSddLCBzaWduYXR1cmUpCgoKY2xhc3MgU29ja2V0bGVzc1JlcXVlc3RIYW5kbGVy
KFNpbXBsZUhUVFBSZXF1ZXN0SGFuZGxlcik6CiAgICBkZWYgX19pbml0X18oc2VsZik6CiAg
ICAgICAgc2VsZi5nZXRfY2FsbGVkID0gRmFsc2UKICAgICAgICBzZWxmLnByb3RvY29sX3Zl
cnNpb24gPSAiSFRUUC8xLjEiCgogICAgZGVmIGRvX0dFVChzZWxmKToKICAgICAgICBzZWxm
LmdldF9jYWxsZWQgPSBUcnVlCiAgICAgICAgc2VsZi5zZW5kX3Jlc3BvbnNlKDIwMCkKICAg
ICAgICBzZWxmLnNlbmRfaGVhZGVyKCdDb250ZW50LVR5cGUnLCAndGV4dC9odG1sJykKICAg
ICAgICBzZWxmLmVuZF9oZWFkZXJzKCkKICAgICAgICBzZWxmLndmaWxlLndyaXRlKGInPGh0
bWw+PGJvZHk+RGF0YTwvYm9keT48L2h0bWw+XHJcbicpCgogICAgZGVmIGxvZ19tZXNzYWdl
KHNlbGYsIGZvcm1hdCwgKmFyZ3MpOgogICAgICAgIHBhc3MKCmNsYXNzIFJlamVjdGluZ1Nv
Y2tldGxlc3NSZXF1ZXN0SGFuZGxlcihTb2NrZXRsZXNzUmVxdWVzdEhhbmRsZXIpOgogICAg
ZGVmIGhhbmRsZV9leHBlY3RfMTAwKHNlbGYpOgogICAgICAgIHNlbGYuc2VuZF9lcnJvcig0
MTcpCiAgICAgICAgcmV0dXJuIEZhbHNlCgpjbGFzcyBCYXNlSFRUUFJlcXVlc3RIYW5kbGVy
VGVzdENhc2UodW5pdHRlc3QuVGVzdENhc2UpOgogICAgIiIiVGVzdCB0aGUgZnVuY3Rpb25h
bGl0eSBvZiB0aGUgQmFzZUhUVFBTZXJ2ZXIuCgogICAgICAgVGVzdCB0aGUgc3VwcG9ydCBm
b3IgdGhlIEV4cGVjdCAxMDAtY29udGludWUgaGVhZGVyLgogICAgICAgIiIiCgogICAgSFRU
UFJlc3BvbnNlTWF0Y2ggPSByZS5jb21waWxlKGInSFRUUC8xLlswLTldKyAyMDAgT0snKQoK
ICAgIGRlZiBzZXRVcCAoc2VsZik6CiAgICAgICAgc2VsZi5oYW5kbGVyID0gU29ja2V0bGVz
c1JlcXVlc3RIYW5kbGVyKCkKCiAgICBkZWYgc2VuZF90eXBpY2FsX3JlcXVlc3Qoc2VsZiwg
bWVzc2FnZSk6CiAgICAgICAgaW5wdXQgPSBCeXRlc0lPKG1lc3NhZ2UpCiAgICAgICAgb3V0
cHV0ID0gQnl0ZXNJTygpCiAgICAgICAgc2VsZi5oYW5kbGVyLnJmaWxlID0gaW5wdXQKICAg
ICAgICBzZWxmLmhhbmRsZXIud2ZpbGUgPSBvdXRwdXQKICAgICAgICBzZWxmLmhhbmRsZXIu
aGFuZGxlX29uZV9yZXF1ZXN0KCkKICAgICAgICBvdXRwdXQuc2VlaygwKQogICAgICAgIHJl
dHVybiBvdXRwdXQucmVhZGxpbmVzKCkKCiAgICBkZWYgdmVyaWZ5X2dldF9jYWxsZWQoc2Vs
Zik6CiAgICAgICAgc2VsZi5hc3NlcnRUcnVlKHNlbGYuaGFuZGxlci5nZXRfY2FsbGVkKQoK
ICAgIGRlZiB2ZXJpZnlfZXhwZWN0ZWRfaGVhZGVycyhzZWxmLCBoZWFkZXJzKToKICAgICAg
ICBmb3IgZmllbGROYW1lIGluIGInU2VydmVyOiAnLCBiJ0RhdGU6ICcsIGInQ29udGVudC1U
eXBlOiAnOgogICAgICAgICAgICBzZWxmLmFzc2VydEVxdWFsKHN1bShoLnN0YXJ0c3dpdGgo
ZmllbGROYW1lKSBmb3IgaCBpbiBoZWFkZXJzKSwgMSkKCiAgICBkZWYgdmVyaWZ5X2h0dHBf
c2VydmVyX3Jlc3BvbnNlKHNlbGYsIHJlc3BvbnNlKToKICAgICAgICBtYXRjaCA9IHNlbGYu
SFRUUFJlc3BvbnNlTWF0Y2guc2VhcmNoKHJlc3BvbnNlKQogICAgICAgIHNlbGYuYXNzZXJ0
VHJ1ZShtYXRjaCBpcyBub3QgTm9uZSkKCiAgICBkZWYgdGVzdF9odHRwXzFfMShzZWxmKToK
ICAgICAgICByZXN1bHQgPSBzZWxmLnNlbmRfdHlwaWNhbF9yZXF1ZXN0KGInR0VUIC8gSFRU
UC8xLjFcclxuXHJcbicpCiAgICAgICAgc2VsZi52ZXJpZnlfaHR0cF9zZXJ2ZXJfcmVzcG9u
c2UocmVzdWx0WzBdKQogICAgICAgIHNlbGYudmVyaWZ5X2V4cGVjdGVkX2hlYWRlcnMocmVz
dWx0WzE6LTFdKQogICAgICAgIHNlbGYudmVyaWZ5X2dldF9jYWxsZWQoKQogICAgICAgIHNl
bGYuYXNzZXJ0RXF1YWwocmVzdWx0Wy0xXSwgYic8aHRtbD48Ym9keT5EYXRhPC9ib2R5Pjwv
aHRtbD5cclxuJykKCiAgICBkZWYgdGVzdF9odHRwXzFfMChzZWxmKToKICAgICAgICByZXN1
bHQgPSBzZWxmLnNlbmRfdHlwaWNhbF9yZXF1ZXN0KGInR0VUIC8gSFRUUC8xLjBcclxuXHJc
bicpCiAgICAgICAgc2VsZi52ZXJpZnlfaHR0cF9zZXJ2ZXJfcmVzcG9uc2UocmVzdWx0WzBd
KQogICAgICAgIHNlbGYudmVyaWZ5X2V4cGVjdGVkX2hlYWRlcnMocmVzdWx0WzE6LTFdKQog
ICAgICAgIHNlbGYudmVyaWZ5X2dldF9jYWxsZWQoKQogICAgICAgIHNlbGYuYXNzZXJ0RXF1
YWwocmVzdWx0Wy0xXSwgYic8aHRtbD48Ym9keT5EYXRhPC9ib2R5PjwvaHRtbD5cclxuJykK
CiAgICBkZWYgdGVzdF9odHRwXzBfOShzZWxmKToKICAgICAgICByZXN1bHQgPSBzZWxmLnNl
bmRfdHlwaWNhbF9yZXF1ZXN0KGInR0VUIC8gSFRUUC8wLjlcclxuXHJcbicpCiAgICAgICAg
c2VsZi5hc3NlcnRFcXVhbChsZW4ocmVzdWx0KSwgMSkKICAgICAgICBzZWxmLmFzc2VydEVx
dWFsKHJlc3VsdFswXSwgYic8aHRtbD48Ym9keT5EYXRhPC9ib2R5PjwvaHRtbD5cclxuJykK
ICAgICAgICBzZWxmLnZlcmlmeV9nZXRfY2FsbGVkKCkKCiAgICBkZWYgdGVzdF93aXRoX2Nv
bnRpbnVlXzFfMChzZWxmKToKICAgICAgICByZXN1bHQgPSBzZWxmLnNlbmRfdHlwaWNhbF9y
ZXF1ZXN0KGInR0VUIC8gSFRUUC8xLjBcclxuRXhwZWN0OiAxMDAtY29udGludWVcclxuXHJc
bicpCiAgICAgICAgc2VsZi52ZXJpZnlfaHR0cF9zZXJ2ZXJfcmVzcG9uc2UocmVzdWx0WzBd
KQogICAgICAgIHNlbGYudmVyaWZ5X2V4cGVjdGVkX2hlYWRlcnMocmVzdWx0WzE6LTFdKQog
ICAgICAgIHNlbGYudmVyaWZ5X2dldF9jYWxsZWQoKQogICAgICAgIHNlbGYuYXNzZXJ0RXF1
YWwocmVzdWx0Wy0xXSwgYic8aHRtbD48Ym9keT5EYXRhPC9ib2R5PjwvaHRtbD5cclxuJykK
CiAgICBkZWYgdGVzdF93aXRoX2NvbnRpbnVlXzFfMShzZWxmKToKICAgICAgICByZXN1bHQg
PSBzZWxmLnNlbmRfdHlwaWNhbF9yZXF1ZXN0KGInR0VUIC8gSFRUUC8xLjFcclxuRXhwZWN0
OiAxMDAtY29udGludWVcclxuXHJcbicpCiAgICAgICAgc2VsZi5hc3NlcnRFcXVhbChyZXN1
bHRbMF0sIGInSFRUUC8xLjEgMTAwIENvbnRpbnVlXHJcbicpCiAgICAgICAgc2VsZi5hc3Nl
cnRFcXVhbChyZXN1bHRbMV0sIGInSFRUUC8xLjEgMjAwIE9LXHJcbicpCiAgICAgICAgc2Vs
Zi52ZXJpZnlfZXhwZWN0ZWRfaGVhZGVycyhyZXN1bHRbMjotMV0pCiAgICAgICAgc2VsZi52
ZXJpZnlfZ2V0X2NhbGxlZCgpCiAgICAgICAgc2VsZi5hc3NlcnRFcXVhbChyZXN1bHRbLTFd
LCBiJzxodG1sPjxib2R5PkRhdGE8L2JvZHk+PC9odG1sPlxyXG4nKQoKICAgIGRlZiB0ZXN0
X2hlYWRlcl9idWZmZXJpbmcoc2VsZik6CgogICAgICAgIGRlZiBfcmVhZEFuZFJlc2Vlayhm
KToKICAgICAgICAgICAgcG9zID0gZi50ZWxsKCkKICAgICAgICAgICAgZi5zZWVrKDApCiAg
ICAgICAgICAgIGRhdGEgPSBmLnJlYWQoKQogICAgICAgICAgICBmLnNlZWsocG9zKQogICAg
ICAgICAgICByZXR1cm4gZGF0YQoKICAgICAgICBpbnB1dCA9IEJ5dGVzSU8oYidHRVQgLyBI
VFRQLzEuMVxyXG5cclxuJykKICAgICAgICBvdXRwdXQgPSBCeXRlc0lPKCkKICAgICAgICBz
ZWxmLmhhbmRsZXIucmZpbGUgPSBpbnB1dAogICAgICAgIHNlbGYuaGFuZGxlci53ZmlsZSA9
IG91dHB1dAogICAgICAgIHNlbGYuaGFuZGxlci5yZXF1ZXN0X3ZlcnNpb24gPSAnSFRUUC8x
LjEnCgogICAgICAgIHNlbGYuaGFuZGxlci5zZW5kX2hlYWRlcignRm9vJywgJ2ZvbycpCiAg
ICAgICAgc2VsZi5oYW5kbGVyLnNlbmRfaGVhZGVyKCdiYXInLCAnYmFyJykKICAgICAgICBz
ZWxmLmFzc2VydEVxdWFsKF9yZWFkQW5kUmVzZWVrKG91dHB1dCksIGInJykKICAgICAgICBz
ZWxmLmhhbmRsZXIuZW5kX2hlYWRlcnMoKQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwoX3Jl
YWRBbmRSZXNlZWsob3V0cHV0KSwKICAgICAgICAgICAgICAgICAgICAgICAgIGInRm9vOiBm
b29cclxuYmFyOiBiYXJcclxuXHJcbicpCgogICAgZGVmIHRlc3RfaGVhZGVyX3VuYnVmZmVy
ZWRfd2hlbl9jb250aW51ZShzZWxmKToKCiAgICAgICAgZGVmIF9yZWFkQW5kUmVzZWVrKGYp
OgogICAgICAgICAgICBwb3MgPSBmLnRlbGwoKQogICAgICAgICAgICBmLnNlZWsoMCkKICAg
ICAgICAgICAgZGF0YSA9IGYucmVhZCgpCiAgICAgICAgICAgIGYuc2Vlayhwb3MpCiAgICAg
ICAgICAgIHJldHVybiBkYXRhCgogICAgICAgIGlucHV0ID0gQnl0ZXNJTyhiJ0dFVCAvIEhU
VFAvMS4xXHJcbkV4cGVjdDogMTAwLWNvbnRpbnVlXHJcblxyXG4nKQogICAgICAgIG91dHB1
dCA9IEJ5dGVzSU8oKQogICAgICAgIHNlbGYuaGFuZGxlci5yZmlsZSA9IGlucHV0CiAgICAg
ICAgc2VsZi5oYW5kbGVyLndmaWxlID0gb3V0cHV0CiAgICAgICAgc2VsZi5oYW5kbGVyLnJl
cXVlc3RfdmVyc2lvbiA9ICdIVFRQLzEuMScKCiAgICAgICAgc2VsZi5oYW5kbGVyLmhhbmRs
ZV9vbmVfcmVxdWVzdCgpCiAgICAgICAgc2VsZi5hc3NlcnROb3RFcXVhbChfcmVhZEFuZFJl
c2VlayhvdXRwdXQpLCBiJycpCiAgICAgICAgcmVzdWx0ID0gX3JlYWRBbmRSZXNlZWsob3V0
cHV0KS5zcGxpdChiJ1xyXG4nKQogICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwocmVzdWx0WzBd
LCBiJ0hUVFAvMS4xIDEwMCBDb250aW51ZScpCiAgICAgICAgc2VsZi5hc3NlcnRFcXVhbChy
ZXN1bHRbMV0sIGInSFRUUC8xLjEgMjAwIE9LJykKCiAgICBkZWYgdGVzdF93aXRoX2NvbnRp
bnVlX3JlamVjdGVkKHNlbGYpOgogICAgICAgIHVzdWFsX2hhbmRsZXIgPSBzZWxmLmhhbmRs
ZXIgICAgICAgICMgU2F2ZSB0byBhdm9pZCBicmVha2luZyBhbnkgc3Vic2VxdWVudCB0ZXN0
cy4KICAgICAgICBzZWxmLmhhbmRsZXIgPSBSZWplY3RpbmdTb2NrZXRsZXNzUmVxdWVzdEhh
bmRsZXIoKQogICAgICAgIHJlc3VsdCA9IHNlbGYuc2VuZF90eXBpY2FsX3JlcXVlc3QoYidH
RVQgLyBIVFRQLzEuMVxyXG5FeHBlY3Q6IDEwMC1jb250aW51ZVxyXG5cclxuJykKICAgICAg
ICBzZWxmLmFzc2VydEVxdWFsKHJlc3VsdFswXSwgYidIVFRQLzEuMSA0MTcgRXhwZWN0YXRp
b24gRmFpbGVkXHJcbicpCiAgICAgICAgc2VsZi52ZXJpZnlfZXhwZWN0ZWRfaGVhZGVycyhy
ZXN1bHRbMTotMV0pCiAgICAgICAgIyBUaGUgZXhwZWN0IGhhbmRsZXIgc2hvdWxkIHNob3J0
IGNpcmN1aXQgdGhlIHVzdWFsIGdldCBtZXRob2QgYnkKICAgICAgICAjIHJldHVybmluZyBm
YWxzZSBoZXJlLCBzbyBnZXRfY2FsbGVkIHNob3VsZCBiZSBmYWxzZQogICAgICAgIHNlbGYu
YXNzZXJ0RmFsc2Uoc2VsZi5oYW5kbGVyLmdldF9jYWxsZWQpCiAgICAgICAgc2VsZi5hc3Nl
cnRFcXVhbChzdW0ociA9PSBiJ0Nvbm5lY3Rpb246IGNsb3NlXHJcbicgZm9yIHIgaW4gcmVz
dWx0WzE6LTFdKSwgMSkKICAgICAgICBzZWxmLmhhbmRsZXIgPSB1c3VhbF9oYW5kbGVyICAg
ICAgICAjIFJlc3RvcmUgdG8gYXZvaWQgYnJlYWtpbmcgYW55IHN1YnNlcXVlbnQgdGVzdHMu
CgogICAgZGVmIHRlc3RfcmVxdWVzdF9sZW5ndGgoc2VsZik6CiAgICAgICAgIyBJc3N1ZSAj
MTA3MTQ6IGh1Z2UgcmVxdWVzdCBsaW5lcyBhcmUgZGlzY2FyZGVkLCB0byBhdm9pZCBEZW5p
YWwKICAgICAgICAjIG9mIFNlcnZpY2UgYXR0YWNrcy4KICAgICAgICByZXN1bHQgPSBzZWxm
LnNlbmRfdHlwaWNhbF9yZXF1ZXN0KGInR0VUICcgKyBiJ3gnICogNjU1MzcpCiAgICAgICAg
c2VsZi5hc3NlcnRFcXVhbChyZXN1bHRbMF0sIGInSFRUUC8xLjEgNDE0IFJlcXVlc3QtVVJJ
IFRvbyBMb25nXHJcbicpCiAgICAgICAgc2VsZi5hc3NlcnRGYWxzZShzZWxmLmhhbmRsZXIu
Z2V0X2NhbGxlZCkKCiAgICBkZWYgdGVzdF9oZWFkZXJfbGVuZ3RoKHNlbGYpOgogICAgICAg
ICMgSXNzdWUgIzY3OTE6IHNhbWUgZm9yIGhlYWRlcnMKICAgICAgICByZXN1bHQgPSBzZWxm
LnNlbmRfdHlwaWNhbF9yZXF1ZXN0KAogICAgICAgICAgICBiJ0dFVCAvIEhUVFAvMS4xXHJc
blgtRm9vOiBiYXInICsgYidyJyAqIDY1NTM3ICsgYidcclxuXHJcbicpCiAgICAgICAgc2Vs
Zi5hc3NlcnRFcXVhbChyZXN1bHRbMF0sIGInSFRUUC8xLjEgNDAwIExpbmUgdG9vIGxvbmdc
clxuJykKICAgICAgICBzZWxmLmFzc2VydEZhbHNlKHNlbGYuaGFuZGxlci5nZXRfY2FsbGVk
KQoKY2xhc3MgU2ltcGxlSFRUUFJlcXVlc3RIYW5kbGVyVGVzdENhc2UodW5pdHRlc3QuVGVz
dENhc2UpOgogICAgIiIiIFRlc3QgdXJsIHBhcnNpbmcgIiIiCiAgICBkZWYgc2V0VXAoc2Vs
Zik6CiAgICAgICAgc2VsZi50cmFuc2xhdGVkID0gb3MuZ2V0Y3dkKCkKICAgICAgICBzZWxm
LnRyYW5zbGF0ZWQgPSBvcy5wYXRoLmpvaW4oc2VsZi50cmFuc2xhdGVkLCAnZmlsZW5hbWUn
KQogICAgICAgIHNlbGYuaGFuZGxlciA9IFNvY2tldGxlc3NSZXF1ZXN0SGFuZGxlcigpCgog
ICAgZGVmIHRlc3RfcXVlcnlfYXJndW1lbnRzKHNlbGYpOgogICAgICAgIHBhdGggPSBzZWxm
LmhhbmRsZXIudHJhbnNsYXRlX3BhdGgoJy9maWxlbmFtZScpCiAgICAgICAgc2VsZi5hc3Nl
cnRFcXVhbChwYXRoLCBzZWxmLnRyYW5zbGF0ZWQpCiAgICAgICAgcGF0aCA9IHNlbGYuaGFu
ZGxlci50cmFuc2xhdGVfcGF0aCgnL2ZpbGVuYW1lP2Zvbz1iYXInKQogICAgICAgIHNlbGYu
YXNzZXJ0RXF1YWwocGF0aCwgc2VsZi50cmFuc2xhdGVkKQogICAgICAgIHBhdGggPSBzZWxm
LmhhbmRsZXIudHJhbnNsYXRlX3BhdGgoJy9maWxlbmFtZT9hPWImc3BhbT1lZ2dzI3pvdCcp
CiAgICAgICAgc2VsZi5hc3NlcnRFcXVhbChwYXRoLCBzZWxmLnRyYW5zbGF0ZWQpCgogICAg
ZGVmIHRlc3Rfc3RhcnRfd2l0aF9kb3VibGVfc2xhc2goc2VsZik6CiAgICAgICAgcGF0aCA9
IHNlbGYuaGFuZGxlci50cmFuc2xhdGVfcGF0aCgnLy9maWxlbmFtZScpCiAgICAgICAgc2Vs
Zi5hc3NlcnRFcXVhbChwYXRoLCBzZWxmLnRyYW5zbGF0ZWQpCiAgICAgICAgcGF0aCA9IHNl
bGYuaGFuZGxlci50cmFuc2xhdGVfcGF0aCgnLy9maWxlbmFtZT9mb289YmFyJykKICAgICAg
ICBzZWxmLmFzc2VydEVxdWFsKHBhdGgsIHNlbGYudHJhbnNsYXRlZCkKCgpkZWYgdGVzdF9t
YWluKHZlcmJvc2U9Tm9uZSk6CiAgICBjd2QgPSBvcy5nZXRjd2QoKQogICAgdHJ5OgogICAg
ICAgIHN1cHBvcnQucnVuX3VuaXR0ZXN0KAogICAgICAgICAgICBCYXNlSFRUUFJlcXVlc3RI
YW5kbGVyVGVzdENhc2UsCiAgICAgICAgICAgIEJhc2VIVFRQU2VydmVyVGVzdENhc2UsCiAg
ICAgICAgICAgIFNpbXBsZUhUVFBTZXJ2ZXJUZXN0Q2FzZSwKICAgICAgICAgICAgQ0dJSFRU
UFNlcnZlclRlc3RDYXNlLAogICAgICAgICAgICBTaW1wbGVIVFRQUmVxdWVzdEhhbmRsZXJU
ZXN0Q2FzZSwKICAgICAgICApCiAgICBmaW5hbGx5OgogICAgICAgIG9zLmNoZGlyKGN3ZCkK
CmlmIF9fbmFtZV9fID09ICdfX21haW5fXyc6CiAgICB0ZXN0X21haW4oKQo=
--------------030907040804090606000906--

From senthil  Tue Apr 17 19:22:08 2012
Delivered-To: senthil@uthcode.com
Received: from iy-in-f109.1e100.net [209.85.225.109]
	by mathmagic with POP3 (fetchmail-6.3.19)
	for <senthil@localhost> (single-drop); Tue, 17 Apr 2012 19:22:08 +0800 (SGT)
Received: by 10.60.61.36 with SMTP id m4csp70345oer;
        Mon, 16 Apr 2012 23:05:09 -0700 (PDT)
Received: by 10.216.134.200 with SMTP id s50mr8309236wei.116.1334642709038;
        Mon, 16 Apr 2012 23:05:09 -0700 (PDT)
Return-Path: <roundup-admin@psf.upfronthosting.co.za>
Received: from psf.upfronthosting.co.za (bugs.python.org. [46.4.197.70])
        by mx.google.com with ESMTP id s74si20730715weq.130.2012.04.16.23.05.08;
        Mon, 16 Apr 2012 23:05:09 -0700 (PDT)
Received-SPF: neutral (google.com: 46.4.197.70 is neither permitted nor denied by best guess record for domain of roundup-admin@psf.upfronthosting.co.za) client-ip=46.4.197.70;
Authentication-Results: mx.google.com; spf=neutral (google.com: 46.4.197.70 is neither permitted nor denied by best guess record for domain of roundup-admin@psf.upfronthosting.co.za) smtp.mail=roundup-admin@psf.upfronthosting.co.za
Received: from psf.upfronthosting.co.za (localhost [10.0.0.1])
	by psf.upfronthosting.co.za (Postfix) with ESMTP id 0B9C81CB38
	for <senthil@uthcode.com>; Tue, 17 Apr 2012 08:05:08 +0200 (CEST)
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Subject: [issue10486] http.server doesn't set all CGI environment variables
To: senthil@uthcode.com
From: Glenn Linderman <report@bugs.python.org>
Date: Tue, 17 Apr 2012 06:05:08 +0000
Precedence: bulk
X-Roundup-Name: Python tracker
X-Roundup-Loop: hello
X-Roundup-Version: 1.4.19
Reply-To: Python tracker <report@bugs.python.org>
Message-Id: <1334642707.9.0.200978022226.issue10486@psf.upfronthosting.co.za>
In-Reply-To: <1290325295.78.0.545647251788.issue10486@psf.upfronthosting.co.za>
X-Roundup-issue-status: open
X-Roundup-issue-type: behavior
X-Roundup-issue-severity: normal
X-Roundup-issue-versions: Python 2.6, Python 3.1, Python 2.7, Python 3.2
X-Roundup-issue-priority: normal
X-Roundup-issue-components: Library (Lib)
Content-Transfer-Encoding: quoted-printable
Content-Length: 663
Lines: 25


Glenn Linderman <v+python@g.nevcal.com> added the comment:

Reading the CGI 1.1 spec, it says:

   The QUERY_STRING value provides the query-string part of the
   Script-URI.  (See section 3.3).

   The server MUST set this variable; if the Script-URI does not include
   a query component, the QUERY_STRING MUST be defined as an empty
   string ("").

Therefore the code in run_cgi that says:

        if query:
            env['QUERY_STRING'] =3D query

should have the conditional removed.

----------

_______________________________________
Python tracker <report@bugs.python.org>
<http://bugs.python.org/issue10486>
_______________________________________

From senthil  Tue Apr 17 19:22:09 2012
Delivered-To: senthil@uthcode.com
Received: from iy-in-f109.1e100.net [209.85.225.109]
	by mathmagic with POP3 (fetchmail-6.3.19)
	for <senthil@localhost> (single-drop); Tue, 17 Apr 2012 19:22:09 +0800 (SGT)
Received: by 10.60.61.36 with SMTP id m4csp70347oer;
        Mon, 16 Apr 2012 23:05:16 -0700 (PDT)
Received: by 10.213.17.5 with SMTP id q5mr1020643eba.242.1334642715745;
        Mon, 16 Apr 2012 23:05:15 -0700 (PDT)
Return-Path: <python-bugs-list-bounces+senthil=uthcode.com@python.org>
Received: from mail.python.org (mail.python.org. [82.94.164.166])
        by mx.google.com with ESMTPS id k43si5681979een.108.2012.04.16.23.05.15
        (version=TLSv1/SSLv3 cipher=OTHER);
        Mon, 16 Apr 2012 23:05:15 -0700 (PDT)
Received-SPF: pass (google.com: domain of python-bugs-list-bounces+senthil=uthcode.com@python.org designates 82.94.164.166 as permitted sender) client-ip=82.94.164.166;
Authentication-Results: mx.google.com; spf=pass (google.com: domain of python-bugs-list-bounces+senthil=uthcode.com@python.org designates 82.94.164.166 as permitted sender) smtp.mail=python-bugs-list-bounces+senthil=uthcode.com@python.org; dkim=pass header.i=@python.org
Received: from albatross.python.org (localhost [127.0.0.1])
	by mail.python.org (Postfix) with ESMTP id 3VWwt274QXzMPD
	for <senthil@uthcode.com>; Tue, 17 Apr 2012 08:05:14 +0200 (CEST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=python.org; s=200901;
	t=1334642715; bh=Yc1AFObs1G0/cRtn0jZgwWK5Mt+ypcOUFdbz7MZV2w8=;
	h=MIME-Version:Subject:To:From:Date:Message-Id:In-Reply-To:Reply-To:
	 List-Id:List-Unsubscribe:List-Archive:List-Post:List-Help:
	 List-Subscribe:Content-Type:Content-Transfer-Encoding:Sender;
	b=aDI2JtBxOsa8y145PSmMqTjuQIshcQ4fMNRV6qhwx/OUx+oV8JzyqOEGLHWH2oiPS
	 JGitWY7n83M5gysRJNAoEK2xPk2bLjb746itIMu9fAdxElg9xB+RsVlUAQNEHd11z0
	 MCZtJNybouamm+mTr5evHbTxWBYT7YPsMCloGPSo=
X-Original-To: python-bugs-list@python.org
Delivered-To: python-bugs-list@mail.python.org
Received: from albatross.python.org (localhost [127.0.0.1])
	by mail.python.org (Postfix) with ESMTP id 3VWwsw0V08zMhZ
	for <python-bugs-list@python.org>;
	Tue, 17 Apr 2012 08:05:08 +0200 (CEST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=python.org; s=200901;
	t=1334642708; i=@python.org;
	bh=veRGaT086yqJXOp4QWOK2Fc9loSPtcdCcOg/VqaOE/c=;
	h=MIME-Version:Content-Type:Subject:To:From:Date:Reply-To:
	Message-Id:In-Reply-To:Content-Transfer-Encoding;
	b=IZdOX+nWnF7rx1a/Z+S0M5CtYSil1qrNK0w0H3UrYoA4ZB2ztLF58iyr1WRhIzJ6Q
	yB2E6bQItjAYkhEj2TY4KbtKq3pL/EbeJ8vyTbfZqWgvnqVNAvVpTJP2yqsyLkICCl
	1M55VV9SAc+UYZO/UI25efzjbP19xTnR+25/o9jo=
X-Spam-Status: OK 0.004
X-Spam-Evidence: '*H*': 0.99; '*S*': 0.00; 'message-
	id:@psf.upfronthosting.co.za': 0.04; 'python': 0.09; 'cgi': 0.09;
	'subject:set': 0.09; 'conditional': 0.16; 'spec,': 0.16;
	'removed.': 0.17; 'defined': 0.19; 'string': 0.19; 'url:bugs':
	0.19; 'tracker': 0.20; 'header:In-Reply-To:1': 0.22; 'subject:] ':
	0.22; '(see': 0.23; 'comment:': 0.23; 'from:addr:bugs.python.org':
	0.23; 'from:addr:report': 0.23; 'received:10.0.0.1': 0.23;
	'received:psf.upfronthosting.co.za': 0.23;
	'received:upfronthosting.co.za': 0.23; 'reply-
	to:addr:bugs.python.org': 0.23; 'reply-to:addr:report': 0.23;
	'reply-to:name:python tracker': 0.23; 'subject:all': 0.26;
	'received:46.4.197': 0.27; 'received:46.4.197.70': 0.27; 'to:addr
	:python-bugs-list': 0.27; '----------': 0.27; 'query': 0.30;
	'url:python': 0.32; 'code': 0.32; 'received:co.za': 0.32;
	'received:za': 0.32; 'received:10.0.0': 0.33; 'skip:_ 30': 0.33;
	'server': 0.33; 'received:46.4': 0.34; 'should': 0.35; 'url:org':
	0.35; 'does': 0.36; 'subject:[': 0.36; 'reading': 0.36;
	'received:10.0': 0.38; 'to:addr:python.org': 0.39; 'header
	:Message-Id:1': 0.61; 'header:Reply-To:1': 0.67; 'glenn': 0.84
Received: from localhost (HELO mail.python.org) (127.0.0.1)
	by albatross.python.org with SMTP; 17 Apr 2012 08:05:08 +0200
Received: from psf.upfronthosting.co.za (bugs.python.org [46.4.197.70])
	by mail.python.org (Postfix) with ESMTP
	for <python-bugs-list@python.org>;
	Tue, 17 Apr 2012 08:05:07 +0200 (CEST)
Received: from psf.upfronthosting.co.za (localhost [10.0.0.1])
	by psf.upfronthosting.co.za (Postfix) with ESMTP id E111E1CAB1
	for <python-bugs-list@python.org>;
	Tue, 17 Apr 2012 08:05:07 +0200 (CEST)
MIME-Version: 1.0
Subject: [issue10486] http.server doesn't set all CGI environment variables
To: python-bugs-list@python.org
From: Glenn Linderman <report@bugs.python.org>
Date: Tue, 17 Apr 2012 06:05:07 +0000
Precedence: bulk
X-Roundup-Name: Python tracker
X-Roundup-Loop: hello
X-Roundup-Version: 1.4.19
Message-Id: <1334642707.9.0.200978022226.issue10486@psf.upfronthosting.co.za>
X-Roundup-issue-status: open
X-Roundup-issue-type: behavior
X-Roundup-issue-severity: normal
X-Roundup-issue-versions: Python 2.6, Python 3.1, Python 2.7, Python 3.2
X-Roundup-issue-priority: normal
X-Roundup-issue-components: Library (Lib)
In-Reply-To: <1290325295.78.0.545647251788.issue10486@psf.upfronthosting.co.za>
X-BeenThere: python-bugs-list@python.org
X-Mailman-Version: 2.1.12
Reply-To: Python tracker <report@bugs.python.org>
List-Id: List which receives bug reports on Python
	<python-bugs-list.python.org>
List-Unsubscribe: <http://mail.python.org/mailman/options/python-bugs-list>,
	<mailto:python-bugs-list-request@python.org?subject=unsubscribe>
List-Archive: <http://mail.python.org/pipermail/python-bugs-list>
List-Post: <mailto:python-bugs-list@python.org>
List-Help: <mailto:python-bugs-list-request@python.org?subject=help>
List-Subscribe: <http://mail.python.org/mailman/listinfo/python-bugs-list>,
	<mailto:python-bugs-list-request@python.org?subject=subscribe>
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: 7bit
Sender: python-bugs-list-bounces+senthil=uthcode.com@python.org
Errors-To: python-bugs-list-bounces+senthil=uthcode.com@python.org
Content-Length: 830
Lines: 28


Glenn Linderman <v+python@g.nevcal.com> added the comment:

Reading the CGI 1.1 spec, it says:

   The QUERY_STRING value provides the query-string part of the
   Script-URI.  (See section 3.3).

   The server MUST set this variable; if the Script-URI does not include
   a query component, the QUERY_STRING MUST be defined as an empty
   string ("").

Therefore the code in run_cgi that says:

        if query:
            env['QUERY_STRING'] = query

should have the conditional removed.

----------

_______________________________________
Python tracker <report@bugs.python.org>
<http://bugs.python.org/issue10486>
_______________________________________
_______________________________________________
Python-bugs-list mailing list
Unsubscribe: http://mail.python.org/mailman/options/python-bugs-list/senthil%40uthcode.com

From senthil  Tue Apr 17 19:22:51 2012
Delivered-To: senthil@uthcode.com
Received: from iy-in-f109.1e100.net [209.85.225.109]
	by mathmagic with POP3 (fetchmail-6.3.19)
	for <senthil@localhost> (single-drop); Tue, 17 Apr 2012 19:22:51 +0800 (SGT)
Received: by 10.60.61.36 with SMTP id m4csp70617oer;
        Mon, 16 Apr 2012 23:17:24 -0700 (PDT)
Received: by 10.60.20.231 with SMTP id q7mr20061848oee.63.1334643444099;
        Mon, 16 Apr 2012 23:17:24 -0700 (PDT)
Return-Path: <v+python@g.nevcal.com>
Received: from oproxy6-pub.bluehost.com (oproxy6-pub.bluehost.com. [67.222.54.6])
        by mx.google.com with SMTP id t2si12931241oef.28.2012.04.16.23.17.23;
        Mon, 16 Apr 2012 23:17:23 -0700 (PDT)
Received-SPF: neutral (google.com: 67.222.54.6 is neither permitted nor denied by best guess record for domain of v+python@g.nevcal.com) client-ip=67.222.54.6;
Authentication-Results: mx.google.com; spf=neutral (google.com: 67.222.54.6 is neither permitted nor denied by best guess record for domain of v+python@g.nevcal.com) smtp.mail=v+python@g.nevcal.com
Received: (qmail 11180 invoked by uid 0); 17 Apr 2012 06:17:22 -0000
Received: from unknown (HELO box538.bluehost.com) (74.220.219.138)
  by cpoproxy3.bluehost.com with SMTP; 17 Apr 2012 06:17:22 -0000
Received: from [50.37.28.55] (helo=[192.168.43.254])
	by box538.bluehost.com with esmtpa (Exim 4.76)
	(envelope-from <v+python@g.nevcal.com>)
	id 1SK1j7-00041M-Rv
	for senthil@uthcode.com; Tue, 17 Apr 2012 00:17:22 -0600
Message-ID: <4F8D0AE8.1000804@g.nevcal.com>
Date: Mon, 16 Apr 2012 23:17:12 -0700
From: Glenn Linderman <v+python@g.nevcal.com>
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:11.0) Gecko/20120327 Thunderbird/11.0.1
MIME-Version: 1.0
To: senthil@uthcode.com
Subject: Re: plans for http.server ?
References: <4F89347E.3070409@g.nevcal.com>
In-Reply-To: <4F89347E.3070409@g.nevcal.com>
Content-Type: multipart/alternative;
 boundary="------------030005030606070907060004"
X-Identified-User: {11138:box538.bluehost.com:areliabl:nevcal.com} {sentby:smtp auth 50.37.28.55 authed with test@nevcal.com}
Content-Length: 3697
Lines: 77

This is a multi-part message in MIME format.
--------------030005030606070907060004
Content-Type: text/plain; charset=UTF-8; format=flowed
Content-Transfer-Encoding: 7bit

On 4/14/2012 1:25 AM, Glenn Linderman wrote:
> 6. detecting drive letters and \ in each path component is OK for 
> files, but may get in the way of passing parameters via PATH_INFO path 
> components, so should probably only be called on path components prior 
> to the actual CGI file, rather than on the whole path.  One could make 
> the case that that is true for /../ detection also.  Turning 
> parameters over to the CGI script also turns over responsibilities to 
> it, which can only be bounded by OS permissions for the effective 
> userid of the CGI script.  It doesn't appear that http.server, is 
> targeted at multiuser, shared hosting servers! So effective userid 
> manipulations are not part of the code base.

However, today Glenn reads in the CGI 1.1 spec, section 4.1.5:

> The server MAY
>     impose restrictions and limitations on what values it permits for
>     PATH_INFO, and MAY reject the request with an error if it encounters
>     any values considered objectionable.  That MAY include any requests
>     that would result in an encoded "/" being decoded into PATH_INFO, as
>     this might represent a loss of information to the script.  Similarly,
>     treatment of non US-ASCII characters in the path is system-defined.

So it would be legal, and simpler, to define that PATH_INFO is not 
allowed to contain os-specific drive parts or os-specific path 
separators or os-specific curdir or pardir values, and check for all 
those up-front in parse-request.


--------------030005030606070907060004
Content-Type: text/html; charset=UTF-8
Content-Transfer-Encoding: 8bit

<html>
  <head>
    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  </head>
  <body bgcolor="#FFFFFF" text="#330033">
    On 4/14/2012 1:25 AM, Glenn Linderman wrote:
    <blockquote cite="mid:4F89347E.3070409@g.nevcal.com" type="cite">6.
      detecting drive letters and \ in each path component is OK for
      files, but may get in the way of passing parameters via PATH_INFO
      path components, so should probably only be called on path
      components prior to the actual CGI file, rather than on the whole
      path.  One could make the case that that is true for /../
      detection also.  Turning parameters over to the CGI script also
      turns over responsibilities to it, which can only be bounded by OS
      permissions for the effective userid of the CGI script.  It
      doesn't appear that http.server, is targeted at multiuser, shared
      hosting servers! So effective userid manipulations are not part of
      the code base.</blockquote>
    <br>
    However, today Glenn reads in the CGI 1.1 spec, section 4.1.5:<br>
    <br>
    <blockquote type="cite">
      <pre>The server MAY
   impose restrictions and limitations on what values it permits for
   PATH_INFO, and MAY reject the request with an error if it encounters
   any values considered objectionable.  That MAY include any requests
   that would result in an encoded "/" being decoded into PATH_INFO, as
   this might represent a loss of information to the script.  Similarly,
   treatment of non US-ASCII characters in the path is system-defined.</pre>
    </blockquote>
    <br>
    So it would be legal, and simpler, to define that PATH_INFO is not
    allowed to contain os-specific drive parts or os-specific path
    separators or os-specific curdir or pardir values, and check for all
    those up-front in parse-request.<br>
    <br>
  </body>
</html>

--------------030005030606070907060004--

