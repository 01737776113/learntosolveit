

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Files - we handle them often &mdash; PyCon 2009 0.1.2 documentation</title>
    
    <link rel="stylesheet" href="_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/print.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.1.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/theme_extras.js"></script>
    <link rel="top" title="PyCon 2009 0.1.2 documentation" href="index.html" />
    <link rel="next" title="Date and time related" href="datetime.html" />
    <link rel="prev" title="Let’s start with strings" href="strings.html" /> 
  </head>
  <body>
      <div class="header"><h1 class="heading"><a href="index.html">
          <span>PyCon 2009 0.1.2 documentation</span></a></h1>
        <h2 class="heading"><span>Files - we handle them often</span></h2>
      </div>
      <div class="topnav">
      
        <p>
        «&#160;&#160;<a href="strings.html">Let&#8217;s start with strings</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="datetime.html">Date and time related</a>&#160;&#160;»
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="files-we-handle-them-often">
<h1>Files - we handle them often<a class="headerlink" href="#files-we-handle-them-often" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li>The builtin function <tt class="docutils literal"><span class="pre">open</span></tt> opens the file and returns a stream. It raises
an IOError upon failure.</li>
<li>A variant of &#8216;r&#8217; that is sometimes precious is &#8216;rU&#8217;, which tells Python to
read the file in text mode with &#8220;universal newlines&#8221;: mode &#8216;rU&#8217; can read text
files independently of the line termination convention the files are using,
be it the Unix way, the Windows way or even the (Old) Mac way. (Mac OS X
today uses Unix for all intents and purposes, but releases of Mac OS 9 and
earlier were different).</li>
<li>When read is called with an integer argument N, it reads and returns the next
N bytes (or all the remaining bytes if less than N bytes remain)</li>
<li>Files have other writing related methods such as flush, to send any data
being buffered, and writelines, to write a sequence of strings in a single
call.  However, write is by far the most commonly used method.</li>
<li>Other methods worth mentioning are seek and tell, which support random access
to files. These methods are normally used with binary files made up of
fixed-length records.</li>
<li>StringIO objects are plug-and-play compatible with file objects, so scanner
takes its three lines of text from an in-memory string object, rather than a
true external file.This shows that Everywhere in Python, object interfaces,
rather than specific data types are units of coupling.</li>
<li>Often the data you want to write is not in one bit string, but in a list (or
other sequence) of strings. In this case, you should use the writelines
method (which despite its name, is not limited to lines and works just as
well with binary data as well as text files). Calling writelines is much
faster than the alternatives of joining the strings into one big string (e.g,
with the &#8216;&#8217;.join) and then calling write or calling write repeatedly in a
loop.  Calling close is even more advisable when you are writing to a file
than you are reading from a file.</li>
<li>With ZipFile, the flag is not used the same way when opening a file, and rb
is not recognized. The r flag handles the inherently binary nature of all zip
files on all platforms.</li>
</ul>
<div class="section" id="reading-a-single-line-from-a-file-give-an-line-number">
<h2>Reading a Single line from a file, give an line number<a class="headerlink" href="#reading-a-single-line-from-a-file-give-an-line-number" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><pre>#!/usr/bin/env python3.1

# Reading a Specific Line from a file
import linecache
SOMEFILE = '/usr/share/games/fortunes/perl'
theline = linecache.getline(SOMEFILE,42)
print(theline, end=' ')

def getline(thefilepath, desired_line_number):
    if desired_line_number &lt; 1: return
    for current_line, line in enumerate(open(thefilepath,'rU')):
        if current_line == desired_line_number - 1:
            return line
    return ''

print(getline(SOMEFILE, 42))
</pre>
</div>
</div>
<div class="section" id="finding-files-given-a-search-path-and-a-pattern">
<h2>Finding files given a search path and a pattern<a class="headerlink" href="#finding-files-given-a-search-path-and-a-pattern" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#!/usr/bin/env python2.6</span>

<span class="c"># Finding Files Given a Search Path and a Pattern</span>

<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="k">def</span> <span class="nf">all_files</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">search_path</span><span class="p">,</span> <span class="n">pathsep</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">pathsep</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">search_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">pathsep</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">pattern</span><span class="p">)):</span>
            <span class="k">yield</span> <span class="n">match</span>

<span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">all_files</span><span class="p">(</span><span class="s">&#39;*.py&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">match</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-a-file-like-object-from-a-string">
<h2>Creating a file-like object from a string<a class="headerlink" href="#creating-a-file-like-object-from-a-string" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#!/usr/bin/env python2.6</span>

<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">StringIO</span>

<span class="k">def</span> <span class="nf">scanner</span><span class="p">(</span><span class="n">fileobject</span><span class="p">,</span> <span class="n">linehandler</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fileobject</span><span class="p">:</span>
        <span class="n">linehandler</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">firstword</span><span class="p">(</span><span class="n">line</span><span class="p">):</span> <span class="k">print</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">string</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">(</span><span class="s">&#39;one</span><span class="se">\n</span><span class="s">two xxx</span><span class="se">\n</span><span class="s">three</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
<span class="n">scanner</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">firstword</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="how-to-read-and-write-to-a-zip-file">
<h2>How to Read and write to a zip file<a class="headerlink" href="#how-to-read-and-write-to-a-zip-file" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#!/usr/bin/env python3.1</span>

<span class="c"># Recipe which demonstrates writing to a zipfile and reading the content from it.</span>

<span class="kn">import</span> <span class="nn">zipfile</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">handle</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkstemp</span><span class="p">(</span><span class="s">&#39;.zip&#39;</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>

<span class="n">z</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
<span class="n">z</span><span class="o">.</span><span class="n">writestr</span><span class="p">(</span><span class="s">&#39;hello.py&#39;</span><span class="p">,</span><span class="s">&#39;def f(): return &quot;hello world from &quot; + __file__</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
<span class="n">z</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">filename</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">hello</span>
<span class="k">print</span><span class="p">(</span><span class="n">hello</span><span class="o">.</span><span class="n">f</span><span class="p">())</span>
<span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>


      </div>
      <div class="bottomnav">
      
        <p>
        «&#160;&#160;<a href="strings.html">Let&#8217;s start with strings</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="datetime.html">Date and time related</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer">
        &copy; Copyright 2012, Senthil Kumaran.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.2.
    </div>
  </body>
</html>