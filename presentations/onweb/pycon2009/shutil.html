

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>shutil module &mdash; PyCon 2009 1 documentation</title>
    
    <link rel="stylesheet" href="_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/print.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/theme_extras.js"></script>
    <link rel="top" title="PyCon 2009 1 documentation" href="index.html" />
    <link rel="next" title="subprocess" href="subprocess.html" />
    <link rel="prev" title="os module" href="os_module.html" /> 
  </head>
  <body>
      <div class="header"><h1 class="heading"><a href="index.html">
          <span>PyCon 2009 1 documentation</span></a></h1>
        <h2 class="heading"><span>shutil module</span></h2>
      </div>
      <div class="topnav">
      
        <p>
        «&#160;&#160;<a href="os_module.html">os module</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="subprocess.html">subprocess</a>&#160;&#160;»
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="shutil-module">
<h1>shutil module<a class="headerlink" href="#shutil-module" title="Permalink to this headline">¶</a></h1>
<p>This utility module contains some functions for copying files and directories.
This module provide high level operations that get performed on a bunch of
files or a collection.</p>
<p>Note that copy methods cannot reliably copy all the metadata. On POSIX
platforms, this means that file owner and group are lost as well as ACLs. On
Mac OS, the resource fork and other metadata are not used. This means that
resources will be lost and file type and creator codes will not be correct. On
Windows, file owners, ACLs and alternate data streams are not copied.</p>
<div class="section" id="what-s-new-shutil-module-in-py2-6-and-py3k">
<h2>What&#8217;s new shutil module in Py2.6 and Py3k.<a class="headerlink" href="#what-s-new-shutil-module-in-py2-6-and-py3k" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>copytree function has an additional parameter called ignore, which takes
callable as an argument. shutil also exposes a ignore_patterns function which
can be used with ignore parameter.</li>
</ul>
</div>
<div class="section" id="simplest-shutil-copy-example">
<h2>Simplest shutil.copy example<a class="headerlink" href="#simplest-shutil-copy-example" title="Permalink to this headline">¶</a></h2>
<p>The following snippet demonstrates, <tt class="docutils literal"><span class="pre">copy(src,</span> <span class="pre">dst)</span></tt> function. It copies the
data as well as the mode bits and as the following shows, it can copy a file
into a directory.  The copy function copies a file in pretty much the same way
as the Unix cp command.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="s">&#39;example&#39;</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&#39;BEFORE:&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s">&#39;example&#39;</span><span class="p">)</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="s">&#39;shutil_copy.py&#39;</span><span class="p">,</span><span class="s">&#39;example&#39;</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&#39;AFTER:&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s">&#39;example&#39;</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="s">&#39;example&#39;</span><span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s">&#39;shutil_copy.py&#39;</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">rmdir</span><span class="p">(</span><span class="s">&#39;example&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="shutil-copy2-example">
<h2>shutil.copy2 example<a class="headerlink" href="#shutil-copy2-example" title="Permalink to this headline">¶</a></h2>
<p>Copy data and all stat info (&#8220;cp -p src dst&#8221;).</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="k">def</span> <span class="nf">show_file_info</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="n">stat_info</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">print</span> <span class="s">&#39;</span><span class="se">\t</span><span class="s">Mode   :&#39;</span><span class="p">,</span> <span class="n">stat_info</span><span class="o">.</span><span class="n">st_mode</span>
    <span class="k">print</span> <span class="s">&#39;</span><span class="se">\t</span><span class="s">Created :&#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">ctime</span><span class="p">(</span><span class="n">stat_info</span><span class="o">.</span><span class="n">st_ctime</span><span class="p">)</span>
    <span class="k">print</span> <span class="s">&#39;</span><span class="se">\t</span><span class="s">Accessed:&#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">ctime</span><span class="p">(</span><span class="n">stat_info</span><span class="o">.</span><span class="n">st_atime</span><span class="p">)</span>
    <span class="k">print</span> <span class="s">&#39;</span><span class="se">\t</span><span class="s">Modified:&#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">ctime</span><span class="p">(</span><span class="n">stat_info</span><span class="o">.</span><span class="n">st_mtime</span><span class="p">)</span>

<span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="s">&#39;example&#39;</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&#39;SOURCE:&#39;</span>
<span class="n">show_file_info</span><span class="p">(</span><span class="s">&#39;shutil_copy2.py&#39;</span><span class="p">)</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="s">&#39;shutil_copy2.py&#39;</span><span class="p">,</span><span class="s">&#39;example&#39;</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&#39;DESTINATION:&#39;</span>
<span class="n">show_file_info</span><span class="p">(</span><span class="s">&#39;example&#39;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s">&#39;shutil_copy2.py&#39;</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="s">&#39;example&#39;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s">&#39;shutil_copy2.py&#39;</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">rmdir</span><span class="p">(</span><span class="s">&#39;example&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="move-copytree-rmtree">
<h2>move, copytree, rmtree<a class="headerlink" href="#move-copytree-rmtree" title="Permalink to this headline">¶</a></h2>
<p>The following snippet demonstrates, <tt class="docutils literal"><span class="pre">move(src,</span> <span class="pre">dst)</span></tt>, which recursively move
a file or directory to another location. This is similar to the unix <cite>mv</cite> command.</p>
<p><tt class="docutils literal"><span class="pre">copytree(src,</span> <span class="pre">dst,</span> <span class="pre">symlinks=False,</span> <span class="pre">ignore=None)</span></tt>, recursively copies a
directory tree using copy2() function and <tt class="docutils literal"><span class="pre">rmtree(path,</span> <span class="pre">ignore_errors=False,</span>
<span class="pre">onerror=None)</span></tt> recursively deletes a directory tree.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#!/usr/bin/env python3.0</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">from</span> <span class="nn">subprocess</span> <span class="kn">import</span> <span class="n">getoutput</span>

<span class="c"># Create an example directory.</span>
<span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="s">&#39;example&#39;</span><span class="p">)</span>

<span class="c"># Write an empty test file.</span>
<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;example.txt&#39;</span><span class="p">,</span><span class="s">&#39;wt&#39;</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;contents&#39;</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c"># move the file to that directory.</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="s">&#39;example.txt&#39;</span><span class="p">,</span><span class="s">&#39;example&#39;</span><span class="p">)</span>

<span class="c"># copy the entire directory tree to a different location.</span>

<span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span><span class="s">&#39;example&#39;</span><span class="p">,</span><span class="s">&#39;/tmp/example&#39;</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">&#39;BEFORE:&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">getoutput</span><span class="p">(</span><span class="s">&#39;ls -rlast /tmp/example&#39;</span><span class="p">))</span>

<span class="c"># remove the directory tree</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="s">&#39;/tmp/example&#39;</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">&#39;AFTER:&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">getoutput</span><span class="p">(</span><span class="s">&#39;ls -rlast /tmp/example&#39;</span><span class="p">))</span>

<span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="s">&#39;example&#39;</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li>commands.getoutput, returns the output(stdout,stderr) as if executed from a shell.</li>
</ul>
</div>
<div class="section" id="copyfileobj-function">
<h2>copyfileobj function<a class="headerlink" href="#copyfileobj-function" title="Permalink to this headline">¶</a></h2>
<p><tt class="docutils literal"><span class="pre">copyfileobj(fsrc,</span> <span class="pre">fdst[,</span> <span class="pre">length=16384])</span></tt>,copy data from file-like object
fsrc to file-like object fdst. length is optional. fsrc, and fdst should be
open file handles.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#!/usr/bin/env python2.6</span>

<span class="kn">import</span> <span class="nn">shutil</span>

<span class="c"># open a file, with w+ mode.</span>

<span class="n">f1</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;example1.txt&#39;</span><span class="p">,</span><span class="s">&#39;w+&#39;</span><span class="p">)</span>

<span class="n">f1</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">I was born in a barrel of butcher knives</span>
<span class="s">Trouble I love and peace I despise</span>
<span class="s">Wild horses kicked me in my side</span>
<span class="s">Then a rattlesnake bit me and he walked off and died.</span>
<span class="s">		-- Bo Diddley</span>
<span class="s">&quot;&quot;&quot;</span><span class="p">)</span>

<span class="c"># Writing would have changed the file-pointer, so I do a seek(0), in order to</span>
<span class="c"># return it back to first position.</span>

<span class="n">f1</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="n">f2</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;example2.txt&#39;</span><span class="p">,</span><span class="s">&#39;w+&#39;</span><span class="p">)</span>

<span class="c"># I am going to copy using shutil.copyfileobj.  This works on open file handles</span>
<span class="c"># and copies the contents of the fsrc to fdst. The file handlle will reach to</span>
<span class="c"># the end again.</span>

<span class="n">shutil</span><span class="o">.</span><span class="n">copyfileobj</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span><span class="n">f2</span><span class="p">)</span>

<span class="c"># Let me check, if both files are same now.</span>

<span class="n">f1</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">f2</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="k">print</span> <span class="n">f1</span><span class="o">.</span><span class="n">read</span><span class="p">()</span> <span class="o">==</span> <span class="n">f2</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="c"># print contents from second file.</span>

<span class="n">f2</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="k">print</span> <span class="n">f2</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="c"># time to close the file handlers.</span>
<span class="n">f1</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="n">f2</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="copyfile-and-copymode">
<h2>copyfile and copymode<a class="headerlink" href="#copyfile-and-copymode" title="Permalink to this headline">¶</a></h2>
<p><tt class="docutils literal"><span class="pre">copyfile(src,</span> <span class="pre">dst)</span></tt>, copies the src to dst. The permissions are set
according to the umask of the current user.  In order to copy the file mode
bits from one file to another, we use <tt class="docutils literal"><span class="pre">copymode(src,</span> <span class="pre">dst)</span></tt>. copymode, does
not create a destination file, it assumes dst already exists.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># By default when a new file is created under Unix, it receives permissions</span>
<span class="c"># based on the umask of the current user. To copy the permissions from one file</span>
<span class="c"># to another use copymode</span>

<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">subprocess</span>

<span class="kn">import</span> <span class="nn">os</span>

<span class="c"># Create an example file.</span>
<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;example.txt&#39;</span><span class="p">,</span><span class="s">&#39;w+&#39;</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;content&#39;</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c"># Set the mode to 0444</span>

<span class="n">os</span><span class="o">.</span><span class="n">chmod</span><span class="p">(</span><span class="s">&#39;example.txt&#39;</span><span class="p">,</span><span class="mo">0444</span><span class="p">)</span>

<span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="s">&#39;example.txt&#39;</span><span class="p">,</span><span class="s">&#39;newfile.txt&#39;</span><span class="p">)</span>

<span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">([</span><span class="s">&#39;ls&#39;</span><span class="p">,</span> <span class="s">&#39;-ld&#39;</span><span class="p">,</span> <span class="s">&#39;example.txt&#39;</span><span class="p">])</span>

<span class="k">print</span> <span class="s">&#39;With shutil.copyfile:&#39;</span>
<span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">([</span><span class="s">&#39;ls&#39;</span><span class="p">,</span> <span class="s">&#39;-ld&#39;</span><span class="p">,</span> <span class="s">&#39;newfile.txt&#39;</span><span class="p">])</span>

<span class="k">print</span> <span class="s">&#39;After shutil.copymode:&#39;</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">copymode</span><span class="p">(</span><span class="s">&#39;example.txt&#39;</span><span class="p">,</span><span class="s">&#39;newfile.txt&#39;</span><span class="p">)</span>
<span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">([</span><span class="s">&#39;ls&#39;</span><span class="p">,</span> <span class="s">&#39;-ld&#39;</span><span class="p">,</span> <span class="s">&#39;newfile.txt&#39;</span><span class="p">])</span>

<span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="s">&#39;example.txt&#39;</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="s">&#39;newfile.txt&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="copystat">
<h2>copystat<a class="headerlink" href="#copystat" title="Permalink to this headline">¶</a></h2>
<p><tt class="docutils literal"><span class="pre">shutil.copystat(src,</span> <span class="pre">dst)</span></tt>, copie all stat info (mode bits, atime, mtime,
flags) from src to dst. It is best verified from the following example.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#!/usr/bin/env python2.6</span>

<span class="c"># Copyright 2009: PyMOTW, Doug Hellman. All Rights Reserved.</span>

<span class="kn">from</span> <span class="nn">shutil</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="k">def</span> <span class="nf">show_file_info</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="n">stat_info</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">print</span> <span class="s">&#39;</span><span class="se">\t</span><span class="s">Mode   :&#39;</span><span class="p">,</span><span class="n">stat_info</span><span class="o">.</span><span class="n">st_mode</span>
    <span class="k">print</span> <span class="s">&#39;</span><span class="se">\t</span><span class="s">Created    :&#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">ctime</span><span class="p">(</span><span class="n">stat_info</span><span class="o">.</span><span class="n">st_ctime</span><span class="p">)</span>
    <span class="k">print</span> <span class="s">&#39;</span><span class="se">\t</span><span class="s">Accessed   :&#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">ctime</span><span class="p">(</span><span class="n">stat_info</span><span class="o">.</span><span class="n">st_atime</span><span class="p">)</span>
    <span class="k">print</span> <span class="s">&#39;</span><span class="se">\t</span><span class="s">Modified   :&#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">ctime</span><span class="p">(</span><span class="n">stat_info</span><span class="o">.</span><span class="n">st_mtime</span><span class="p">)</span>

<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;file_to_change.txt&#39;</span><span class="p">,</span><span class="s">&#39;wt&#39;</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;content&#39;</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">os</span><span class="o">.</span><span class="n">chmod</span><span class="p">(</span><span class="s">&#39;file_to_change.txt&#39;</span><span class="p">,</span><span class="mo">0444</span><span class="p">)</span>

<span class="k">print</span> <span class="s">&#39;BEFORE:&#39;</span>
<span class="n">show_file_info</span><span class="p">(</span><span class="s">&#39;file_to_change.txt&#39;</span><span class="p">)</span>
<span class="n">copystat</span><span class="p">(</span><span class="s">&#39;shutil_copystat.py&#39;</span><span class="p">,</span><span class="s">&#39;file_to_change.txt&#39;</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&#39;AFTER:&#39;</span>
<span class="n">show_file_info</span><span class="p">(</span><span class="s">&#39;file_to_change.txt&#39;</span><span class="p">)</span>

<span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="s">&#39;file_to_change.txt&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="assignment">
<h2>Assignment<a class="headerlink" href="#assignment" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Write a script that can export a svn or cvs directory.</li>
</ul>
</div>
</div>


      </div>
      <div class="bottomnav">
      
        <p>
        «&#160;&#160;<a href="os_module.html">os module</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="subprocess.html">subprocess</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer">
        &copy; Copyright 2009, Senthil Kumaran.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.2.
    </div>
  </body>
</html>